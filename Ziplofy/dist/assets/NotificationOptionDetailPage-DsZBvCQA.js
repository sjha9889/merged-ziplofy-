import{p as me,u as ue,J as ge,K as xe,V as pe,b as he,W as fe,r as a,j as e,O as n}from"./index-C7S6h9OR.js";import{G as N}from"./GridBackgroundWrapper-Du1VLjut.js";import{M as K}from"./Modal-DsfhGJdg.js";import{T as be}from"./ToggleSwitch-DRYMOlwW.js";import{F as L}from"./ChevronRightIcon-CVun6pAX.js";import{F as ye}from"./ArrowLeftIcon-C1qOxHB_.js";import{F as je}from"./PencilIcon-MufFKs4H.js";import"./index-CCB_rw4P.js";const Oe=()=>{const{categoryId:l,categorySlug:c,optionId:o}=me(),b=ue(),{options:y,fetchByCategoryId:w}=ge(),{categories:p,fetchAll:_}=xe(),{settings:U,getByStoreId:W}=pe(),{activeStoreId:i}=he(),{checkExists:C,create:z,remove:J,clearCacheEntry:j}=fe(),[V,Y]=a.useState("English"),[r,E]=a.useState(null),[q,v]=a.useState(!1),[k,O]=a.useState(!1),[Q,S]=a.useState(!1),[d,h]=a.useState("email"),[F,g]=a.useState(null),[B,m]=a.useState(null),[x,u]=a.useState(null),[X,f]=a.useState(!1),[T,M]=a.useState(""),[D,I]=a.useState(""),Z=l&&c?`/settings/notifications/${l}/${c}`:"/settings/notifications",ee=a.useMemo(()=>{if(!l)return"Notifications";const t=p.find(s=>s._id===l);return t?.name?t.name:c?c.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):"Notifications"},[p,l,c]);a.useEffect(()=>{p.length===0&&_().catch(()=>{})},[p.length,_]),a.useEffect(()=>{l&&w(l).catch(()=>{})},[l,w]),a.useEffect(()=>{if(o&&y.length>0){const t=y.find(s=>s._id===o);t?(E(t),S(t.toggle||!1),t.smsSupported&&!t.emailSupported?h("sms"):h("email")):E(null)}g(null),m(null),u(null),$(null),i&&o&&j(i,o)},[o,y,i,j]),a.useEffect(()=>{i&&W(i).catch(()=>{})},[i]);const[P,$]=a.useState(null);a.useEffect(()=>{if(!i||!o)return;const t=`${i}:${o}`;P!==t&&C(i,o,!0).then(s=>{$(t),g(s.exists),console.log("Override check result:",s.exists),s.exists&&s.override?(m(s.override._id),u({emailSubject:s.override.emailSubject,emailBody:s.override.emailBody,smsData:s.override.smsData})):(m(null),u(null))}).catch(s=>{console.error("Error checking override:",s),g(!1),m(null),u(null)})},[i,o,C,P]);const R=()=>{l&&c?b(Z,{state:{categoryId:l}}):b("/settings/notifications")},te=()=>{v(!0)},G=()=>{v(!1)},se=async()=>{O(!0);try{await new Promise(t=>setTimeout(t,1e3)),n.success("Test email sent successfully"),v(!1)}catch(t){n.error(t?.message||"Failed to send test email")}finally{O(!1)}},ae=U?.storeEmail||"developer200419@gmail.com",re=async t=>{S(t);try{await new Promise(s=>setTimeout(s,500)),n.success("Notification setting updated")}catch(s){S(!t),n.error(s?.message||"Failed to update notification setting")}},ie=()=>{if(r){const t=x?.emailSubject??r.emailSubject??"",s=x?.emailBody??r.emailBody??"";M(t),I(s),f(!0)}},H=()=>{f(!1)},ne=async()=>{if(!(!i||!o||!r))try{n.dismiss(),f(!1);const t=await z({storeId:i,notificationOptionId:o,emailSubject:T.trim()||void 0,emailBody:D.trim()||void 0,enabled:!0});m(t._id),u({emailSubject:t.emailSubject,emailBody:t.emailBody,smsData:t.smsData}),g(!0),n.dismiss(),n.success("Email template updated successfully")}catch(t){n.dismiss(),n.error(t?.message||"Failed to update email template"),f(!0)}},oe=async()=>{if(B)try{n.dismiss(),await J(B),g(!1),m(null),u(null),i&&o&&j(i,o),n.dismiss(),n.success("Reverted to default notification template")}catch(t){n.dismiss(),n.error(t?.message||"Failed to revert to default template")}};if(!l||!c)return e.jsx(N,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4",children:e.jsx("p",{className:"text-sm text-gray-900",children:"Notification category not found."})})});if(!r)return e.jsx(N,{children:e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4",children:e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})})})});const A=t=>t.replace(/\{\{customer_name\}\}/g,"John Doe").replace(/\{\{order_number\}\}/g,"#9999").replace(/\{\{store_name\}\}/g,"My Store").replace(/\{\{view_order_url\}\}/g,"#").replace(/\{\{store_url\}\}/g,"#").replace(/\{\{return_tracking_url\}\}/g,"#").replace(/\{\{return_label_url\}\}/g,"#").replace(/\{\{account_invite_url\}\}/g,"#").replace(/\{\{account_url\}\}/g,"#").replace(/\{\{password_reset_url\}\}/g,"#").replace(/\{\{new_email\}\}/g,"newemail@example.com").replace(/\{\{message_body\}\}/g,"Your message here").replace(/\{\{gift_card_code\}\}/g,"A1B2 3C4D 5E6F 7G8H").replace(/\{\{gift_card_amount\}\}/g,"Rs. 100.00").replace(/\{\{shipping_name\}\}/g,"Steve Shipper").replace(/\{\{shipping_address_line1\}\}/g,"123 Shipping Street").replace(/\{\{shipping_city\}\}/g,"Shippington").replace(/\{\{shipping_state\}\}/g,"Kentucky").replace(/\{\{shipping_zip\}\}/g,"40003").replace(/\{\{shipping_country\}\}/g,"United States").replace(/\{\{shipping_phone\}\}/g,"555-555-SHIP").replace(/\{\{shipping_method\}\}/g,"Generic Shipping").replace(/\{\{tracking_number\}\}/g,"None").replace(/\{\{customer_email\}\}/g,"jon@example.com"),le=()=>{const t=x?.emailBody??(r.emailBody||"<p>No email template available.</p>"),s=A(t);return e.jsx("div",{className:"border border-gray-200 p-3 bg-white max-w-[600px] overflow-auto",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s},className:"[&_img]:max-w-full [&_img]:h-auto [&_img]:block [&_*]:box-border"})})},ce=()=>{const t=x?.smsData??(r.smsData||"No SMS template available."),s=A(t);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-gray-200 p-3 bg-white max-w-[600px] mb-3",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap break-words text-sm leading-relaxed",children:s})}),e.jsxs("div",{className:"p-3 border border-gray-200 bg-white/95 max-w-[600px]",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"SMS notifications"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Transactional SMS notifications can't be edited. Customer name, order number, and other specific details will automatically update with the correct information."}),e.jsx("button",{onClick:de=>{de.preventDefault()},className:"text-xs text-gray-700 hover:underline",children:"Learn more about SMS notifications."})]})]})};return e.jsx(N,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-3 text-xs text-gray-600",children:[e.jsx("button",{onClick:()=>b("/settings/notifications"),className:"hover:underline",children:"Notifications"}),e.jsx(L,{className:"w-3 h-3"}),e.jsx("button",{onClick:R,className:"hover:underline",children:ee}),e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"text-gray-900",children:r.optionName})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3 border-b border-gray-200 pb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{onClick:R,className:"p-1 hover:bg-gray-50 transition-colors",children:e.jsx(ye,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-medium text-gray-900",children:r.optionName}),F===!1&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200",children:"Default"}),F===!0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-200",children:"Custom"}),e.jsx("button",{onClick:oe,className:"px-2 py-0.5 text-xs font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Use default"})]})]}),r.toggle===!0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Enable this notification"}),e.jsx(be,{checked:Q,onChange:re})]})]}),d==="email"&&e.jsx("button",{onClick:te,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Send test"})]}),e.jsxs("div",{className:"border border-gray-200 p-3 bg-white/95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Preview"}),d==="email"&&r?.emailSupported&&e.jsx("button",{onClick:ie,className:"p-1 text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("select",{value:V,onChange:t=>Y(t.target.value),className:"px-2 py-1 text-xs border border-gray-200 bg-white focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400",children:[e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Spanish",children:"Spanish"}),e.jsx("option",{value:"French",children:"French"})]})]}),(r.emailSupported||r.smsSupported)&&e.jsx("div",{className:"border-b border-gray-200 mb-3",children:e.jsxs("div",{className:"flex gap-4",children:[r.emailSupported&&e.jsx("button",{onClick:()=>h("email"),className:`pb-2 px-1 text-xs font-medium transition-colors ${d==="email"?"text-gray-900 border-b-2 border-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"Email"}),r.smsSupported&&e.jsx("button",{onClick:()=>h("sms"),className:`pb-2 px-1 text-xs font-medium transition-colors ${d==="sms"?"text-gray-900 border-b-2 border-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"SMS"})]})}),d==="email"&&r.emailSupported&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:["Subject: ",x?.emailSubject??(r.emailSubject||"No subject")]})}),le()]}),d==="sms"&&r.smsSupported&&e.jsx(e.Fragment,{children:ce()})]}),e.jsx(K,{open:q,onClose:G,title:"Send test email",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:G,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:se,disabled:k,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:k?"Sending...":"Send"})]}),children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Email will be sent to ",ae]})}),e.jsx(K,{open:X,onClose:H,title:"Edit email template",maxWidth:"md",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:H,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ne,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 transition-colors",children:"Save"})]}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:T,onChange:t=>M(t.target.value),className:"w-full px-2.5 py-1.5 text-sm text-gray-900 border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Body"}),e.jsx("textarea",{value:D,onChange:t=>I(t.target.value),rows:10,className:"w-full px-2.5 py-1.5 text-sm text-gray-900 border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400 resize-y"})]})]})})]})})};export{Oe as default};
