import{p as S,u as O,s as _,q as I,r as l,j as e}from"./index-C7S6h9OR.js";import{G as P}from"./GridBackgroundWrapper-Du1VLjut.js";import{F as A}from"./ArrowLeftIcon-C1qOxHB_.js";function k(){const{id:n}=S(),y=O(),{entries:o,fetchEntriesByPurchaseOrderId:f,loading:p,error:g,clearEntries:v}=_(),{receiveInventory:b}=I(),[h,w]=l.useState({}),[u,j]=l.useState({});l.useEffect(()=>{if(n)return f(n).catch(()=>{}),()=>v()},[n]);const N=l.useMemo(()=>o.map(t=>{const s=t.variantId,a=s?.productId?.title||"-",c=s?.optionValues?Object.values(s.optionValues).join(" / "):"",r=s?.sku||"-";return{e:t,productTitle:a,optionText:c,rsku:r}}),[o]),R=(t,s)=>a=>{const c=Number(a.target.value||0),r=Math.max(0,Math.min(c,s)),i=u[t]??0,x=Math.max(0,s-r),d=Math.min(i,x);w(m=>({...m,[t]:r})),d!==i&&j(m=>({...m,[t]:d}))},M=(t,s)=>a=>{const c=Number(a.target.value||0),r=h[t]??0,i=Math.max(0,s-r),x=Math.max(0,Math.min(c,i));j(d=>({...d,[t]:x}))};return e.jsx(P,{children:e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(`/products/purchase-orders/${n}`),className:"p-1 text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-xl font-medium text-gray-900",children:"Receive Inventory"})]}),e.jsx("button",{onClick:async()=>{if(!n)return;const t=o.map(s=>({entryId:s._id,accept:Number(h[s._id]??0)||0,reject:Number(u[s._id]??0)||0}));try{await b(n,t),y(`/products/purchase-orders/${n}`)}catch{}},className:"px-3 py-1.5 text-sm font-medium bg-gray-900 text-white hover:bg-gray-800 transition-colors",children:"Save"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[g&&e.jsx("div",{className:"mb-4 px-3 py-2 border border-red-200 bg-red-50",children:e.jsx("p",{className:"text-sm text-red-600",children:g})}),p&&e.jsx("div",{className:"py-12 text-center",children:e.jsx("div",{className:"animate-spin rounded-full w-4 h-4 border-2 border-gray-300 border-t-gray-900 mx-auto"})}),!p&&e.jsx("div",{className:"border border-gray-200 p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-900",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-900",children:"Supplier SKU"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-900",children:"RSKU"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Ordered"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Received"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Accept"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Reject"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[N.map(({e:t,productTitle:s,optionText:a,rsku:c})=>{const r=Math.max(0,(t.quantityOrdered||0)-(t.quantityReceived||0)),i=h[t._id]??0,x=u[t._id]??0,d=Math.max(0,r-x),m=Math.max(0,r-i);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s}),a&&e.jsx("p",{className:"text-xs text-gray-600",children:a}),e.jsxs("p",{className:"text-xs text-gray-600",children:["SKU: ",c]})]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.supplierSku||"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:c}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 text-right",children:t.quantityOrdered}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 text-right",children:t.quantityReceived}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("input",{type:"number",min:0,max:d,value:i,onChange:R(t._id,r),className:"w-[140px] px-2 py-1 text-sm border border-gray-200 text-right focus:outline-none focus:ring-1 focus:ring-gray-400"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("input",{type:"number",min:0,max:m,value:x,onChange:M(t._id,r),className:"w-[140px] px-2 py-1 text-sm border border-gray-200 text-right focus:outline-none focus:ring-1 focus:ring-gray-400"})})]},t._id)}),!p&&N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-gray-600",children:"No entries"})})]})]})})})]})]})})}export{k as default};
