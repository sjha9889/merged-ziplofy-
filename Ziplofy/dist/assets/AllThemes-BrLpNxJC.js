import{j as e,r as c,b as ie,aY as ve,aZ as ye,a9 as we,R as X,a_ as Ne}from"./index-C7S6h9OR.js";import{S as Ie,D as Te}from"./Search-GwsDg8Y4.js";import{c as C}from"./createSvgIcon-Yi9Vo0kN.js";import{M as ke}from"./MoreVert-CIl6RWb8.js";import"./DefaultPropsProvider-CZkfTDs_.js";const Ce=C(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),Se=C(e.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"})),$e=C(e.jsx("path",{fillRule:"evenodd",d:"M3 3v8h8V3zm6 6H5V5h4zm-6 4v8h8v-8zm6 6H5v-4h4zm4-16v8h8V3zm6 6h-4V5h4zm-6 4v8h8v-8zm6 6h-4v-4h4z"})),ne=C(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),Q=C(e.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})),ze=C(e.jsx("path",{d:"M3 14h4v-4H3zm0 5h4v-4H3zM3 9h4V5H3zm5 5h13v-4H8zm0 5h13v-4H8zM8 5v4h13V5z"})),ee=C(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}));const oe=(...r)=>r.filter((i,o,h)=>!!i&&i.trim()!==""&&h.indexOf(i)===o).join(" ").trim();const _e=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Ue=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,o,h)=>h?h.toUpperCase():o.toLowerCase());const le=r=>{const i=Ue(r);return i.charAt(0).toUpperCase()+i.slice(1)};var Ee={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Me=r=>{for(const i in r)if(i.startsWith("aria-")||i==="role"||i==="title")return!0;return!1};const Oe=c.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:h,className:p="",children:x,iconNode:u,...g},b)=>c.createElement("svg",{ref:b,...Ee,width:i,height:i,stroke:r,strokeWidth:h?Number(o)*24/Number(i):o,className:oe("lucide",p),...!x&&!Me(g)&&{"aria-hidden":"true"},...g},[...u.map(([E,y])=>c.createElement(E,y)),...Array.isArray(x)?x:[x]]));const W=(r,i)=>{const o=c.forwardRef(({className:h,...p},x)=>c.createElement(Oe,{ref:x,iconNode:i,className:oe(`lucide-${_e(le(r))}`,`lucide-${r}`,h),...p}));return o.displayName=le(r),o};const Le=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Pe=W("external-link",Le);const Re=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Fe=W("maximize-2",Re);const Ae=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Be=W("minimize-2",Ae);const Ve=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],De=W("x",Ve),He=({isOpen:r,onClose:i,themeId:o,themeName:h,isInstalled:p=!1,isCustomTheme:x=!1})=>{const[u,g]=c.useState(!1),[b,E]=c.useState(!0),{activeStoreId:y}=ie(),R=c.useMemo(()=>{const d="https://backend.ziplofy.com/api",j=`?v=${Date.now()}`;if(x)if(o.startsWith("custom-")){const I=(()=>{try{const A=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")||localStorage.getItem("token")||sessionStorage.getItem("token");if(!A)return null;const O=A.split(".");if(O.length<2)return null;const k=JSON.parse(atob(O[1].replace(/-/g,"+").replace(/_/g,"/")));return String(k.uid||k.userId||k.id||"")}catch{return null}})();if(y)return`${d}/themes/installed/${y}/${o}/unzippedTheme/index.html${j}`;if(I)return`${d}/themes/installed/${I}/${o}/unzippedTheme/index.html${j}`;const T=o.replace(/^custom-/,"");return`${d}/custom-themes/${T}/files/index.html${j}`}else return`${d}/custom-themes/${o}/files/index.html${j}`;if(!p)return`${d}/themes/preview/${o}${j}`;const $=(()=>{try{const M=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")||localStorage.getItem("token")||sessionStorage.getItem("token");if(!M)return null;const I=M.split(".");if(I.length<2)return null;const T=JSON.parse(atob(I[1].replace(/-/g,"+").replace(/_/g,"/")));return String(T.uid||T.userId||T.id||"")}catch{return null}})();return y?`${d}/themes/installed/${y}/${o}/unzippedTheme/index.html${j}`:$?`${d}/themes/installed/${$}/${o}/unzippedTheme/index.html${j}`:`${d}/themes/preview/${o}${j}`},[o,p,x,y]);if(!r)return null;const w=R,F=()=>{window.open(w,"_blank","noopener,noreferrer")},J=()=>{g(!u)},S=()=>{E(!1)};return e.jsxs("div",{className:`theme-preview-modal ${u?"fullscreen":""}`,children:[e.jsx("div",{className:"modal-overlay",onClick:i}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title",children:[e.jsxs("h3",{children:["Theme Preview: ",h]}),e.jsx("span",{className:"preview-badge",children:"Live Demo"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"action-btn",onClick:J,title:u?"Exit Fullscreen":"Enter Fullscreen",children:u?e.jsx(Be,{size:16}):e.jsx(Fe,{size:16})}),e.jsx("button",{className:"action-btn",onClick:F,title:"Open in New Tab",children:e.jsx(Pe,{size:16})}),e.jsx("button",{className:"action-btn close-btn",onClick:i,title:"Close Preview",children:e.jsx(De,{size:16})})]})]}),e.jsxs("div",{className:"modal-body",children:[b&&e.jsx("div",{className:"loading-overlay",children:e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading theme preview..."})]})}),e.jsx("iframe",{src:w,className:"theme-preview-iframe",title:`${h} Preview`,onLoad:S,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-presentation",loading:"lazy"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("div",{className:"preview-info",children:e.jsx("p",{children:"This is a live preview of the theme. Interactive features may be limited in preview mode."})}),e.jsxs("div",{className:"preview-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:i,children:"Close Preview"}),e.jsx("button",{className:"btn-primary",onClick:F,children:"Open in New Tab"})]})]})]})]})},We=({isOpen:r,onClose:i,themeId:o})=>{if(!r)return null;const h=()=>{const u=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken"),g=localStorage.getItem("storeId")||sessionStorage.getItem("storeId");let b=`/themes/builder?id=${encodeURIComponent(o)}&type=installed`;u&&(b+=`&accessToken=${encodeURIComponent(u)}`),g&&(b+=`&storeId=${encodeURIComponent(g)}`),window.open(b,"_blank","noopener,noreferrer"),i()},p=()=>{window.open(`/themes/code/${o}`,"_blank","noopener,noreferrer"),i()},x=()=>{const u=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken"),g=localStorage.getItem("storeId")||sessionStorage.getItem("storeId");let b=`/themes/basic-elementor?id=${encodeURIComponent(o)}&type=installed`;u&&(b+=`&accessToken=${encodeURIComponent(u)}`),g&&(b+=`&storeId=${encodeURIComponent(g)}`),window.open(b,"_blank","noopener,noreferrer"),i()};return e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:9999},children:[e.jsx("div",{onClick:i,style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.4)"}}),e.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",background:"#fff",color:"#000",width:420,borderRadius:8,boxShadow:"0 10px 30px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{padding:16,borderBottom:"1px solid #e5e7eb",fontWeight:700},children:"Edit Theme"}),e.jsxs("div",{style:{padding:16,display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("button",{onClick:h,style:{padding:"12px 14px",borderRadius:8,border:"1px solid #d1d5da",background:"#fff",cursor:"pointer",textAlign:"left",fontWeight:600},children:["Edit Layout (Visual)",e.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:400},children:"Open Elementor-style visual builder to modify layout and components"})]}),e.jsxs("button",{onClick:x,style:{padding:"12px 14px",borderRadius:8,border:"1px solid #d1d5da",background:"#fff",cursor:"pointer",textAlign:"left",fontWeight:600},children:["Edit with Basic Elementor",e.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:400},children:"Open basic Elementor editor"})]}),e.jsxs("button",{onClick:p,style:{padding:"12px 14px",borderRadius:8,border:"1px solid #d1d5da",background:"#fff",cursor:"pointer",textAlign:"left",fontWeight:600},children:["Edit Code (Advanced)",e.jsx("div",{style:{fontSize:12,color:"#6b7280",fontWeight:400},children:"Open code editor (Monaco) to edit HTML/CSS/JS"})]})]}),e.jsx("div",{style:{padding:12,borderTop:"1px solid #e5e7eb",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:i,style:{padding:"8px 12px",borderRadius:6,border:"1px solid #d1d5da",background:"#fff",cursor:"pointer"},children:"Close"})})]})]})},Xe=()=>{const[r,i]=c.useState("grid"),[o,h]=c.useState(""),[p,x]=c.useState({isOpen:!1,themeId:"",themeName:"",isInstalled:!1,isCustomTheme:!1}),[u,g]=c.useState({isOpen:!1,themeId:"",isInstalled:!1}),{themes:b,loading:E,error:y,fetchAll:R}=ve(),{installedThemes:w,installTheme:F,uninstallTheme:J,fetchByStoreId:S}=ye(),{activeStoreId:d}=ie(),{customThemes:j,loading:re,fetchAll:$,deleteTheme:M,installTheme:I,uninstallTheme:T,updateTheme:A}=we(),[O,k]=c.useState([]),[Je,se]=c.useState(!1),[z,q]=c.useState(!1),[_,G]=c.useState(new Set),[L,P]=c.useState(null),[B,V]=c.useState({isOpen:!1,themeId:"",themeName:""}),[U,te]=c.useState(!1),[Z,D]=c.useState({}),ce=async s=>{await J(s)},de=async s=>{d&&(await F(d,s),setTimeout(()=>{Y()},500))},H=(s,t,n=!1,a=!1)=>{x({isOpen:!0,themeId:s,themeName:t,isInstalled:n,isCustomTheme:a})},me=()=>{x({isOpen:!1,themeId:"",themeName:"",isInstalled:!1,isCustomTheme:!1})},he=s=>{const t="https://backend.ziplofy.com/api",n=`?v=${Date.now()}`,l=(()=>{try{const f=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")||localStorage.getItem("token")||sessionStorage.getItem("token");if(!f)return null;const v=f.split(".");if(v.length<2)return null;const m=JSON.parse(atob(v[1].replace(/-/g,"+").replace(/_/g,"/")));return String(m.uid||m.userId||m.id||"")}catch{return null}})();return d?`${t}/themes/installed/${d}/${s}/unzippedTheme/index.html${n}`:l?`${t}/themes/installed/${l}/${s}/unzippedTheme/index.html${n}`:`${t}/themes/preview/${s}${n}`},ue=(s,t=!1)=>{let n;if(t){const a="https://backend.ziplofy.com/api",l=`?v=${Date.now()}`;if(s.startsWith("custom-")){const v=(()=>{try{const m=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")||localStorage.getItem("token")||sessionStorage.getItem("token");if(!m)return null;const N=m.split(".");if(N.length<2)return null;const K=JSON.parse(atob(N[1].replace(/-/g,"+").replace(/_/g,"/")));return String(K.uid||K.userId||K.id||"")}catch{return null}})();if(d)n=`${a}/themes/installed/${d}/${s}/unzippedTheme/index.html${l}`;else if(v)n=`${a}/themes/installed/${v}/${s}/unzippedTheme/index.html${l}`;else{const m=s.replace(/^custom-/,"");n=`${a}/custom-themes/${m}/files/index.html${l}`}}else n=`${a}/custom-themes/${s}/files/index.html${l}`}else n=he(s);window.open(n,"_blank","noopener,noreferrer")},pe=(s,t=!1)=>{g({isOpen:!0,themeId:s,isInstalled:t})},xe=async(s,t)=>{te(!0);let n=null;try{n=URL.createObjectURL(t),D(m=>({...m,[s]:n}));const a=await Ne.get(`/custom-themes/${s}`);if(!a.data.success||!a.data.data)throw new Error("Theme not found");const l=a.data.data,f=new Blob([t],{type:t.type});await A(s,l.name,l.html||"",l.css||"",f)?(await $(),await new Promise(m=>setTimeout(m,500)),console.log("this is the domain section"),setTimeout(()=>{D(m=>{const N={...m};return delete N[s],N}),n&&URL.revokeObjectURL(n)},1e3),V({isOpen:!1,themeId:"",themeName:""}),P(null)):(D(m=>{const N={...m};return delete N[s],N}),n&&URL.revokeObjectURL(n),alert("Failed to update thumbnail. Please try again."))}catch(a){console.error("Error updating thumbnail:",a),D(f=>{const v={...f};return delete v[s],v}),n&&URL.revokeObjectURL(n);const l=a?.response?.data?.message||a?.message||"Failed to update thumbnail. Please try again.";alert(l)}finally{te(!1)}},fe=s=>{const t=s.target.files?.[0];if(t){if(!t.type.startsWith("image/")){alert("Please select an image file.");return}if(t.size>5*1024*1024){alert("Image size should be less than 5MB.");return}B.themeId&&xe(B.themeId,t),s.target.value=""}},ge=async s=>{if(!/^[0-9a-fA-F]{24}$/.test(s)){alert("Invalid theme ID. This theme may have been created with an old format. It cannot be deleted through the API.");return}if(!window.confirm("Are you sure you want to delete this theme? This action cannot be undone."))return;await M(s)?localStorage.getItem("ziplofy.appliedCustomThemeId")===s&&localStorage.removeItem("ziplofy.appliedCustomThemeId"):alert("Failed to delete theme. Please try again.")},be=s=>w.some(t=>t._id===s);c.useEffect(()=>{R()},[R]);const Y=async()=>{se(!0);try{const t=await fetch("https://backend.ziplofy.com/api/themes/recent");if(t.ok){const n=await t.json();k(n||[])}}catch(s){console.error("Error fetching recent installations:",s),k([])}finally{se(!1)}};c.useEffect(()=>{Y()},[]);const je=async()=>{if(_.size===0){alert("Please select at least one theme to delete");return}if(confirm(`Are you sure you want to delete ${_.size} theme(s) from history?`))try{const t=await fetch("https://backend.ziplofy.com/api/themes/recent/delete",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({themeIds:Array.from(_)})});if(t.ok)k(n=>n.filter(a=>{const l=a.recentId||a._id;return!_.has(l)})),G(new Set),q(!1);else{const n=await t.json();alert(n.message||"Failed to delete themes from history")}}catch(s){console.error("Error deleting recent installations:",s),alert("Failed to delete themes from history")}};c.useEffect(()=>{d&&S(d)},[d,S]),c.useEffect(()=>{const s=t=>{L&&!t.target.closest(".theme-card-menu")&&P(null)};if(L)return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[L]),c.useEffect(()=>{j.length>0&&Object.keys(Z).length>0},[j]),c.useEffect(()=>{$();const s=localStorage.getItem("ziplofy.appliedCustomThemeId");s&&(/^[0-9a-fA-F]{24}$/.test(s)||(localStorage.removeItem("ziplofy.appliedCustomThemeId"),console.warn("Removed invalid custom theme ID from localStorage")))},[$]);const ae=b.filter(s=>s.name.toLowerCase().includes(o.toLowerCase())||(s.description||"").toLowerCase().includes(o.toLowerCase()));return e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Themes"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Discover professionally designed themes to make your store stand out"})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 w-full sm:w-auto",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search themes...",className:"w-full pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors",value:o,onChange:s=>h(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Se,{fontSize:"small"}),e.jsx("span",{children:"Filter"})]}),e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("button",{className:`p-2 transition-colors ${r==="grid"?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,onClick:()=>i("grid"),children:e.jsx($e,{fontSize:"small"})}),e.jsx("button",{className:`p-2 transition-colors ${r==="list"?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,onClick:()=>i("list"),children:e.jsx(ze,{fontSize:"small"})})]})]})]})}),Array.isArray(w)&&w.length>0&&e.jsxs(X.Fragment,{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Installed themes"}),e.jsx("div",{className:`themes-layout ${r} themes-section-body`,children:w.map(s=>{const t=s,n=t.isCustomTheme||t._id?.startsWith("custom-"),a=n&&t.customThemeId?t.customThemeId:t._id;return e.jsxs("div",{className:"theme-card",children:[e.jsxs("div",{className:"theme-thumbnail",children:[t.thumbnailUrl?e.jsx("img",{src:t.thumbnailUrl,alt:t.name||"",className:"theme-image",onError:l=>{l.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"><rect width="300" height="200" fill="%23f3f4f6"/><text x="150" y="100" text-anchor="middle" fill="%236b7280" font-family="Arial" font-size="14">No Preview</text></svg>'}}):e.jsx("div",{className:"theme-image-placeholder",children:e.jsx("span",{children:"No Preview"})}),e.jsx("div",{className:"theme-overlay",children:e.jsxs("button",{className:"overlay-btn preview-btn",onClick:()=>H(t._id,t.name,!0,n),children:[e.jsx(ee,{fontSize:"small"}),e.jsx("span",{children:"Preview"})]})})]}),e.jsxs("div",{className:"theme-info",children:[e.jsxs("div",{className:"theme-header-info",children:[e.jsx("h3",{className:"theme-name",children:t.name}),e.jsxs("div",{className:"theme-rating",children:[e.jsx("div",{className:"stars",children:[...Array(5)].map((l,f)=>e.jsx(Q,{fontSize:"inherit",className:"star filled"},f))}),e.jsx("span",{className:"rating-text",children:Number(t.rating?.average||0).toFixed(1)})]})]}),t.description&&e.jsx("p",{className:"theme-description",children:t.description}),e.jsxs("div",{className:"theme-meta",children:[e.jsx("span",{className:"theme-category",children:t.category}),e.jsx("span",{className:"theme-price",children:"Free"})]}),e.jsxs("div",{className:"theme-actions",children:[e.jsx("button",{className:"action-btn primary",onClick:()=>ue(t._id,n),children:"Open"}),n?e.jsx("button",{className:"action-btn secondary",onClick:()=>{a&&window.open(`/themes/builder?themeId=${a}`,"_blank","noopener,noreferrer")},children:"Edit"}):e.jsx("button",{className:"action-btn secondary",onClick:()=>pe(t._id,!0),children:"Edit"}),e.jsx("button",{className:"action-btn secondary",onClick:n?async()=>{if(!d){alert("Please select a store first.");return}await T(a,d)&&await S(d)}:()=>ce(s.installedThemeId),children:"Uninstall"})]})]})]},s._id)})})]}),O.length>0&&e.jsxs(X.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Recently Installed"}),e.jsxs("div",{className:"flex items-center gap-3",children:[z&&e.jsx("button",{onClick:()=>{q(!1),G(new Set)},className:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{z?je():q(!0)},className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${z?"bg-red-600 text-white hover:bg-red-700":"text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:"Delete Selected"})]})]}),z&&e.jsx("div",{className:"themes-selection-hint",children:"Select themes to delete from history"}),e.jsx("div",{className:`themes-layout ${r} themes-section-body`,children:O.map(s=>((s.isCustomTheme||s._id?.startsWith("custom-"))&&s.customThemeId?s.customThemeId:s._id,e.jsxs("div",{className:"theme-card",style:{position:"relative"},children:[z&&e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",zIndex:10},children:e.jsx("input",{type:"checkbox",checked:_.has(s.recentId||s._id),onChange:n=>{const a=new Set(_),l=s.recentId||s._id;n.target.checked?a.add(l):a.delete(l),G(a)},style:{width:"20px",height:"20px",cursor:"pointer",accentColor:"#16a34a"}})}),e.jsx("div",{className:"theme-thumbnail",children:s.thumbnailUrl?e.jsx("img",{src:s.thumbnailUrl,alt:s.name||"",className:"theme-image",onError:n=>{n.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"><rect width="300" height="200" fill="%23f3f4f6"/><text x="150" y="100" text-anchor="middle" fill="%236b7280" font-family="Arial" font-size="14">No Preview</text></svg>'}}):e.jsx("div",{className:"theme-image-placeholder",children:e.jsx("span",{children:s.name})})}),e.jsxs("div",{className:"theme-info",children:[e.jsxs("div",{className:"theme-header-info",children:[e.jsx("h3",{className:"theme-name",children:s.name}),e.jsxs("div",{className:"theme-rating",children:[e.jsx("div",{className:"stars",children:[...Array(5)].map((n,a)=>e.jsx(Q,{fontSize:"inherit",className:"star filled"},a))}),e.jsx("span",{className:"rating-text",children:"0.0"})]})]}),s.description&&e.jsx("p",{className:"theme-description",children:s.description}),e.jsxs("div",{className:"theme-meta",children:[e.jsx("span",{className:"theme-category",children:s.category||"Custom"}),e.jsx("span",{className:"theme-price",children:"Free"})]})]})]},s._id)))})]}),e.jsxs("div",{className:"themes-section-actions",children:[e.jsx("h2",{className:"themes-section-title themes-section-title--inline",children:"Your creations"}),e.jsxs("button",{onClick:()=>window.open("/themes/builder","_blank","noopener,noreferrer"),className:"themes-btn-primary",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{children:"Create your Own"})]})]}),j.length>0&&e.jsxs(X.Fragment,{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 mt-6",children:"Custom Themes"}),e.jsx(e.Fragment,{children:e.jsx("div",{className:`themes-layout ${r} themes-section-body`,children:j.map(s=>{const t=/^[0-9a-fA-F]{24}$/.test(s._id),n=w.some(a=>{const l=a.isCustomTheme||a._id?.startsWith("custom-"),f=l&&a.customThemeId?a.customThemeId:null;return l&&f===s._id});return e.jsxs("div",{className:"theme-card",style:{position:"relative"},children:[t&&e.jsxs("div",{className:"theme-card-menu",children:[e.jsx("button",{className:"theme-card-menu-button",onClick:a=>{a.stopPropagation(),P(L===s._id?null:s._id)},"aria-label":"Theme options",children:e.jsx(ke,{fontSize:"small"})}),L===s._id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"theme-card-menu-overlay",onClick:()=>P(null)}),e.jsx("div",{className:"theme-card-menu-dropdown",children:e.jsxs("button",{className:"theme-card-menu-item",onClick:a=>{a.stopPropagation(),V({isOpen:!0,themeId:s._id,themeName:s.name}),P(null)},children:[e.jsx(ne,{fontSize:"small",style:{marginRight:"8px"}}),"Update Thumbnail"]})})]})]}),e.jsxs("div",{className:"theme-thumbnail",children:[(()=>{const a=Z[s._id],l=s.thumbnailUrl,f=a||(l?`${l}${l.includes("?")?"&":"?"}v=${Date.now()}`:null);return f?e.jsx("img",{src:f,alt:s.name||"",className:"theme-image",onLoad:()=>{},onError:v=>{v.currentTarget.style.display="none";const m=v.currentTarget.nextElementSibling;m&&(m.style.display="flex")}},`${s._id}-${a?"preview":"server"}`):null})(),e.jsx("div",{className:"theme-image-placeholder",style:{display:Z[s._id]||s.thumbnailUrl?"none":"flex"},children:e.jsx("span",{children:s.name})}),t&&e.jsx("div",{className:"theme-overlay",children:e.jsxs("button",{className:"overlay-btn preview-btn",onClick:()=>H(s._id,s.name,!1,!0),children:[e.jsx(ee,{fontSize:"small"}),e.jsx("span",{children:"Preview"})]})})]}),e.jsxs("div",{className:"theme-info",children:[e.jsx("div",{className:"theme-header-info",children:e.jsx("h3",{className:"theme-name",children:s.name})}),e.jsxs("div",{className:"theme-actions",children:[e.jsx("button",{className:"action-btn primary",onClick:()=>{if(!t){alert("Invalid theme ID. This theme may have been created with an old format. Please delete and recreate it.");return}window.open(`/themes/builder?id=${encodeURIComponent(s._id)}`,"_blank","noopener,noreferrer")},children:"Edit"}),n?e.jsx("button",{className:"action-btn secondary",disabled:!0,style:{backgroundColor:"#16a34a",color:"#ffffff",border:"1px solid #16a34a",cursor:"not-allowed",opacity:.9},children:"Installed"}):e.jsx("button",{className:"action-btn secondary",onClick:async()=>{if(!t){alert("Invalid theme ID. Please recreate this theme.");return}if(!d){alert("Please select a store first.");return}await I(s._id,d)&&(await new Promise(l=>setTimeout(l,500)),await S(d),Y())},children:"Apply theme"}),e.jsxs("button",{className:"action-btn secondary",onClick:()=>ge(s._id),style:{backgroundColor:"#dc2626",color:"#ffffff",border:"1px solid #dc2626"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="#b91c1c",a.currentTarget.style.borderColor="#b91c1c"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="#dc2626",a.currentTarget.style.borderColor="#dc2626"},children:[e.jsx(Te,{fontSize:"small",style:{marginRight:"4px"}}),"Delete"]})]})]})]},s._id)})})})]}),e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 mt-6",children:"All themes"}),e.jsxs("div",{className:`themes-layout ${r}`,children:[E&&e.jsx("div",{className:"no-results",children:e.jsx("div",{className:"no-results-content",children:e.jsx("h3",{children:"Loading themes..."})})}),y&&e.jsx("div",{className:"no-results",children:e.jsx("div",{className:"no-results-content",children:e.jsx("h3",{children:y})})}),ae.map(s=>e.jsxs("div",{className:"theme-card",children:[e.jsxs("div",{className:"theme-thumbnail",children:[e.jsx("img",{src:s.thumbnailUrl||"",alt:s.name,className:"theme-image",onError:t=>{t.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"><rect width="300" height="200" fill="%23f3f4f6"/><text x="150" y="100" text-anchor="middle" fill="%236b7280" font-family="Arial" font-size="14">No Preview</text></svg>'}}),e.jsxs("div",{className:"theme-overlay",children:[e.jsxs("button",{className:"overlay-btn preview-btn",onClick:()=>H(s._id,s.name),children:[e.jsx(ee,{fontSize:"small"}),e.jsx("span",{children:"Preview"})]}),e.jsxs("button",{className:"overlay-btn download-btn",children:[e.jsx(Ce,{fontSize:"small"}),e.jsx("span",{children:"View Details"})]})]})]}),e.jsxs("div",{className:"theme-info",children:[e.jsxs("div",{className:"theme-header-info",children:[e.jsx("h3",{className:"theme-name",children:s.name}),e.jsxs("div",{className:"theme-rating",children:[e.jsx("div",{className:"stars",children:[...Array(5)].map((t,n)=>e.jsx(Q,{fontSize:"inherit",className:"star filled"},n))}),e.jsx("span",{className:"rating-text",children:Number(s.rating?.average||0).toFixed(1)})]})]}),s.description&&e.jsx("p",{className:"theme-description",children:s.description}),e.jsxs("div",{className:"theme-meta",children:[e.jsx("span",{className:"theme-category",children:s.category}),e.jsx("span",{className:"theme-price",children:"Free"})]}),e.jsxs("div",{className:"theme-actions",children:[be(s._id)?e.jsx("button",{className:"action-btn installed",disabled:!0,children:"Installed"}):e.jsx("button",{className:"action-btn primary",onClick:()=>de(s._id),children:"Try theme"}),e.jsx("button",{className:"action-btn secondary",onClick:()=>H(s._id,s.name),children:"View demo"})]})]})]},s._id))]}),ae.length===0&&e.jsx("div",{className:"no-results",children:e.jsxs("div",{className:"no-results-content",children:[e.jsx("h3",{children:"No themes found"}),e.jsx("p",{children:"Try adjusting your search or filter criteria"})]})}),e.jsx(He,{isOpen:p.isOpen,onClose:me,themeId:p.themeId,themeName:p.themeName,isInstalled:p.isInstalled,isCustomTheme:p.isCustomTheme}),e.jsx(We,{isOpen:u.isOpen,onClose:()=>g({isOpen:!1,themeId:""}),themeId:u.themeId}),B.isOpen&&e.jsx("div",{className:"thumbnail-update-modal-overlay",onClick:()=>!U&&V({isOpen:!1,themeId:"",themeName:""}),children:e.jsxs("div",{className:"thumbnail-update-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"thumbnail-update-modal-header",children:[e.jsx("h2",{children:"Update Thumbnail"}),e.jsx("button",{className:"thumbnail-update-modal-close",onClick:()=>!U&&V({isOpen:!1,themeId:"",themeName:""}),disabled:U,children:"×"})]}),e.jsxs("div",{className:"thumbnail-update-modal-content",children:[e.jsxs("p",{children:["Select an image to update the thumbnail for ",e.jsx("strong",{children:B.themeName})]}),e.jsxs("div",{className:"thumbnail-update-modal-upload",children:[e.jsx("input",{type:"file",id:"thumbnail-upload-input",accept:"image/*",onChange:fe,disabled:U,style:{display:"none"}}),e.jsx("label",{htmlFor:"thumbnail-upload-input",className:`thumbnail-upload-label ${U?"disabled":""}`,children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"thumbnail-upload-spinner"}),e.jsx("span",{children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{fontSize:"large"}),e.jsx("span",{children:"Choose Image"}),e.jsx("span",{className:"thumbnail-upload-hint",children:"PNG, JPG, or GIF (max 5MB)"})]})})]})]})]})})]})})};export{Xe as default};
