import{j as e,r as c,b as N,c as w,t as E,u as L,R as k}from"./index-C7S6h9OR.js";import{a as D,D as I}from"./DropdownMenuItem-mg0iuV3h.js";import{G as B}from"./GridBackgroundWrapper-Du1VLjut.js";import{T as p}from"./ToggleSwitch-DRYMOlwW.js";import{F as T}from"./ArrowLeftIcon-C1qOxHB_.js";const M=({location:t,onSelect:n})=>{const o=[t.address,t.apartment,t.city].filter(Boolean).join(", ");return e.jsx(D,{onClick:()=>n(t._id),children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:o})]})})},$=({otherLocations:t,onSelect:n})=>{const[o,r]=c.useState(null),u=!!o,s=c.useCallback(d=>{r(d.currentTarget)},[]),h=c.useCallback(()=>{r(null)},[]),i=c.useCallback(d=>{n(d),h()},[n,h]);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-700 bg-gray-100",children:"Default"}),e.jsx("button",{onClick:s,className:"cursor-pointer px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Change"}),e.jsx(I,{anchorEl:o,open:u,onClose:h,children:t.length===0?e.jsx(D,{disabled:!0,children:"No other locations"}):t.map(d=>e.jsx(M,{location:d,onSelect:i},d._id))})]})},G=({name:t,addressLine:n,locations:o,currentStoreId:r,defaultLocationId:u})=>{const{updateStore:s}=N(),h=c.useCallback(async d=>{if(d!==u)try{await s(r,{defaultLocation:d})}catch(x){console.error("Failed to update default location:",x)}},[u,r,s]),i=o.filter(d=>d._id!==u);return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t}),e.jsx("p",{className:"text-xs text-gray-600",children:n})]}),e.jsx($,{otherLocations:i,onSelect:h})]})},O=({location:t,isDefault:n,onLocationClick:o})=>{const r=c.useCallback(()=>{o(t._id)},[t._id,o]),u=[t.address,t.apartment,t.city,t.state,t.postalCode,t.countryRegion].filter(Boolean).join(", ");return e.jsxs("div",{onClick:r,className:"flex justify-between items-center py-2 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),n&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-700 bg-gray-100",children:"Default"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:u})]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium ${t.isActive?"bg-gray-100 text-gray-700":"bg-gray-100 text-gray-500"}`,children:t.isActive?"Active":"Inactive"})]})},W=({locations:t,defaultLocationId:n,onLocationClick:o})=>t.length===0?e.jsx("p",{className:"text-sm text-gray-500 py-3",children:"No locations found for this store."}):e.jsx("div",{children:t.map(r=>e.jsx(O,{location:r,isDefault:n===r._id,onLocationClick:o},r._id))}),Z=({locations:t,defaultLocationId:n,onLocationClick:o})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between py-2 px-0 border-b border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Location"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Status"})]}),e.jsx(W,{locations:t,defaultLocationId:n,onLocationClick:o})]}),q=({locations:t,defaultLocationId:n,loading:o,error:r,onAddLocation:u,onLocationClick:s})=>e.jsxs("div",{className:"border border-gray-200 bg-white/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900",children:"Location Details"}),e.jsx("button",{onClick:u,className:"cursor-pointer px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Add Location"})]}),r&&e.jsx("div",{className:"mb-3 p-2 bg-gray-50 border border-gray-200 text-xs text-gray-700",children:r}),o?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-400"})}):e.jsx(e.Fragment,{children:e.jsx(Z,{locations:t,defaultLocationId:n,onLocationClick:s})})]}),U=()=>{const{locations:t,updateLocation:n}=w(),{activeStoreId:o,stores:r}=N(),u=E(),s=L(),[h,i]=c.useState(!1),[d,x]=c.useState(!1),[v,f]=c.useState(!1),[a,m]=c.useState(!1),C=u.pathname.split("/").pop(),l=t.find(b=>b._id===C),j=k.useMemo(()=>r.find(g=>g._id===o)?.defaultLocation===l?._id,[r,o,l]);k.useEffect(()=>{l&&(i(j?!0:l.isFulfillmentAllowed),x(l.canShip),f(l.canLocalDeliver),m(l.canPickup))},[l,j]);const S=c.useCallback(()=>{s("/settings/locations")},[s]),A=c.useCallback(async b=>{const g=b;i(g);try{if(!l)return;g?await n(l._id,{isFulfillmentAllowed:!0}):(x(!1),f(!1),m(!1),await n(l._id,{isFulfillmentAllowed:!1,canShip:!1,canLocalDeliver:!1,canPickup:!1}))}catch{i(y=>!y)}},[l,n]),_=c.useCallback(async b=>{const g=b;x(g);try{await n(l._id,{canShip:g})}catch{x(y=>!y)}},[l,n]),F=c.useCallback(async b=>{const g=b;f(g);try{await n(l._id,{canLocalDeliver:g})}catch{f(y=>!y)}},[l,n]),P=c.useCallback(async b=>{const g=b;m(g);try{await n(l._id,{canPickup:g})}catch{m(y=>!y)}},[l,n]);if(!l)return e.jsx("div",{className:"w-full bg-white text-black",children:e.jsxs("div",{className:"px-6 py-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location not found"}),e.jsx("button",{onClick:S,className:"mt-4 px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800 transition-colors",children:"Back"})]})});const R=[l.address,l.apartment,l.city,l.state,l.postalCode,l.countryRegion].filter(Boolean).join(", ");return e.jsx("div",{className:"w-full bg-white text-black",children:e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"bg-white p-6 mb-6 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:S,className:"p-1 hover:bg-gray-100 rounded transition-colors mr-2",children:e.jsx(T,{className:"w-5 h-5 text-gray-700"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Location"})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-lg ${l.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.isActive?"Active":"Inactive"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:R})]}),e.jsxs("div",{className:"bg-white p-6 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Fulfillment"}),e.jsx(p,{checked:h,onChange:A,disabled:j,label:j?"Enable (Default location locked)":"Enable"})]}),j&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 block",children:"This is your default location. To change whether you fulfill online orders from this location, select another default location first."}),(j||h)&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[e.jsx("div",{children:e.jsx(p,{checked:d,onChange:_,label:"Allow Shipping"})}),e.jsx("div",{children:e.jsx(p,{checked:v,onChange:F,label:"Allow Local Delivery"})}),e.jsx("div",{children:e.jsx(p,{checked:a,onChange:P,label:"Allow Pickup In-Store"})})]})]})]})})},V=()=>{const t=L(),{createLocation:n}=w(),{activeStoreId:o}=N(),[r,u]=c.useState(!1),[s,h]=c.useState({name:"",countryRegion:"",address:"",apartment:"",city:"",state:"",postalCode:"",phone:"",canShip:!1,canLocalDeliver:!1,canPickup:!1}),i=c.useCallback((a,m)=>{h(C=>({...C,[a]:m}))},[]),d=c.useCallback(async()=>{if(!o){t("/settings/locations");return}await n({storeId:o,name:s.name,countryRegion:s.countryRegion,address:s.address,apartment:s.apartment||void 0,city:s.city,state:s.state,postalCode:s.postalCode,phone:s.phone,canShip:r?s.canShip:!1,canLocalDeliver:r?s.canLocalDeliver:!1,canPickup:r?s.canPickup:!1,isDefault:!1,isFulfillmentAllowed:r,isActive:!0}),t("/settings/locations")},[o,s,r,n,t]),x=c.useCallback(()=>{t("/settings/locations")},[t]),v=c.useCallback(a=>{u(a)},[]),f=c.useCallback((a,m)=>{i(a,m)},[i]);return e.jsx("div",{className:"w-full bg-white text-black",children:e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"flex justify-end items-center mb-4 gap-3",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg hover:bg-gray-800 transition-colors",children:"Add"})]}),e.jsxs("div",{className:"bg-white p-6 border border-gray-200 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900",children:"Add Location"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Location Name"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>i("name",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Country / Region"}),e.jsx("input",{type:"text",value:s.countryRegion,onChange:a=>i("countryRegion",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Address"}),e.jsx("input",{type:"text",value:s.address,onChange:a=>i("address",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Apartment, suite, etc. (optional)"}),e.jsx("input",{type:"text",value:s.apartment,onChange:a=>i("apartment",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"City"}),e.jsx("input",{type:"text",value:s.city,onChange:a=>i("city",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"State / Province"}),e.jsx("input",{type:"text",value:s.state,onChange:a=>i("state",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"PIN / Postal Code"}),e.jsx("input",{type:"text",value:s.postalCode,onChange:a=>i("postalCode",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Phone Number"}),e.jsx("input",{type:"text",value:s.phone,onChange:a=>i("phone",a.target.value),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 border border-gray-200 rounded-lg mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Fulfillment"}),e.jsx(p,{checked:r,onChange:v,label:"Enable"})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsx(p,{checked:s.canShip,onChange:a=>f("canShip",a),label:"Allow Shipping"})}),e.jsx("div",{children:e.jsx(p,{checked:s.canLocalDeliver,onChange:a=>f("canLocalDeliver",a),label:"Allow Local Delivery"})}),e.jsx("div",{children:e.jsx(p,{checked:s.canPickup,onChange:a=>f("canPickup",a),label:"Allow Pickup In-Store"})})]})]})]})})},X=()=>{const t=L(),{fetchLocationsByStoreId:n,locations:o,loading:r,error:u}=w(),{activeStoreId:s,stores:h}=N();k.useEffect(()=>{s&&n(s)},[s,n]);const i=h.find(m=>m._id===s),d=i?.defaultLocation||null,x=d?o.find(m=>m._id===d):void 0,v=x?[x.address,x.apartment,x.city,x.state,x.postalCode,x.countryRegion].filter(Boolean).join(", "):"",f=c.useCallback(()=>{t("/settings/locations/new")},[t]),a=c.useCallback(m=>{t(`/settings/locations/${m}`)},[t]);return e.jsx(B,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-xl font-medium text-gray-900 mb-3 border-b border-gray-200 pb-3",children:"Locations"}),e.jsxs("div",{className:"border border-gray-200 bg-white/95 p-3 mb-3",children:[e.jsx("h2",{className:"text-sm font-medium mb-1.5 text-gray-900",children:"Default Location"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"This location is used by Ziplofy and apps when no other location is specified."}),d&&x?e.jsx(G,{name:x.name,addressLine:v,locations:o,currentStoreId:i._id,defaultLocationId:d}):e.jsx("p",{className:"text-xs text-gray-600",children:"No default location set."})]}),e.jsx(q,{locations:o,defaultLocationId:d,loading:r,error:u,onAddLocation:f,onLocationClick:a})]})})};export{U as LocationDetailSettings,V as NewLocationSettings,X as default};
