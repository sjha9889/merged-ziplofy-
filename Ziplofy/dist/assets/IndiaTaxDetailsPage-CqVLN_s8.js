import{j as e,p as no,Z as so,a3 as io,aj as ao,ak as lo,al as co,am as xo,an as uo,ao as ho,ap as fo,b as po,h as bo,r as s,Y as pt}from"./index-C7S6h9OR.js";import{B as x,T as i}from"./Box-Cgm3ZkZ8.js";import{B as mo,C as bt}from"./ChevronRight-D9wfCgb-.js";import{L as Ve}from"./Link-BuWh3ioJ.js";import{c as Ke}from"./createSvgIcon-Yi9Vo0kN.js";import{P as je}from"./Paper-DocVmpOE.js";import{S as b}from"./Stack-CYPs5YkO.js";import{C as go}from"./Chip-DNdEoHyQ.js";import{B as h}from"./Button-CdPvNkrY.js";import{I as u}from"./IconButton-BnkdM8yk.js";import{T as jo,a as vo,b as Co,c as ve,d as g,e as yo}from"./TableRow-Bdpb2Dqq.js";import{A as Ce,L as mt,a as gt,D as w,b as M,C as E,c as W,d as P}from"./Close-CrEmJjEJ.js";import{D as Ye,S as Io}from"./Search-GwsDg8Y4.js";import{M as So,F as He,S as Ge}from"./Select-Bus390RW.js";import{M as C}from"./MenuItem-HG7tTLPS.js";import{M as ko}from"./MoreVert-CIl6RWb8.js";import{T as $}from"./TextField-CwtyivJh.js";import{I as J}from"./InputAdornment-CoWoQ4-e.js";import"./DefaultPropsProvider-CZkfTDs_.js";import"./index-CCB_rw4P.js";import"./dividerClasses-Q3ucxvtD.js";const Oo=Ke(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),Qe=Ke(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"})),To=Ke(e.jsx("path",{d:"M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-8 4c0 .55-.45 1-1 1s-1-.45-1-1V8h2zm2-6c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2m4 6c0 .55-.45 1-1 1s-1-.45-1-1V8h2z"})),tr=()=>{const{countryId:l}=no(),{countries:ye,getCountries:Ze}=so(),{getStatesByCountryId:qe,statesByCountry:y,loading:jt}=io(),{taxDefaults:vt,loading:Ct,getTaxDefaultsByCountryId:X}=ao(),{createTaxRate:yt,updateTaxRate:It,deleteTaxRate:Ro,deleteTaxOverridesByStoreAndCountry:St,getTaxRatesByStoreId:_o}=lo(),{getShippingOverridesByStoreAndCountry:U,createShippingOverride:kt,updateShippingOverride:Ot,deleteShippingOverride:Tt}=co(),{getProductOverridesByStoreAndCountry:z,createProductOverride:Rt,deleteProductOverride:_t}=xo(),{createProductOverrideEntry:wt,getProductOverrideEntriesByProductOverrideId:ee,deleteProductOverrideEntry:Mt}=uo(),{getCountryTaxByCountryId:Je,countryTaxMap:V}=ho(),{createCountryTaxOverride:Et,getCountryTaxOverrideByStoreAndCountry:Ie,updateCountryTaxOverrideByStoreAndCountry:Wt,deleteCountryTaxOverrideByStoreAndCountry:Pt,countryTaxOverrideMap:I}=fo(),{activeStoreId:n}=po(),{searchCollections:te}=bo(),[r,zt]=s.useState(null),[Ft,Xe]=s.useState(!1),[At,et]=s.useState(!1),[Lt,S]=s.useState(!1),[v,O]=s.useState("products"),[m,Y]=s.useState(""),[tt,oe]=s.useState(""),[Se,H]=s.useState(null),[ke,F]=s.useState(""),[ot,re]=s.useState([]),[ne,A]=s.useState(!1),[T,L]=s.useState(1),[se,rt]=s.useState(null),[Oe,B]=s.useState("india"),[Te,N]=s.useState(9),[c,nt]=s.useState(null),[wo,Mo]=s.useState([]),[R,G]=s.useState([]),[ie,p]=s.useState(null),[_,st]=s.useState({anchorEl:null,overrideId:null,collectionName:""}),[Re,ae]=s.useState([]),[it,le]=s.useState({}),[Eo,Wo]=s.useState(0),[Bt,de]=s.useState(!1),[ce,xe]=s.useState(null),[Nt,ue]=s.useState(""),[Dt,_e]=s.useState(""),[we,Me]=s.useState(!1),[Ee,We]=s.useState(!1),[Pe,ze]=s.useState(null),[$t,Fe]=s.useState(!1),[he,Ae]=s.useState(null),[at,fe]=s.useState(0),[Ut,lt]=s.useState(!1),[Q,Le]=s.useState(0),[Vt,dt]=s.useState(!1),[j,K]=s.useState({taxRate:0,taxLabel:"",calculationMethod:"instead"});s.useEffect(()=>{Ze({limit:1e3})},[Ze]),s.useEffect(()=>{if(ye.length>0&&l){const t=ye.find(o=>o._id===l);t&&(zt(t),qe(t._id))}},[ye,l,qe]),s.useEffect(()=>{l&&Je(l)},[l,Je]),s.useEffect(()=>{l&&n&&Ie(n,l)},[l,n]),s.useEffect(()=>{r&&r._id&&X(r._id,n||void 0)},[r,n,X]),s.useEffect(()=>{(async()=>{if(r&&r._id&&n)try{const o=typeof r._id=="string"?r._id:r._id.toString(),a=await z(n,o);G(a)}catch(o){console.error("Failed to fetch product overrides:",o)}})()},[r,n,z]),s.useEffect(()=>{(async()=>{if(R.length>0)try{const o={};await Promise.all(R.map(async a=>{try{const d=await ee(a._id);o[a._id]=d}catch(d){console.error(`Failed to fetch entries for product override ${a._id}:`,d),o[a._id]=[]}})),le(o)}catch(o){console.error("Failed to fetch product override entries:",o)}else le({})})()},[R,ee]),s.useEffect(()=>{(async()=>{if(r&&r._id&&n)try{const o=typeof r._id=="string"?r._id:r._id.toString(),a=await U(n,o);ae(a)}catch(o){console.error("Failed to fetch shipping overrides:",o)}})()},[r,n,U]);const D=s.useMemo(()=>{if(!l)return 0;const t=n?I[`${n}-${l}`]:null,o=V[l];return t?t.taxRate:o?o.taxRate:0},[l,n,I,V]),Z=s.useRef(null);s.useEffect(()=>{if(!(!n||!ne))return Z.current&&clearTimeout(Z.current),Z.current=setTimeout(async()=>{try{const t=await te(n,ke||"",T,10);re(t.data),rt(t.pagination)}catch(t){console.error("Failed to search collections:",t),re([])}},300),()=>{Z.current&&clearTimeout(Z.current)}},[ke,T,ne,n,te]),s.useEffect(()=>{ne&&n&&(async()=>{try{const o=await te(n,"",1,10);re(o.data),rt(o.pagination)}catch(o){console.error("Failed to search collections:",o),re([])}})()},[ne,n,te]);const Yt=t=>{Y(t._id),oe(t.title),A(!1),F(""),p(null)},Be=()=>{st({anchorEl:null,overrideId:null,collectionName:""})},ct=t=>{L(t)},xt=(t,o,a,d)=>{xe(t),ue(o),_e(d||""),Me(a),de(!0)},Ht=async()=>{if(ce)try{if(Ee&&Pe){await Mt(ce);const t=await ee(Pe);if(le(o=>({...o,[Pe]:t})),r&&r._id&&n){const o=typeof r._id=="string"?r._id:r._id.toString(),a=await z(n,o);G(a)}}else if(we){if(await Tt(ce),r&&r._id&&n){const t=typeof r._id=="string"?r._id:r._id.toString(),o=await U(n,t);ae(o)}}else if(await _t(ce),r&&r._id&&n){const t=typeof r._id=="string"?r._id:r._id.toString(),o=await z(n,t);G(o)}de(!1),xe(null),ue(""),_e(""),Me(!1),We(!1),ze(null)}catch(t){console.error("Failed to delete override:",t)}},Ne=()=>{de(!1),xe(null),ue(""),_e(""),Me(!1),We(!1),ze(null)},Gt=t=>{Ae(t),fe(t.taxRate),Fe(!0)},Qt=async()=>{if(!(!he||!r||!r._id||!n))try{await Ot(he._id,{taxRate:at});const t=typeof r._id=="string"?r._id:r._id.toString(),o=await U(n,t);ae(o),Fe(!1),Ae(null),fe(0)}catch(t){console.error("Failed to update shipping override:",t)}},De=()=>{Fe(!1),Ae(null),fe(0)},Kt=()=>{if(!l||!n)return;const t=n&&I[`${n}-${l}`]?.taxRate||V[l]?.taxRate||0;Le(t),lt(!0)},pe=()=>{lt(!1),Le(0)},Zt=async()=>{if(!(!l||!n)){if(Q<0||Q>100){alert("Tax rate must be between 0 and 100");return}try{I[`${n}-${l}`]?await Wt(n,l,{taxRate:Q}):await Et({storeId:n,countryId:l,taxRate:Q}),await Ie(n,l,{force:!0}),pe()}catch(t){console.error("Failed to update country tax override:",t);const o=t?.response?.data?.message||t?.message||"Failed to update country tax override";alert(o)}}},qt=()=>{dt(!0)},be=()=>{dt(!1)},Jt=async()=>{if(!(!l||!n))try{await Pt(n,l),await Ie(n,l,{force:!0}),be()}catch(t){console.error("Failed to reset country tax override:",t);const o=t?.response?.data?.message||t?.message||"Failed to reset country tax override";alert(o)}},ut=t=>{if(!t.stateId)return"India";if(typeof t.stateId=="object"&&t.stateId.name)return t.stateId.name;if(r&&y[r._id]){const o=y[r._id].find(a=>a._id===t.stateId);return o?o.name:"Unknown"}return"Unknown"},ht=t=>{if(!t||t==="india")return"India";if(r&&y[r._id]){const o=y[r._id].find(a=>a._id===t);return o?o.name:"Unknown"}return"Unknown"},Xt=t=>{nt(t),K({taxRate:t.taxRate,taxLabel:t.taxLabel||"IGST",calculationMethod:t.calculationMethod||"instead"}),Xe(!0)},me=()=>{Xe(!1),nt(null),K({taxRate:0,taxLabel:"",calculationMethod:"instead"})},eo=async()=>{if(!(!c||!r||!n))try{const t=typeof r._id=="string"?r._id:r._id.toString(),o=c.stateId?typeof c.stateId=="object"&&c.stateId?._id?c.stateId._id:typeof c.stateId=="string"?c.stateId:null:null,a=c.isOverride===!0||c.overrideId,f=o!=null?j.calculationMethod:null;a&&c.overrideId?await It(c.overrideId,{taxRate:j.taxRate,taxLabel:j.taxLabel,calculationMethod:f}):await yt({storeId:n,countryId:t,stateId:o,taxRate:j.taxRate,taxLabel:j.taxLabel,calculationMethod:f}),await X(t,n),me()}catch(t){console.error("Failed to save tax override:",t);const o=t?.response?.data?.message||t?.response?.data?.error||t?.message||"Failed to save tax override. Please try again.";alert(o)}},to=(t,o)=>{const a=o.toFixed(3);switch(t){case"added":return`Added to ${a}% federal tax`;case"instead":return`Instead of ${a}% federal tax`;case"compounded":return`Compounded on top of ${a}% federal tax`;default:return"â€”"}},oo=()=>{et(!0)},ge=()=>{et(!1)},ro=async()=>{if(!(!r||!r._id||!n))try{const t=typeof r._id=="string"?r._id:r._id.toString();await St(n,t);const o=await X(t,n);ge()}catch(t){console.error("Failed to reset tax rates:",t)}},$e=t=>{if(!t)return"";if(typeof t=="object"&&"name"in t)return t.name;if(r&&y[r._id]){const o=y[r._id].find(a=>a._id===t);return o?o.name:""}return""},ft=vt.filter(t=>t.stateId&&t.stateId!==null).map(t=>({...t,stateName:$e(t.stateId)})).sort((t,o)=>{const a=t.stateName.toLowerCase(),d=o.stateName.toLowerCase();return a.localeCompare(d)});return e.jsxs(x,{sx:{maxWidth:1200,mx:"auto",py:4},children:[e.jsxs(mo,{sx:{mb:2},separator:e.jsx(bt,{fontSize:"small"}),children:[e.jsxs(Ve,{component:pt,to:"/settings/taxes-and-duties",sx:{display:"flex",alignItems:"center",color:"#6b7280",textDecoration:"none","&:hover":{color:"#111827"}},children:[e.jsx(To,{sx:{mr:.5,fontSize:20}}),"Taxes and duties"]}),e.jsx(i,{color:"text.primary",sx:{fontWeight:500},children:r?.name||"Loading..."})]}),e.jsx(i,{variant:"h4",sx:{fontWeight:700,color:"#111827",mb:3},children:r?.name||"Loading..."}),l&&(V[l]||n&&I[`${n}-${l}`])&&e.jsx(je,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"#fff"},children:e.jsxs(b,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(i,{sx:{minWidth:120,color:"#111827",fontWeight:500},children:r?.name||"Loading..."}),e.jsxs(i,{sx:{color:"#111827",fontWeight:500},children:[(n&&I[`${n}-${l}`]?.taxRate||V[l]?.taxRate||0).toFixed(2),"%"]}),n&&I[`${n}-${l}`]&&e.jsx(go,{label:"Overridden",size:"small",sx:{backgroundColor:"#fef3c7",color:"#92400e",fontWeight:500,fontSize:"0.75rem",height:24}}),e.jsx(x,{sx:{flex:1}}),n&&I[`${n}-${l}`]&&e.jsx(h,{variant:"outlined",size:"small",onClick:qt,sx:{textTransform:"none",borderColor:"#d1d5db",color:"#111827",fontSize:"0.75rem",px:2,"&:hover":{borderColor:"#9ca3af",backgroundColor:"#f3f4f6"}},children:"Reset to default"}),e.jsx(u,{size:"small",onClick:Kt,sx:{color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6",color:"#111827"}},children:e.jsx(Qe,{fontSize:"small"})})]})}),e.jsxs(je,{elevation:0,sx:{p:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"#fff"},children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#111827"},children:"Base taxes"}),e.jsx(h,{variant:"outlined",onClick:oo,sx:{textTransform:"none",borderColor:"#d1d5db",color:"#111827","&:hover":{borderColor:"#9ca3af",backgroundColor:"#f3f4f6"}},children:"Reset to default tax rates"})]}),e.jsx(i,{variant:"body1",sx:{fontWeight:600,color:"#111827",mb:2},children:"Regions"}),e.jsx(jo,{children:e.jsxs(vo,{children:[e.jsx(Co,{children:e.jsxs(ve,{children:[e.jsx(g,{sx:{fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb"},children:"Region"}),e.jsx(g,{sx:{fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb"},children:"Tax rate"}),e.jsx(g,{sx:{fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb"},children:"Tax type"}),e.jsx(g,{sx:{fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb"},children:"Federal tax override"}),e.jsx(g,{sx:{fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb",width:80},children:"Actions"})]})}),e.jsx(yo,{children:jt||Ct?e.jsx(ve,{children:e.jsx(g,{colSpan:5,sx:{textAlign:"center",py:4,color:"#6b7280"},children:"Loading tax defaults..."})}):ft.length===0?e.jsx(ve,{children:e.jsx(g,{colSpan:5,sx:{textAlign:"center",py:4,color:"#6b7280"},children:"No tax defaults found"})}):ft.map(t=>{const o=t.stateName||$e(t.stateId),a=t.calculationMethod||"instead";return e.jsxs(ve,{children:[e.jsx(g,{sx:{borderBottom:"1px solid #f3f4f6",color:"#111827"},children:o}),e.jsxs(g,{sx:{borderBottom:"1px solid #f3f4f6",color:"#111827"},children:[t.taxRate.toFixed(3),"%"]}),e.jsx(g,{sx:{borderBottom:"1px solid #f3f4f6",color:"#111827"},children:t.taxLabel||"IGST"}),e.jsx(g,{sx:{borderBottom:"1px solid #f3f4f6",color:"#111827"},children:to(a,D)}),e.jsx(g,{sx:{borderBottom:"1px solid #f3f4f6"},children:e.jsx(u,{size:"small",onClick:()=>Xt(t),sx:{color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6",color:"#111827"}},children:e.jsx(Qe,{fontSize:"small"})})})]},t._id)})})]})})]}),e.jsxs(x,{sx:{mt:4},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#111827",mb:2},children:"Tax rates and exemptions"}),e.jsxs(je,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"#fff"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(i,{variant:"body1",sx:{fontWeight:600,color:"#111827"},children:"Shipping overrides"}),e.jsx(u,{size:"small",onClick:()=>{O("shipping"),S(!0),p(null)},sx:{border:"1px solid #e5e7eb",borderRadius:1,color:"#111827","&:hover":{backgroundColor:"#f3f4f6",borderColor:"#d1d5db"}},"aria-label":"add shipping override",children:e.jsx(Ce,{fontSize:"small"})})]}),Re.length===0?e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:2},children:"No shipping overrides"}):e.jsx(b,{spacing:2,sx:{mb:2},children:Re.map(t=>{const a=ut(t);return e.jsxs(b,{direction:"row",alignItems:"center",spacing:2,sx:{p:2,border:"1px solid #f3f4f6",borderRadius:1,backgroundColor:"#fafafa"},children:[e.jsx(i,{sx:{minWidth:120,color:"#111827",fontWeight:500},children:a}),e.jsxs(i,{sx:{color:"#111827",fontWeight:500},children:[t.taxRate,"%"]}),e.jsxs(i,{sx:{color:"#6b7280",flex:1},children:["instead of ",D.toFixed(3),"% federal tax"]}),e.jsx(u,{size:"small",onClick:()=>Gt(t),sx:{color:"#6b7280","&:hover":{color:"#2563eb",backgroundColor:"#eff6ff"}},children:e.jsx(Qe,{fontSize:"small"})}),e.jsx(u,{size:"small",onClick:()=>xt(t._id,a,!0),sx:{color:"#6b7280","&:hover":{color:"#dc2626",backgroundColor:"#fee2e2"}},children:e.jsx(Ye,{fontSize:"small"})})]},t._id)})}),e.jsxs(x,{onClick:()=>{O("shipping"),H(null),S(!0),p(null),B("india"),N(9)},sx:{display:"flex",alignItems:"center",gap:1,border:"1px solid #e5e7eb",borderRadius:1.5,px:2,py:1.25,cursor:"pointer",color:"#111827","&:hover":{backgroundColor:"#f9fafb",borderColor:"#d1d5db"}},children:[e.jsx(Ce,{sx:{fontSize:20}}),e.jsx(i,{sx:{fontWeight:500},children:"Add override"})]})]}),e.jsxs(So,{anchorEl:_.anchorEl,open:!!_.anchorEl,onClose:Be,children:[e.jsxs(C,{onClick:()=>{const t=R.find(o=>(typeof o.collectionId=="object"?o.collectionId.title:o.collectionId||"")===_.collectionName);t&&(H(_.collectionName||null),Y(t._id)),O("shipping"),S(!0),p(null),B("india"),N(9),Be()},children:[e.jsx(mt,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(gt,{primary:"Add override"})]}),e.jsxs(C,{onClick:()=>{_.overrideId&&(xt(_.overrideId,"",!1,_.collectionName),Be())},children:[e.jsx(mt,{children:e.jsx(Ye,{fontSize:"small"})}),e.jsx(gt,{primary:"Delete override"})]})]}),e.jsxs(je,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e5e7eb",backgroundColor:"#fff"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(i,{variant:"body1",sx:{fontWeight:600,color:"#111827"},children:"Product overrides"}),e.jsx(u,{size:"small",onClick:()=>{O("products"),H(null),S(!0),p(null)},sx:{border:"1px solid #e5e7eb",borderRadius:1,color:"#111827","&:hover":{backgroundColor:"#f3f4f6",borderColor:"#d1d5db"}},"aria-label":"add product override",children:e.jsx(Ce,{fontSize:"small"})})]}),R.length===0?e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:2},children:"No product overrides"}):e.jsx(b,{spacing:1.5,sx:{mb:2},children:R.map(t=>{const o=typeof t.collectionId=="object"?t.collectionId.title:t.collectionId||"Unknown Collection",a=it[t._id]||[];return e.jsxs(x,{sx:{border:"1px solid #e5e7eb",borderRadius:1.5,overflow:"hidden"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,backgroundColor:"#f9fafb"},children:[e.jsx(i,{component:"span",sx:{color:"#2563eb",fontWeight:600,cursor:"pointer","&:hover":{textDecoration:"underline"}},children:o}),e.jsx(b,{direction:"row",alignItems:"center",spacing:1,children:e.jsx(u,{size:"small",sx:{color:"#6b7280"},"aria-label":"more actions",onClick:d=>st({anchorEl:d.currentTarget,overrideId:t._id,collectionName:o}),children:e.jsx(ko,{fontSize:"small"})})})]}),a.length>0&&e.jsx(x,{sx:{p:2,pt:1},children:e.jsx(b,{spacing:1.5,children:a.map(d=>{const f=d.stateId?typeof d.stateId=="object"&&d.stateId.name?d.stateId.name:"Unknown State":"India";return e.jsxs(b,{direction:"row",alignItems:"center",spacing:2,sx:{p:2,border:"1px solid #f3f4f6",borderRadius:1,backgroundColor:"#fafafa"},children:[e.jsx(i,{sx:{minWidth:120,color:"#111827",fontWeight:500},children:f}),e.jsxs(i,{sx:{color:"#111827",fontWeight:500},children:[d.taxRate,"%"]}),e.jsxs(i,{sx:{color:"#6b7280",flex:1},children:["instead of ",D.toFixed(3),"% federal tax"]}),e.jsx(u,{size:"small",onClick:()=>{xe(d._id),ue(f),We(!0),ze(t._id),de(!0)},sx:{color:"#6b7280","&:hover":{color:"#dc2626",backgroundColor:"#fee2e2"}},children:e.jsx(Ye,{fontSize:"small"})})]},d._id)})})})]},t._id)})})]}),e.jsx(x,{sx:{textAlign:"center",mt:3},children:e.jsx(Ve,{href:"#",underline:"hover",sx:{color:"#6b7280",fontSize:"0.875rem","&:hover":{color:"#111827"}},children:"Learn more about sales tax"})})]}),e.jsxs(w,{open:Ft,onClose:me,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:["Edit Tax Default",e.jsx(u,{"aria-label":"close",onClick:me,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsxs(b,{spacing:3,children:[e.jsxs(x,{children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1,fontWeight:500},children:"Region"}),e.jsx(i,{variant:"body1",sx:{color:"#111827",fontWeight:500},children:c&&(c.stateName||(c.stateId===null?"India":$e(c.stateId)))})]}),e.jsx($,{label:"Tax rate",type:"number",value:j.taxRate,onChange:t=>K({...j,taxRate:parseFloat(t.target.value)||0}),InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(i,{sx:{color:"#6b7280"},children:"%"})})},inputProps:{step:.001,min:0,max:100},fullWidth:!0,size:"small"}),e.jsx($,{label:"Tax type",value:j.taxLabel,onChange:t=>K({...j,taxLabel:t.target.value}),fullWidth:!0,size:"small",disabled:c&&(!c.stateId||c.stateId===null)}),c&&c.stateId&&c.stateId!==null&&e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1,fontWeight:500},children:"Federal tax override"}),e.jsxs(Ge,{value:j.calculationMethod||"instead",onChange:t=>K({...j,calculationMethod:t.target.value}),displayEmpty:!0,children:[e.jsxs(C,{value:"added",children:["Added to ",D.toFixed(3),"% federal tax"]}),e.jsxs(C,{value:"instead",children:["Instead of ",D.toFixed(3),"% federal tax"]}),e.jsxs(C,{value:"compounded",children:["Compounded on top of ",D.toFixed(3),"% federal tax"]})]})]})]})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:me,sx:{textTransform:"none",color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:eo,sx:{textTransform:"none",backgroundColor:"#6b7280",color:"#fff","&:hover":{backgroundColor:"#4b5563"}},children:"Save changes"})]})]}),e.jsxs(w,{open:At,onClose:ge,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:["Reset to default tax rates",e.jsx(u,{"aria-label":"close",onClick:ge,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsx(i,{variant:"body1",sx:{color:"#111827"},children:"Are you sure you want to reset all your taxes for India? This will set both the country tax and all region taxes to their current default values."})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:ge,sx:{textTransform:"none",color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:ro,sx:{textTransform:"none",backgroundColor:"#dc2626",color:"#fff","&:hover":{backgroundColor:"#b91c1c"}},children:"Reset tax rates"})]})]}),e.jsxs(w,{open:Lt,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:[v==="shipping"?Se?`Add region to override for ${Se}`:"Add region to override for Shipping":"Add tax override for India",e.jsx(u,{"aria-label":"close",onClick:()=>{S(!1),O("products"),Y(""),oe(""),F(""),A(!1),L(1),B("india"),N(9),p(null),H(null)},sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsxs(b,{spacing:3,children:[v==="products"&&e.jsxs(x,{sx:{position:"relative"},children:[e.jsxs(i,{variant:"body2",sx:{color:"#6b7280",mb:1.5,fontWeight:400},children:["Select a collection to apply the tax override to. You can also"," ",e.jsx(Ve,{component:pt,to:"http://admin.localhost:5173/products/collections/new",target:"_blank",sx:{color:"#2563eb",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"create a new collection"}),"."]}),e.jsx(He,{fullWidth:!0,size:"small",sx:{mt:1},children:e.jsxs(Ge,{value:m,onOpen:()=>{A(!0),L(1)},onClose:()=>{A(!1),F("")},displayEmpty:!0,renderValue:()=>tt||"Select collection",sx:{backgroundColor:"#fff","& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#9ca3af"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#2563eb"}},MenuProps:{PaperProps:{sx:{maxHeight:400,mt:.5}}},children:[e.jsx(x,{sx:{p:1,borderBottom:"1px solid #e5e7eb"},children:e.jsx($,{fullWidth:!0,size:"small",placeholder:"Search collections",value:ke,onChange:t=>{F(t.target.value),L(1)},onClick:t=>t.stopPropagation(),onKeyDown:t=>t.stopPropagation(),InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(Io,{sx:{color:"#6b7280",fontSize:20}})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#fff","& fieldset":{borderColor:"#2563eb"},"&:hover fieldset":{borderColor:"#2563eb"},"&.Mui-focused fieldset":{borderColor:"#2563eb"}}}})}),ot.length===0?e.jsx(C,{disabled:!0,sx:{justifyContent:"center",py:2},children:e.jsx(i,{sx:{color:"#6b7280"},children:"No collections found"})}):e.jsxs(e.Fragment,{children:[ot.map(t=>e.jsx(C,{value:t._id,onClick:()=>Yt(t),selected:m===t._id,sx:{"&.Mui-selected":{backgroundColor:"#f3f4f6","&:hover":{backgroundColor:"#e5e7eb"}}},children:t.title},t._id)),se&&se.totalPages>1&&e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:1,py:.5,borderTop:"1px solid #e5e7eb"},children:[e.jsx(u,{size:"small",disabled:T===1,onClick:t=>{t.stopPropagation(),ct(T-1)},sx:{color:"#6b7280","&:disabled":{color:"#d1d5db"}},children:e.jsx(Oo,{})}),e.jsxs(i,{variant:"body2",sx:{color:"#6b7280"},children:["Page ",T," of ",se.totalPages]}),e.jsx(u,{size:"small",disabled:T===se.totalPages,onClick:t=>{t.stopPropagation(),ct(T+1)},sx:{color:"#6b7280","&:disabled":{color:"#d1d5db"}},children:e.jsx(bt,{})})]})]})]})}),ie&&e.jsx(i,{variant:"body2",sx:{color:"#dc2626",mt:1},children:ie})]}),v==="shipping"&&ie&&e.jsx(x,{children:e.jsx(i,{variant:"body2",sx:{color:"#dc2626",mt:1},children:ie})}),v==="shipping"&&e.jsxs(b,{direction:"row",spacing:2,children:[e.jsxs(x,{sx:{flex:1},children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1,fontWeight:500},children:"Location"}),e.jsx(He,{fullWidth:!0,size:"small",children:e.jsxs(Ge,{value:Oe,onChange:t=>{B(t.target.value),p(null)},sx:{backgroundColor:"#fff","& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#9ca3af"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#2563eb"}},children:[e.jsx(C,{value:"india",children:"India"}),r&&y[r._id]&&y[r._id].map(t=>e.jsx(C,{value:t._id,children:t.name},t._id))]})})]}),e.jsxs(x,{sx:{flex:1},children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1,fontWeight:500},children:"Tax rate"}),e.jsx($,{type:"number",value:Te,onChange:t=>N(parseFloat(t.target.value)||0),InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(i,{sx:{color:"#6b7280"},children:"%"})})},inputProps:{step:.001,min:0,max:100},fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#fff","& fieldset":{borderColor:"#d1d5db"},"&:hover fieldset":{borderColor:"#9ca3af"},"&.Mui-focused fieldset":{borderColor:"#2563eb"}}}})]})]}),v==="products"&&e.jsx(i,{variant:"body2",sx:{color:"#6b7280"},children:"The selected collection will use the default India tax rates. No extra inputs needed."})]})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:()=>{S(!1),O("products"),Y(""),oe(""),F(""),A(!1),L(1),B("india"),N(9),p(null)},sx:{textTransform:"none",color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",disabled:v==="products"&&!m,onClick:async()=>{if(!(!r||!r._id||!n))try{const t=typeof r._id=="string"?r._id:r._id.toString();if(v==="shipping"){const o=Oe==="india"?null:Oe;if(Se&&m){if((it[m]||[]).some(k=>{const Ue=typeof k.stateId=="object"&&k.stateId!==null?k.stateId._id:k.stateId;return o===null?Ue==null:Ue===o})){const k=o===null||o==="india"?"India":ht(o);p(`A product override entry already exists for ${k}. You cannot add the same state twice for this product override.`);return}await wt({productOverrideId:m,stateId:o,taxRate:Te,isActive:!0});const f=await ee(m);le(k=>({...k,[m]:f}));const q=await z(n,t);G(q)}else{if(Re.some(f=>{const q=typeof f.stateId=="object"&&f.stateId!==null?f.stateId._id:f.stateId;return o===null?q==null:q===o})){const f=o===null||o==="india"?"India":ht(o);p(`A shipping override already exists for ${f}. You cannot add the same state twice for this store and country.`);return}await kt({storeId:n,countryId:t,stateId:o,taxRate:Te,isActive:!0});const d=await U(n,t);ae(d)}}else{if(R.some(d=>(typeof d.collectionId=="object"?d.collectionId._id:d.collectionId)===m)){p("This collection already has a product override for India.");return}await Rt({storeId:n,countryId:t,collectionId:m});const a=await z(n,t);G(a)}S(!1),O("products"),Y(""),oe(""),F(""),A(!1),L(1),B("india"),N(9),p(null),H(null)}catch(t){console.error("Failed to create override:",t);const o=t?.response?.data?.error||t?.message||"Failed to create override. Please try again.";p(o)}},sx:{textTransform:"none",backgroundColor:v==="products"&&!m?"#d1d5db":"#111827",color:"#fff","&:hover":{backgroundColor:v==="products"&&!m?"#d1d5db":"#000000"},"&.Mui-disabled":{backgroundColor:"#d1d5db",color:"#9ca3af"}},children:v==="shipping"?"Add region to override":"Add override"})]})]}),e.jsxs(w,{open:Bt,onClose:Ne,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:[we||Ee?"Delete region from override":"Delete entire override",e.jsx(u,{"aria-label":"close",onClick:Ne,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsx(i,{variant:"body1",sx:{color:"#111827"},children:we||Ee?e.jsxs(e.Fragment,{children:["Are you sure you want to remove ",e.jsx("strong",{children:Nt})," from the list of regions this override applies to? This action cannot be reversed."]}):e.jsxs(e.Fragment,{children:["Are you sure you want to remove ",e.jsx("strong",{children:Dt}),"? This action cannot be reversed."]})})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:Ne,sx:{textTransform:"none",color:"#6b7280",border:"1px solid #d1d5db","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Ht,sx:{textTransform:"none",backgroundColor:"#dc2626",color:"#fff","&:hover":{backgroundColor:"#b91c1c"}},children:"Delete"})]})]}),e.jsxs(w,{open:$t,onClose:De,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:["Edit shipping override",e.jsx(u,{"aria-label":"close",onClick:De,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:he&&e.jsxs(b,{spacing:3,children:[e.jsxs(x,{children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1},children:"Location"}),e.jsx(i,{variant:"body1",sx:{color:"#111827",fontWeight:500},children:ut(he)})]}),e.jsxs(x,{children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1},children:"Tax rate"}),e.jsx($,{type:"number",value:at,onChange:t=>fe(parseFloat(t.target.value)||0),fullWidth:!0,InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(i,{sx:{color:"#6b7280"},children:"%"})})},inputProps:{step:.001,min:0,max:100},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#fff"}}})]})]})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:De,sx:{textTransform:"none",color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Qt,sx:{textTransform:"none",backgroundColor:"#2563eb",color:"#fff","&:hover":{backgroundColor:"#1d4ed8"}},children:"Done"})]})]}),e.jsxs(w,{open:Ut,onClose:pe,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:["Edit country tax",e.jsx(u,{"aria-label":"close",onClick:pe,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsxs(b,{spacing:3,children:[e.jsxs(x,{children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1},children:"Country"}),e.jsx(i,{variant:"body1",sx:{color:"#111827",fontWeight:500},children:r?.name||"Loading..."})]}),e.jsxs(x,{children:[e.jsx(i,{variant:"body2",sx:{color:"#6b7280",mb:1},children:"Tax rate"}),e.jsx($,{type:"number",value:Q,onChange:t=>Le(parseFloat(t.target.value)||0),fullWidth:!0,InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(i,{sx:{color:"#6b7280"},children:"%"})})},inputProps:{step:.01,min:0,max:100},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#fff"}}})]})]})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:pe,sx:{textTransform:"none",color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Zt,sx:{textTransform:"none",backgroundColor:"#2563eb",color:"#fff","&:hover":{backgroundColor:"#1d4ed8"}},children:"Save"})]})]}),e.jsxs(w,{open:Vt,onClose:be,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(M,{sx:{m:0,p:3,pb:2,fontWeight:600,color:"#111827"},children:["Reset to default",e.jsx(u,{"aria-label":"close",onClick:be,sx:{position:"absolute",right:16,top:16,color:"#6b7280","&:hover":{backgroundColor:"#f3f4f6"}},children:e.jsx(E,{})})]}),e.jsx(W,{sx:{px:3,pt:2,pb:2},children:e.jsx(i,{variant:"body1",sx:{color:"#111827"},children:"Are you sure you want to reset the country tax to default? This will delete your overridden value and the default value will be used."})}),e.jsxs(P,{sx:{p:3,pt:2},children:[e.jsx(h,{onClick:be,sx:{textTransform:"none",color:"#6b7280",border:"1px solid #d1d5db","&:hover":{backgroundColor:"#f3f4f6"}},children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Jt,sx:{textTransform:"none",backgroundColor:"#dc2626",color:"#fff","&:hover":{backgroundColor:"#b91c1c"}},children:"Reset to default"})]})]})]})};export{tr as default};
