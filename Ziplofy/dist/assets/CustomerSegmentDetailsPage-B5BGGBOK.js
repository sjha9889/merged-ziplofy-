import{j as e,r as s,p as B,u as O,aB as _,C as L,B as R,b as T}from"./index-C7S6h9OR.js";import{M as N}from"./Modal-DsfhGJdg.js";import{F as P}from"./TrashIcon-B2-WJkmb.js";import{F as W}from"./ArrowLeftIcon-C1qOxHB_.js";import"./index-CCB_rw4P.js";const I=({isOpen:t,onClose:r,selectedCustomerId:n,onCustomerChange:l,customers:o,canSave:i,onSave:m})=>e.jsx(N,{open:t,onClose:r,title:"Add customer to segment",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!i,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Save"})]}),children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customer-select",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Customer"}),e.jsxs("select",{id:"customer-select",value:n,onChange:l,className:"w-full px-3 py-1.5 text-base border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors bg-white",children:[e.jsx("option",{value:"",children:"Select a customer"}),o.map(a=>e.jsxs("option",{value:a._id,children:[`${a.firstName} ${a.lastName}`," - ",a.email]},a._id))]})]})}),Y=({entry:t,onDelete:r})=>{const n=s.useCallback(o=>typeof o=="string"?o:o.fullName||`${o.firstName||""} ${o.lastName||""}`.trim(),[]),l=s.useCallback(()=>{r(t)},[t,r]);return e.jsxs("div",{className:"flex justify-between items-center py-3 px-4 hover:bg-gray-50 transition-colors group border-b border-gray-100 last:border-b-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n(t.customerId)}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("button",{onClick:l,className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100","aria-label":"delete",children:e.jsx(P,{className:"w-4 h-4 text-gray-500 hover:text-red-600 transition-colors"})})]})]})},q=({entries:t,onDelete:r})=>e.jsx("div",{className:"divide-y divide-gray-200",children:t.map(n=>e.jsx(Y,{entry:n,onDelete:r},n._id))}),z=({isOpen:t,onClose:r,entry:n,onConfirm:l})=>{const o=s.useCallback(a=>typeof a=="string"?a:a.fullName||`${a.firstName||""} ${a.lastName||""}`.trim(),[]),i=s.useCallback(()=>{l(),r()},[l,r]);if(!t||!n)return null;const m=o(n.customerId);return e.jsx(N,{open:t,onClose:r,title:"Delete Customer",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"No"}),e.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 transition-colors",children:"Yes"})]}),children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Do you really want to delete ",e.jsx("span",{className:"font-medium",children:m})," from this segment?"]})})},U=()=>{const{id:t}=B(),r=O(),{entries:n,fetchEntriesBySegmentId:l,createEntry:o,deleteEntry:i,loading:m}=_(),{customers:a,fetchCustomersByStoreId:j}=L(),{segments:x,fetchSegmentsByStoreId:C}=R(),{activeStoreId:c}=T(),[v,h]=s.useState(!1),[d,b]=s.useState(""),[w,f]=s.useState(!1),[g,p]=s.useState(null),S=s.useMemo(()=>!!d&&!!t,[d,t]),y=s.useMemo(()=>x.find(u=>u._id===t),[x,t]);s.useEffect(()=>{t&&l(t).catch(()=>{})},[t,l]),s.useEffect(()=>{c&&a.length===0&&j(c).catch(()=>{})},[c,a.length,j]),s.useEffect(()=>{c&&x.length===0&&C(c).catch(()=>{})},[c,x.length,C]);const k=s.useCallback(()=>{h(!0)},[]),D=s.useCallback(()=>{h(!1),b("")},[]),E=s.useCallback(u=>{b(u.target.value)},[]),M=s.useCallback(async()=>{if(!(!t||!d))try{await o(t,d),b(""),h(!1)}catch{}},[t,d,o]),A=s.useCallback(u=>{p(u),f(!0)},[]),F=s.useCallback(()=>{f(!1),p(null)},[]),$=s.useCallback(async()=>{if(g)try{await i(g._id),f(!1),p(null)}catch{}},[g,i]);return e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>r("/customers/segments"),className:"inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 mb-2 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Back to segments"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:y?.name||"Segment details"}),y?.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:y.description})]}),e.jsx("button",{onClick:k,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Add Customer"})]})]}),e.jsx("div",{className:"max-w-6xl",children:m?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-8 shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Loading customers..."})}):n.length===0?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 p-8 shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No customers in this segment yet"})}):e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:e.jsx(q,{entries:n,onDelete:A})})}),e.jsx(I,{isOpen:v,onClose:D,selectedCustomerId:d,onCustomerChange:E,customers:a,canSave:S,onSave:M}),e.jsx(z,{isOpen:w,onClose:F,entry:g,onConfirm:$})]})})};export{U as default};
