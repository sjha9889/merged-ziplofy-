import{b as ee,c as te,n as ae,r as a,j as e,g as se,o as ne}from"./index-C7S6h9OR.js";import{F as le}from"./ArrowPathIcon-WqkWOGbf.js";import{F as P}from"./FunnelIcon-C0EmTLgY.js";const ce=()=>{const{activeStoreId:j}=ee(),{locations:d,fetchLocationsByStoreId:A}=te(),{inventoryLevels:i,fetchByLocation:p,updateById:x,loading:O}=ae(),[r,U]=a.useState(""),[u,$]=a.useState(""),[N,_]=a.useState(null),[h,q]=a.useState(null),[o,y]=a.useState(null),[w,M]=a.useState(!1),[m,C]=a.useState(null),[S,R]=a.useState(0),[k,F]=a.useState(!1),[b,I]=a.useState(null),[E,B]=a.useState(0),[H,T]=a.useState(!1);a.useEffect(()=>{j&&A(j)},[j,A]),a.useEffect(()=>{r&&p(r)},[r,p]),a.useEffect(()=>{if(!r&&d&&d.length>0){const t=d.find(s=>s.isDefault)||d[0];t?._id&&U(t._id)}},[d,r]);const V=a.useMemo(()=>{if(!u.trim())return i;const t=u.toLowerCase();return i.filter(s=>s.variantId.sku.toLowerCase().includes(t)||(s.variantId.productId.title||"").toLowerCase().includes(t))},[u,i]),Q=a.useCallback(t=>{U(t)},[]),z=a.useCallback(()=>{r&&p(r)},[r,p]),D=a.useCallback((t,s)=>{_(t.currentTarget),q(s);const l=i.find(n=>n._id===s);y(l?{...l.unavailable}:{damaged:0,qualityControl:0,safetyStock:0,other:0})},[i]),f=a.useCallback(()=>{_(null),q(null),y(null)},[]),v=a.useCallback((t,s)=>{const l=Math.max(0,Number(s)||0);y(n=>n&&{...n,[t]:l})},[]),K=a.useCallback(async()=>{if(!(!h||!o))try{M(!0);const t=i.find(g=>g._id===h),s=t?.committed??0,l=t?.onHand??0,n=(o.damaged||0)+(o.qualityControl||0)+(o.safetyStock||0)+(o.other||0),c=Math.max(0,l-s-n);await x(h,{unavailable:o,available:c}),f()}finally{M(!1)}},[h,o,i,x,f]),X=a.useCallback((t,s)=>{C(t),R(s??0)},[]),Y=a.useCallback(()=>{C(null)},[]),G=a.useCallback(async()=>{if(m)try{F(!0);const t=i.find(L=>L._id===m),s=t?.committed??0,l=t?.unavailable||{damaged:0,qualityControl:0,safetyStock:0,other:0},n=(l.damaged||0)+(l.qualityControl||0)+(l.safetyStock||0)+(l.other||0),c=Math.max(0,S||0),g=Math.max(0,c+s+n);await x(m,{available:c,onHand:g}),C(null)}finally{F(!1)}},[m,S,i,x]),J=a.useCallback((t,s)=>{I(t),B(s??0)},[]),W=a.useCallback(()=>{I(null)},[]),Z=a.useCallback(async()=>{if(b)try{T(!0);const t=i.find(L=>L._id===b),s=t?.committed??0,l=t?.unavailable||{damaged:0,qualityControl:0,safetyStock:0,other:0},n=(l.damaged||0)+(l.qualityControl||0)+(l.safetyStock||0)+(l.other||0),c=Math.max(0,E||0),g=Math.max(0,c-s-n);await x(b,{onHand:c,available:g}),I(null)}finally{T(!1)}},[b,E,i,x]);return e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{className:"pl-3 border-l-4 border-blue-500/60",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Inventory"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Manage inventory levels by location"})]}),e.jsxs("button",{className:"inline-flex items-center gap-1.5 px-3 py-2 rounded-lg border border-gray-200/80 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium text-gray-700 transition-colors",onClick:z,disabled:!r||O,children:[e.jsx(le,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Inventory by Location"})}),e.jsxs("div",{className:"p-5",children:[e.jsx("div",{className:"flex gap-4 mb-4 items-center",children:e.jsxs("div",{className:"min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Location"}),e.jsxs("select",{value:r,onChange:t=>Q(t.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors",children:[e.jsx("option",{value:"",children:"Select a location"}),d.map(t=>e.jsxs("option",{value:t._id,children:[t.name," - ",t.city,", ",t.state]},t._id))]})]})}),r&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(se,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by SKU or product title...",value:u,onChange:t=>$(t.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"})]}),e.jsx("button",{className:"p-2 border border-gray-200 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-colors",children:e.jsx(P,{className:"w-4 h-4 text-gray-600"})})]}),r?O?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-200 border-t-blue-600"})}):V.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"Unavailable"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"Committed"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"Incoming"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600",children:"On Hand"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:V.map(t=>{const s=t.unavailable.damaged+t.unavailable.qualityControl+t.unavailable.safetyStock+t.unavailable.other,l=Object.values(t.variantId.optionValues||{}).join(" / ");return e.jsxs("tr",{className:"hover:bg-blue-50/50 group",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.variantId.images?.[0]||t.variantId.productId.imageUrls?.[0]||void 0,alt:t.variantId.productId.title,className:"w-12 h-12 rounded-lg object-cover bg-gray-200 shrink-0",onError:n=>{n.target.style.display="none"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.variantId.productId.title}),e.jsx("p",{className:"text-xs text-gray-600",children:l})]})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.variantId.sku})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-1 relative",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx("button",{"aria-label":"unavailable details",onClick:n=>D(n,t._id),className:"ml-1 opacity-0 group-hover:opacity-100 p-1 hover:bg-blue-100 rounded-lg transition-colors",children:e.jsx(P,{className:"w-3.5 h-3.5 text-gray-600"})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.committed})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.incoming??0})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:m===t._id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:S,onChange:n=>R(Number(n.target.value)||0),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"}),e.jsx("button",{className:"px-2 py-1 text-xs border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",onClick:Y,disabled:k,children:"Cancel"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",onClick:G,disabled:k,children:k?"Saving...":"Save"})]}):e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-lg ${t.available>0?"bg-green-50 text-green-700 border border-green-200/80":"bg-red-50 text-red-700 border border-red-200/80"}`,children:t.available}),e.jsx("button",{className:"text-xs text-blue-600 hover:text-blue-700 transition-colors",onClick:()=>X(t._id,t.available),children:"Edit"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:b===t._id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:E,onChange:n=>B(Number(n.target.value)||0),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"}),e.jsx("button",{className:"px-2 py-1 text-xs border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",onClick:W,disabled:H,children:"Cancel"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",onClick:Z,disabled:H,children:H?"Saving...":"Save"})]}):e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.onHand}),e.jsx("button",{className:"text-xs text-blue-600 hover:text-blue-700 transition-colors",onClick:()=>J(t._id,t.onHand),children:"Edit"})]})})]},t._id)})})]})}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:f}),e.jsxs("div",{className:"fixed z-50 mt-2 bg-white border border-gray-200/80 rounded-xl shadow-lg",style:{top:N.getBoundingClientRect().bottom+window.scrollY+4,left:N.getBoundingClientRect().left+window.scrollX},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"px-3 pt-2 pb-2",children:e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Unavailable inventory"})}),e.jsx("div",{className:"border-t border-gray-200"}),o&&e.jsxs("div",{className:"min-w-[240px] py-2",children:[e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between gap-4 hover:bg-blue-50/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Damaged"}),e.jsx("input",{type:"number",min:"0",value:o.damaged,onChange:t=>v("damaged",t.target.value),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between gap-4 hover:bg-blue-50/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Quality Control"}),e.jsx("input",{type:"number",min:"0",value:o.qualityControl,onChange:t=>v("qualityControl",t.target.value),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between gap-4 hover:bg-blue-50/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Safety Stock"}),e.jsx("input",{type:"number",min:"0",value:o.safetyStock,onChange:t=>v("safetyStock",t.target.value),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between gap-4 hover:bg-blue-50/50 transition-colors",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Other"}),e.jsx("input",{type:"number",min:"0",value:o.other,onChange:t=>v("other",t.target.value),className:"w-20 px-2 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"flex justify-end gap-2 px-3 pb-2 pt-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",onClick:f,disabled:w,children:"Cancel"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",onClick:K,disabled:w,children:w?"Saving...":"Save"})]})]})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-gray-500",children:u?"No items match your search.":"No inventory found for this location."})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-blue-50 flex items-center justify-center mx-auto mb-4",children:e.jsx(ne,{className:"w-7 h-7 text-blue-600"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"Select a location to view inventory"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a location from the dropdown above to see inventory levels."})]})]})]})]})})};export{ce as default};
