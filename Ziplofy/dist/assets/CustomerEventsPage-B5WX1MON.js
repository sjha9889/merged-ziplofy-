import{r as s,j as e,b as R,aA as F,u as D,O as p,g as L}from"./index-C7S6h9OR.js";import{M as O}from"./Modal-DsfhGJdg.js";import{G as z}from"./GridBackgroundWrapper-Du1VLjut.js";import{F as I}from"./Squares2X2Icon-BWDWCp4N.js";import{F as $}from"./EllipsisHorizontalIcon-CCX74wqb.js";import{T as Z}from"./Tabs-C48x5apP.js";import{F as B}from"./ArrowPathIcon-WqkWOGbf.js";import"./index-CCB_rw4P.js";function G({title:a,titleId:r,...t},i){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},t),a?s.createElement("title",{id:r},a):null,s.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"}))}const H=s.forwardRef(G),J=({onClose:a,onCreate:r,isValid:t,loading:i})=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 hover:bg-gray-50 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:!t||i,className:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors",children:"Add pixel"})]}),W=({open:a,onClose:r,pixelName:t,onPixelNameChange:i,dataSale:c,onDataSaleChange:x,code:u,onCodeChange:h,isValid:m,loading:b,onCreate:n,maxName:d})=>e.jsxs(O,{open:a,onClose:r,title:"Add custom pixel",maxWidth:"sm",actions:e.jsx(J,{onClose:r,onCreate:n,isValid:m,loading:b}),children:[e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md flex items-start gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-sm text-blue-900",children:["Did you check available apps first? Apps are the most secure option, with automatic updates, for integrating with third-party services."," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:underline",children:"Explore pixels apps"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Pixel name"}),e.jsx("input",{type:"text",value:t,onChange:o=>i(o.target.value.slice(0,d)),maxLength:d,className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"}),e.jsxs("p",{className:"text-xs text-gray-500 text-right mt-1",children:[t.length,"/",d]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Data sale"}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("fieldset",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"qualifies_as_data_sale",checked:c==="qualifies_as_data_sale",onChange:o=>x(o.target.value),className:"mt-1 w-4 h-4 text-gray-900 focus:ring-gray-900"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Data collected qualifies as data sale"})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"qualifies_as_data_sale_limited_use",checked:c==="qualifies_as_data_sale_limited_use",onChange:o=>x(o.target.value),className:"mt-1 w-4 h-4 text-gray-900 focus:ring-gray-900"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Data collected qualifies as data sale and supports limited data use"})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"does_not_qualify_as_data_sale",checked:c==="does_not_qualify_as_data_sale",onChange:o=>x(o.target.value),className:"mt-1 w-4 h-4 text-gray-900 focus:ring-gray-900"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-900 block",children:"Data collected does not qualify as data sale"}),e.jsx("span",{className:"text-xs text-gray-600 block mt-1",children:"The pixel will collect data when the customers opts out of their data being sold."})]})]})]})})]}),e.jsx("div",{className:"h-px bg-gray-200 my-6"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Code"}),e.jsx("span",{className:"text-xs text-gray-500",children:"i"})]}),e.jsx("textarea",{value:u,onChange:o=>h(o.target.value),rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent resize-y"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"This is an advanced feature that requires JavaScript knowledge. Ziplofy is not responsible for your use of pixels. Compliance with applicable laws, consents, code security, troubleshooting, and updates are your responsibility. Pixels are subject to the Terms of Service."})]}),K=({onOpenModal:a})=>e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-1",children:"Pixels"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Enable third-party services to securely collect and use customer event data from your store"})]}),e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx("button",{className:"px-3 py-1.5 text-sm font-medium border border-gray-200 text-gray-700 hover:bg-gray-50 transition-colors",children:"Explore pixel apps"}),e.jsx("button",{onClick:a,className:"px-3 py-1.5 text-sm font-medium border border-gray-200 text-gray-700 hover:bg-gray-50 transition-colors",children:"Add custom pixel"})]})]}),U=({pixel:a,renderStatusChip:r,onRowClick:t})=>e.jsxs("tr",{onClick:()=>t(a._id),className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-100 border border-gray-200 text-gray-600 flex items-center justify-center shrink-0",children:e.jsx(I,{className:"w-3.5 h-3.5"})}),e.jsx("span",{className:"text-sm font-medium capitalize text-gray-900",children:a.pixelName})]})}),e.jsx("td",{className:"px-3 py-2 text-sm capitalize text-gray-900",children:a.type}),e.jsx("td",{className:"px-3 py-2",children:r(a)}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{onClick:i=>{i.stopPropagation()},className:"p-1 text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors",children:e.jsx($,{className:"w-4 h-4"})})})]}),V=({pixels:a,renderStatusChip:r,onRowClick:t})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-white",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Pixels"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Â "})]})}),e.jsx("tbody",{children:a.map(i=>e.jsx(U,{pixel:i,renderStatusChip:r,onRowClick:t},i._id))})]})}),w=30,C=`// Step 1. Initialize the JavaScript pixel SDK (make sure to exclude HTML)

// Step 2. Subscribe to customer events with analytics.subscribe(), and add tracking
// analytics.subscribe("all_standard_events", function (event) {
//   console.log("Event data ", event?.data);
// });`,X={inactive:"Disconnected",disconnected:"Disconnected",active:"Connected"},ie=()=>{const[a,r]=s.useState(!1),[t,i]=s.useState(""),[c,x]=s.useState("does_not_qualify_as_data_sale"),[u,h]=s.useState(C),[m,b]=s.useState("all"),{activeStoreId:n}=R(),{pixels:d,create:o,fetchByStoreId:g,loading:j}=F(),N=D();s.useEffect(()=>{n&&g(n).catch(l=>{p.error(l?.message||"Failed to fetch pixels")})},[n,g]);const y=s.useMemo(()=>t.trim().length>0&&t.length<=w,[t]),v=s.useMemo(()=>m==="app"?[]:m==="custom"?d.filter(l=>l.type.toLowerCase()==="custom"):d,[d,m]),_=v.length>0,f=s.useCallback(()=>{r(!1),i(""),x("does_not_qualify_as_data_sale"),h(C)},[]),k=s.useCallback(async()=>{if(y){if(!n){p.error("Select a store before creating a pixel");return}try{await o({storeId:n,pixelName:t.trim(),type:"custom",status:"inactive",required:!1,notRequired:!0,marketing:!1,analytics:!1,preferences:!1,dataSale:c,code:u}),p.success("Pixel created"),f()}catch(l){p.error(l?.message||"Failed to create pixel")}}},[y,n,t,c,u,o,f]),S=s.useCallback(l=>{const q=X[l.status?.toLowerCase()]||l.status;return e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-700 bg-gray-50 border border-gray-200 capitalize",children:q})},[]),P=s.useCallback(()=>{n&&g(n).catch(l=>p.error(l?.message||"Failed to refresh pixels"))},[n,g]),A=s.useCallback(l=>{b(l)},[]),E=s.useCallback(()=>{r(!0)},[]),M=s.useCallback(l=>{N(`/settings/customer-events/${l}`)},[N]),T=s.useMemo(()=>[{id:"all",label:"All"},{id:"app",label:"App pixels"},{id:"custom",label:"Custom pixels"}],[]);return e.jsx(z,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsx("h1",{className:"text-xl font-medium text-gray-900 mb-4 border-b border-gray-200 pb-4",children:"Customer events"}),e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx(K,{onOpenModal:E}),e.jsxs("div",{className:"mt-4 border border-gray-200 bg-white/95",children:[e.jsx("div",{className:"px-3 pt-3",children:e.jsx(Z,{tabs:T,activeTab:m,onTabChange:A})}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsxs("div",{className:"px-3 py-2 flex justify-end gap-2",children:[e.jsx("button",{disabled:!0,className:"p-1.5 text-gray-400 cursor-not-allowed",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:P,className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors",children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"h-px bg-gray-200"}),j?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}):_?e.jsx(V,{pixels:v,renderStatusChip:S,onRowClick:M}):e.jsx("div",{className:"py-12 text-center text-gray-600",children:e.jsx("p",{className:"text-xs",children:"No pixels found for this store."})})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-4",children:["This list only shows"," ",e.jsx("button",{className:"text-gray-700 hover:underline",children:"pixels"})," ","that use the applicable Shopify APIs, the supported pixel integration."]}),e.jsx("button",{className:"text-xs text-gray-700 mt-4 inline-flex items-center hover:underline",children:"Learn more about pixels"})]}),e.jsx(W,{open:a,onClose:f,pixelName:t,onPixelNameChange:i,dataSale:c,onDataSaleChange:x,code:u,onCodeChange:h,isValid:y,loading:j,onCreate:k,maxName:w})]})})};export{ie as default};
