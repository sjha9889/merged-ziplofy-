import{j as e,aa as $,r as t,u as A,aG as R,b as T}from"./index-C7S6h9OR.js";import{F as D}from"./ArrowPathIcon-WqkWOGbf.js";import{F as B}from"./EnvelopeIcon-M5CC-M_k.js";import{S as F}from"./SendRecoveryEmailModal-DwuZo1Py.js";import{F as I}from"./ArrowLeftIcon-C1qOxHB_.js";import"./Modal-DsfhGJdg.js";import"./index-CCB_rw4P.js";const H=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:e.jsx($,{className:"w-8 h-8 text-gray-500"})}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"No abandoned carts"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-sm mx-auto",children:"Carts that aren't completed will appear here"})]}),M=({cartCount:s,loading:n,onRefresh:i})=>{const l=t.useCallback(()=>{i()},[i]);return e.jsxs("div",{className:"flex items-center justify-between mb-6 pl-3 border-l-4 border-gray-300",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Abandoned Carts"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[s," ",s===1?"cart":"carts"]})]}),e.jsx("button",{onClick:l,disabled:n,className:"p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Refresh",children:e.jsx(D,{className:`w-5 h-5 ${n?"animate-spin":""}`})})]})},V=({cart:s,getInitials:n,formatDate:i,onSendEmail:l,onViewDetails:c})=>{const o=t.useCallback(()=>{l(s.customer)},[s.customer,l]),x=t.useCallback(()=>{c(s.customer._id)},[s.customer._id,c]),h=t.useMemo(()=>s.cartItems.reduce((a,u)=>a+u.productVariant.price*u.quantity,0),[s.cartItems]);return e.jsx("div",{className:"border-b border-gray-100 last:border-b-0 hover:bg-gray-50/60 transition-colors cursor-pointer",onClick:x,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-700 text-sm font-medium shrink-0",children:n(s.customer.firstName,s.customer.lastName)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:[s.customer.firstName," ",s.customer.lastName]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(B,{className:"w-3.5 h-3.5 text-gray-400 shrink-0"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.customer.email})]})]})]}),e.jsxs("div",{className:"ml-[52px] mt-2 flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:[s.totalItems," ",s.totalItems===1?"item":"items"]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:["₹",h.toFixed(2)]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx("span",{children:i(s.lastUpdated)})]})]}),e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:e.jsx("button",{onClick:a=>{a.stopPropagation(),o()},className:"px-3 py-1.5 text-xs font-medium text-gray-600 border border-gray-200 rounded-lg hover:border-gray-300 hover:text-gray-900 hover:bg-gray-50 transition-colors",children:"Send Email"})})]})})})},L=({carts:s,getInitials:n,formatDate:i,onSendEmail:l,onViewDetails:c})=>e.jsx("div",{children:s.map((o,x)=>e.jsx(V,{cart:o,getInitials:n,formatDate:i,onSendEmail:l,onViewDetails:c},o.customer._id))}),G=()=>{const s=A(),{abandonedCarts:n,loading:i,error:l,fetchAbandonedCartsByStoreId:c}=R(),{activeStoreId:o}=T(),[x,h]=t.useState(!1),[a,u]=t.useState(null),[p,d]=t.useState(""),[g,m]=t.useState(""),[b,y]=t.useState("custom");t.useEffect(()=>{o&&c(o)},[o,c]);const j=t.useCallback(()=>{o&&c(o)},[o,c]),N=t.useCallback(r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),[]),C=t.useCallback((r,E)=>`${r.charAt(0)}${E.charAt(0)}`.toUpperCase(),[]),v=t.useCallback(r=>{u(r),d(`Complete your purchase - ${r.firstName}`),m(`Hi ${r.firstName},

We noticed you left some items in your cart. Don't miss out on these great products!

Click here to complete your purchase: [Cart Link]

Best regards,
Your Store Team`),h(!0)},[]),f=t.useCallback(()=>{h(!1),u(null),d(""),m(""),y("custom")},[]),w=t.useCallback(()=>{console.log("Sending email to:",a?.email),console.log("Subject:",p),console.log("Body:",g),console.log("Template:",b),f()},[a?.email,p,g,b,f]),k=t.useCallback(r=>{y(r),r==="reminder"?(d(`Don't forget your items - ${a?.firstName}`),m(`Hi ${a?.firstName},

You have items waiting in your cart! Complete your purchase now to secure your items.

[View Cart]

Thanks for shopping with us!`)):r==="discount"?(d(`Special offer for you - ${a?.firstName}`),m(`Hi ${a?.firstName},

We're offering you a special 10% discount on your cart items! Use code SAVE10 at checkout.

[Complete Purchase with Discount]

This offer expires in 24 hours!`)):r==="custom"&&(d(`Complete your purchase - ${a?.firstName}`),m(`Hi ${a?.firstName},

We noticed you left some items in your cart. Don't miss out on these great products!

Click here to complete your purchase: [Cart Link]

Best regards,
Your Store Team`))},[a?.firstName]),S=t.useCallback(r=>{s(`/orders/abandoned-carts/customer/${r}`)},[s]);return i?e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsx("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4 flex justify-center items-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-gray-600"})})}):l?e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsx("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:e.jsxs("div",{className:"bg-white border border-red-200 rounded-xl p-4 flex items-center justify-between shadow-sm",children:[e.jsx("p",{className:"text-sm text-red-700",children:l}),e.jsx("button",{onClick:j,className:"px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:"Retry"})]})})}):e.jsxs("div",{className:"min-h-screen bg-page-background-color",children:[e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>s("/orders"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Back to Orders"})]}),e.jsx(M,{cartCount:n.length,loading:i,onRefresh:j})]}),n.length===0?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:e.jsx(H,{})}):e.jsx("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:e.jsx(L,{carts:n,getInitials:C,formatDate:N,onSendEmail:v,onViewDetails:S})})]}),e.jsx(F,{isOpen:x,customer:a,emailSubject:p,emailBody:g,emailTemplate:b,onClose:f,onTemplateChange:k,onSubjectChange:d,onBodyChange:m,onSubmit:w})]})};export{G as default};
