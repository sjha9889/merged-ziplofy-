import{j as e,g as te,r as l,p as se,u as le,h as ae,d as re,aM as oe}from"./index-C7S6h9OR.js";import{F as w}from"./RectangleStackIcon-D3bu8HfX.js";import{F as ie}from"./PencilIcon-MufFKs4H.js";import{F as C}from"./TrashIcon-B2-WJkmb.js";import{M as A}from"./Modal-DsfhGJdg.js";import{F as ne}from"./ArrowLeftIcon-C1qOxHB_.js";import"./index-CCB_rw4P.js";const ce=({searchQuery:t,filteredProducts:s,selectedProducts:i,onSearchChange:n,onProductSelect:d})=>{const o=t.trim()&&s.length>0;return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm mb-6",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Add products to collection"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products by title, description, or SKU",value:t,onChange:n,className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),o&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-[300px] overflow-y-auto",children:s.slice(0,10).map(m=>{const g=i.some(p=>p?._id===m?._id);return e.jsxs("button",{onClick:()=>d(m),disabled:g,className:`w-full text-left px-3 py-2 flex items-center gap-2 hover:bg-gray-50 transition-colors ${g?"opacity-60 bg-gray-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${g?"bg-green-500":"bg-gray-900"}`,children:m?.imageUrl?e.jsx("img",{src:m.imageUrl,alt:m.title||"Product",className:"w-full h-full rounded-full object-cover"}):e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:m?.title||"Untitled Product"}),g&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:"Selected"})]})})]},m?._id||Math.random())})}),t.trim()&&s.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded shadow-lg",children:e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No products found"})})]})]})},de=({collection:t,onEdit:s,onDelete:i})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Overview"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:s,className:"p-1.5 hover:bg-gray-100 rounded transition-colors","aria-label":"Edit collection",children:e.jsx(ie,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:i,className:"p-1.5 hover:bg-gray-100 rounded transition-colors","aria-label":"Delete collection",children:e.jsx(C,{className:"w-4 h-4 text-gray-600"})})]})]}),e.jsx("div",{className:"border-t border-gray-200 mb-4"}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Page title"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.pageTitle||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"URL handle"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.urlHandle||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Status"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.status==="published"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status||"draft"})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Meta description"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.metaDescription||"-"})]})]}),e.jsx("div",{className:"border-t border-gray-200 my-3"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Last updated: ",new Date(t.updatedAt).toLocaleDateString()]})]}),me=({isOpen:t,collectionTitle:s,onClose:i,onConfirm:n})=>e.jsx(A,{open:t,onClose:i,title:"Delete collection",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",children:"No"}),e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition-colors",children:"Yes"})]}),children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Do you really want to delete"," ",s?`'${s}'`:"this collection","?"]})}),xe=({isOpen:t,formData:s,onChange:i,onClose:n,onUpdate:d})=>e.jsx(A,{open:t,onClose:n,title:"Edit collection",maxWidth:"md",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:d,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 transition-colors",children:"Update"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-title",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Title"}),e.jsx("input",{id:"edit-title",type:"text",value:s.title,onChange:o=>i("title",o.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-description",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Description"}),e.jsx("textarea",{id:"edit-description",value:s.description,onChange:o=>i("description",o.target.value),rows:3,className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-page-title",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Page title"}),e.jsx("input",{id:"edit-page-title",type:"text",value:s.pageTitle,onChange:o=>i("pageTitle",o.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-meta-description",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Meta description"}),e.jsx("textarea",{id:"edit-meta-description",value:s.metaDescription,onChange:o=>i("metaDescription",o.target.value),rows:3,className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-url-handle",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"URL handle"}),e.jsx("input",{id:"edit-url-handle",type:"text",value:s.urlHandle,onChange:o=>i("urlHandle",o.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-status",className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Status"}),e.jsxs("select",{id:"edit-status",value:s.status,onChange:o=>i("status",o.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:ring-1 focus:ring-gray-400 focus:border-gray-400 outline-none transition-colors bg-white",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"published",children:"Published"})]})]})]})}),ue=({entry:t,onProductClick:s,onRemoveProduct:i})=>{const n=l.useCallback(()=>{t?.productId?._id&&s(t.productId._id)},[t?.productId?._id,s]),d=l.useCallback(o=>{i(o,t?._id)},[t?._id,i]);return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-white hover:bg-gray-50 cursor-pointer transition-colors shadow-sm",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center shrink-0",children:t?.productId?.images?.[0]?e.jsx("img",{src:t.productId.images[0],alt:t?.productId?.title||"Product",className:"w-full h-full rounded-full object-cover"}):e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.productId?.title||"Untitled Product"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5 line-clamp-1",children:[t?.productId?.description?.substring(0,80)||"No description available","..."]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:["$",t?.productId?.price||0]}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium border border-gray-200 text-gray-700",children:t?.productId?.sku||"No SKU"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium border border-gray-200 text-gray-700",children:t?.productId?.category?.name||"No Category"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 whitespace-nowrap",children:["Added"," ",t?.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown date"]}),e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-gray-200 rounded transition-colors",children:e.jsx(C,{className:"w-4 h-4 text-gray-600"})})]})]})},ge=({collectionEntries:t,onProductClick:s,onRemoveProduct:i})=>e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsx(ue,{entry:n,onProductClick:s,onRemoveProduct:i},n?._id||Math.random()))}),he=({collectionEntries:t,loading:s=!1,onProductClick:i,onRemoveProduct:n})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:["Products in collection (",t.length,")"]}),s?e.jsx("p",{className:"text-sm text-gray-600",children:"Loading products..."}):t.length>0?e.jsx(ge,{collectionEntries:t,onProductClick:i,onRemoveProduct:n}):e.jsx("p",{className:"text-sm text-gray-600",children:"No products in this collection yet. Use the search above to add products."})]}),pe=({selectedProducts:t,loading:s=!1,onRemoveProduct:i,onAddProducts:n,onClearAll:d})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm mb-6",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:["Products to add (",t.length,")"]}),t.length>0?e.jsxs("div",{className:"space-y-2",children:[t.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-900 flex items-center justify-center shrink-0",children:o?.imageUrl?e.jsx("img",{src:o.imageUrl,alt:o.title||"Product",className:"w-full h-full rounded-full object-cover"}):e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o?.title||"Untitled Product"})]}),e.jsx("button",{onClick:()=>i(o?._id),className:"p-1.5 hover:bg-gray-200 rounded transition-colors",children:e.jsx(C,{className:"w-4 h-4 text-gray-600"})})]},o?._id||Math.random())),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:n,disabled:t.length===0||s,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:s?"Adding products...":`Add ${t.length===1?"one product":t.length+" products"} to collection`}),e.jsx("button",{onClick:d,disabled:t.length===0,className:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Clear all"})]})]}):e.jsx("p",{className:"text-sm text-gray-600",children:"No products selected. Use the search above to add products to this collection."})]}),Ce=()=>{const{id:t}=se(),s=le(),{collections:i,deleteCollection:n,updateCollection:d}=ae(),{fetchProductsByStoreId:o,searchBasic:m}=re(),{createCollectionEntry:g,deleteCollectionEntry:p,fetchCollectionEntriesByCollectionId:k,collectionEntries:R,loading:S}=oe(),[T,j]=l.useState(!1),[$,b]=l.useState(!1),[f,P]=l.useState(""),[F,N]=l.useState([]),[h,y]=l.useState([]),r=i.find(a=>a._id===t),v=l.useMemo(()=>({title:r?.title||"",description:r?.description||"",pageTitle:r?.pageTitle||"",metaDescription:r?.metaDescription||"",urlHandle:r?.urlHandle||"",status:r?.status||"published"}),[r]),[u,I]=l.useState(v);l.useEffect(()=>{I(v)},[v]),l.useEffect(()=>{r?.storeId&&o(r.storeId)},[r?.storeId,o]),l.useEffect(()=>{t&&k(t)},[t,k]),l.useEffect(()=>{let a=!1;const c=async()=>{const M=f.trim();if(!M){N([]);return}try{const ee=await m({q:M,storeId:r?.storeId});a||N(ee)}catch{a||N([])}},x=setTimeout(()=>{c()},300);return()=>{a=!0,clearTimeout(x)}},[f,m,r?.storeId]);const O=l.useCallback(()=>{s("/products/collections")},[s]),L=l.useCallback(a=>{const c=a.target.value;P(c)},[]),_=l.useCallback(()=>{P("")},[]),E=l.useCallback(a=>{h.some(x=>x._id===a._id)||y(x=>[...x,a]),_()},[h,_]),D=l.useCallback(a=>{y(c=>c.filter(x=>x._id!==a))},[]),H=l.useCallback(async()=>{if(!(!r?._id||h.length===0))try{const a=h.map(c=>g({collectionId:r._id,productId:c._id}));await Promise.all(a),y([]),console.log("Successfully added products to collection")}catch(a){console.error("Failed to add products to collection:",a)}},[r?._id,h,g]),U=l.useCallback(async a=>{try{await p(a),console.log("Successfully removed product from collection")}catch(c){console.error("Failed to remove product from collection:",c)}},[p]),B=l.useCallback(async()=>{if(r?._id)try{await n(r._id)}finally{s("/products/collections")}else j(!1)},[r?._id,n,s]),z=l.useCallback(async()=>{if(!r?._id){b(!1);return}try{await d(r._id,{title:u.title,description:u.description,pageTitle:u.pageTitle,metaDescription:u.metaDescription,urlHandle:u.urlHandle,status:u.status}),b(!1)}catch{}},[r?._id,u,d]),W=l.useCallback(()=>{b(!0)},[]),K=l.useCallback(()=>{b(!1)},[]),q=l.useCallback(()=>{j(!0)},[]),Y=l.useCallback(()=>{j(!1)},[]),G=l.useCallback(()=>{y([])},[]),J=l.useCallback(a=>{E(a)},[E]),Q=l.useCallback(a=>{D(a)},[D]),V=l.useCallback(a=>{a&&s(`/products/${a}`)},[s]),X=l.useCallback((a,c)=>{a.stopPropagation(),U(c)},[U]),Z=l.useCallback((a,c)=>{I(x=>({...x,[a]:c}))},[]);return f.trim()&&F.length>0,e.jsxs("div",{className:"min-h-screen bg-page-background-color",children:[e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:O,className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-gray-900 mb-2 transition-colors","aria-label":"Back",children:[e.jsx(ne,{className:"w-4 h-4"}),"Back to collections"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:r?.title||"Collection"}),r?.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.description})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(de,{collection:r,onEdit:W,onDelete:q}),e.jsx(ce,{searchQuery:f,filteredProducts:F,selectedProducts:h,onSearchChange:L,onProductSelect:J}),e.jsx(pe,{selectedProducts:h,loading:S,onRemoveProduct:Q,onAddProducts:H,onClearAll:G}),e.jsx(he,{collectionEntries:R,loading:S,onProductClick:V,onRemoveProduct:X})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"Collection not found in state."})]}),e.jsx(xe,{isOpen:$,formData:u,onChange:Z,onClose:K,onUpdate:z}),e.jsx(me,{isOpen:T,collectionTitle:r?.title,onClose:Y,onConfirm:B})]})};export{Ce as default};
