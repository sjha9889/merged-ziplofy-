import{r as p,j as e,u as Ze,aN as et,R as we,aO as tt,H as ot,b as st,O as nt}from"./index-C7S6h9OR.js";import{u as it,a as at,c as rt,R as lt,d as dt,B as ct,C as pt,M as ut,b as xt,I as Ae,H as de,P as ce}from"./style-B-Ob-YGb.js";import{B as f,T as y}from"./Box-Cgm3ZkZ8.js";import{P as se}from"./Paper-DocVmpOE.js";import{I as B}from"./IconButton-BnkdM8yk.js";import{A as ft}from"./ArrowBack-CB8ALDU6.js";import{c as ht,b as $e,a as gt,B as $}from"./Button-CdPvNkrY.js";import{C as Pe,A as mt,a as Te,L as yt,D as he,b as ge,c as me,d as De}from"./Close-CrEmJjEJ.js";import{T as Y}from"./TextField-CwtyivJh.js";import{L as Le}from"./Link-BuWh3ioJ.js";import{D as pe,S as bt}from"./Search-GwsDg8Y4.js";import{C as Me,A as vt}from"./ContentCopy-dfDJtBg6.js";import{L as X,i as jt,c as Ct,h as Ne,F as Re,I as ze,S as Be,j as Ee,M as qe}from"./Select-Bus390RW.js";import{M as j}from"./MenuItem-HG7tTLPS.js";import{g as ye,a as be,u as ve,c as ne,d as je,s as ue,r as It,m as Fe}from"./DefaultPropsProvider-CZkfTDs_.js";import{c as Ve}from"./createSvgIcon-Yi9Vo0kN.js";import{I as St}from"./InputAdornment-CoWoQ4-e.js";import{C as kt}from"./Chip-DNdEoHyQ.js";import"./index-CCB_rw4P.js";import"./dividerClasses-Q3ucxvtD.js";function wt(t){return ye("MuiListItem",t)}be("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);function At(t){return ye("MuiListItemButton",t)}const J=be("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),Pt=(t,n)=>{const{ownerState:x}=t;return[n.root,x.dense&&n.dense,x.alignItems==="flex-start"&&n.alignItemsFlexStart,x.divider&&n.divider,!x.disableGutters&&n.gutters]},Tt=t=>{const{alignItems:n,classes:x,dense:i,disabled:g,disableGutters:h,divider:v,selected:C}=t,P=je({root:["root",i&&"dense",!h&&"gutters",v&&"divider",g&&"disabled",n==="flex-start"&&"alignItemsFlexStart",C&&"selected"]},At,x);return{...x,...P}},Dt=ue(gt,{shouldForwardProp:t=>It(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Pt})(Fe(({theme:t})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${J.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),[`&.${J.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.focusOpacity}`)}},[`&.${J.selected}:hover`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity)}},[`&.${J.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${J.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},variants:[{props:({ownerState:n})=>n.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:n})=>!n.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:n})=>n.dense,style:{paddingTop:4,paddingBottom:4}}]}))),Oe=p.forwardRef(function(n,x){const i=ve({props:n,name:"MuiListItemButton"}),{alignItems:g="center",autoFocus:h=!1,component:v="div",children:C,dense:k=!1,disableGutters:P=!1,divider:N=!1,focusVisibleClassName:S,selected:E=!1,className:O,...r}=i,R=p.useContext(X),l=p.useMemo(()=>({dense:k||R.dense||!1,alignItems:g,disableGutters:P}),[g,R.dense,k,P]),z=p.useRef(null);ht(()=>{h&&z.current&&z.current.focus()},[h]);const T={...i,alignItems:g,dense:l.dense,disableGutters:P,divider:N,selected:E},w=Tt(T),q=$e(z,x);return e.jsx(X.Provider,{value:l,children:e.jsx(Dt,{ref:q,href:r.href||r.to,component:(r.href||r.to)&&v==="div"?"button":v,focusVisibleClassName:ne(w.focusVisible,S),ownerState:T,className:ne(w.root,O),...r,classes:w,children:C})})});function Lt(t){return ye("MuiListItemSecondaryAction",t)}be("MuiListItemSecondaryAction",["root","disableGutters"]);const Mt=t=>{const{disableGutters:n,classes:x}=t;return je({root:["root",n&&"disableGutters"]},Lt,x)},Nt=ue("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:x}=t;return[n.root,x.disableGutters&&n.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:t})=>t.disableGutters,style:{right:0}}]}),Ge=p.forwardRef(function(n,x){const i=ve({props:n,name:"MuiListItemSecondaryAction"}),{className:g,...h}=i,v=p.useContext(X),C={...i,disableGutters:v.disableGutters},k=Mt(C);return e.jsx(Nt,{className:ne(k.root,g),ownerState:C,ref:x,...h})});Ge.muiName="ListItemSecondaryAction";const Rt=(t,n)=>{const{ownerState:x}=t;return[n.root,x.dense&&n.dense,x.alignItems==="flex-start"&&n.alignItemsFlexStart,x.divider&&n.divider,!x.disableGutters&&n.gutters,!x.disablePadding&&n.padding,x.hasSecondaryAction&&n.secondaryAction]},zt=t=>{const{alignItems:n,classes:x,dense:i,disableGutters:g,disablePadding:h,divider:v,hasSecondaryAction:C}=t;return je({root:["root",i&&"dense",!g&&"gutters",!h&&"padding",v&&"divider",n==="flex-start"&&"alignItemsFlexStart",C&&"secondaryAction"],container:["container"],secondaryAction:["secondaryAction"]},wt,x)},Bt=ue("div",{name:"MuiListItem",slot:"Root",overridesResolver:Rt})(Fe(({theme:t})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:n})=>!n.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:n})=>!n.disablePadding&&n.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:n})=>!n.disablePadding&&!n.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:n})=>!n.disablePadding&&!!n.secondaryAction,style:{paddingRight:48}},{props:({ownerState:n})=>!!n.secondaryAction,style:{[`& > .${J.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:n})=>n.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:n})=>n.button,style:{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:n})=>n.hasSecondaryAction,style:{paddingRight:48}}]}))),Et=ue("li",{name:"MuiListItem",slot:"Container"})({position:"relative"}),We=p.forwardRef(function(n,x){const i=ve({props:n,name:"MuiListItem"}),{alignItems:g="center",children:h,className:v,component:C,components:k={},componentsProps:P={},ContainerComponent:N="li",ContainerProps:{className:S,...E}={},dense:O=!1,disableGutters:r=!1,disablePadding:R=!1,divider:l=!1,secondaryAction:z,slotProps:T={},slots:w={},...q}=i,ie=p.useContext(X),F=p.useMemo(()=>({dense:O||ie.dense||!1,alignItems:g,disableGutters:r}),[g,ie.dense,O,r]),Z=p.useRef(null),W=p.Children.toArray(h),ee=W.length&&jt(W[W.length-1],["ListItemSecondaryAction"]),V={...i,alignItems:g,dense:F.dense,disableGutters:r,disablePadding:R,divider:l,hasSecondaryAction:ee},G=zt(V),K=$e(Z,x),Q={slots:w,slotProps:T},[ae,te]=Ct("secondaryAction",{elementType:Ge,externalForwardedProps:Q,ownerState:V,className:G.secondaryAction}),b=w.root||k.Root||Bt,I=T.root||P.root||{},H={className:ne(G.root,I.className,v),...q};let D=C||"li";return ee?(D=!H.component&&!C?"div":D,N==="li"&&(D==="li"?D="div":H.component==="li"&&(H.component="div")),e.jsx(X.Provider,{value:F,children:e.jsxs(Et,{as:N,className:ne(G.container,S),ref:K,ownerState:V,...E,children:[e.jsx(b,{...I,...!Ne(b)&&{as:D,ownerState:{...V,...I.ownerState}},...H,children:W}),W.pop()]})})):e.jsx(X.Provider,{value:F,children:e.jsxs(b,{...I,as:D,ref:K,...!Ne(b)&&{ownerState:{...V,...I.ownerState}},...H,children:[W,z&&e.jsx(ae,{...te,children:z})]})})}),Ot=Ve(e.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),Wt=Ve(e.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"})),$t=[{id:"trigger-1",type:"trigger",data:{label:"Trigger"},position:{x:250,y:100}}],qt=[],Ft=({data:t,selected:n,id:x})=>{const[i,g]=p.useState(null),[h,v]=p.useState(null),C=!!i,k=r=>{r.stopPropagation(),h&&(clearTimeout(h),v(null)),i===r.currentTarget?g(null):g(r.currentTarget)},P=r=>{if(r.stopPropagation(),!i){h&&clearTimeout(h);const R=setTimeout(()=>{g(r.currentTarget)},500);v(R)}},N=()=>{h&&(clearTimeout(h),v(null))},S=()=>{h&&(clearTimeout(h),v(null)),g(null)},E=()=>{t.onAddAction?.(),S()},O=()=>{t.onAddCondition?.(),S()};return e.jsxs(f,{sx:{backgroundColor:n?"#f5f7ff":"white",border:`2px solid ${n?"#4f46e5":"#6366f1"}`,borderRadius:2,padding:2,minWidth:150,position:"relative"},children:[e.jsx(f,{sx:{position:"absolute",top:4,right:4},children:e.jsx(B,{size:"small",onClick:r=>{r.stopPropagation(),t.onRequestDelete?.(x,"trigger")},sx:{color:"text.secondary"},children:e.jsx(pe,{fontSize:"small"})})}),e.jsx(de,{type:"target",position:ce.Top,style:{visibility:"hidden"}}),e.jsx(y,{variant:"body1",sx:{fontWeight:600,textAlign:"center",mb:1},children:t.label||"Trigger"}),t.isTriggerSelected&&e.jsxs(f,{sx:{position:"relative",display:"flex",justifyContent:"flex-end",mt:1,pr:.5},children:[e.jsx(y,{variant:"caption",sx:{color:"#6366f1",cursor:"pointer",fontWeight:600,"&:hover":{textDecoration:"underline"}},onMouseEnter:P,onMouseLeave:N,onClick:k,children:"then"}),e.jsxs(qe,{anchorEl:i,open:C,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},onClick:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()},onMouseUp:r=>{r.stopPropagation()},disableAutoFocusItem:!0,disablePortal:!1,sx:{zIndex:9999},PaperProps:{onClick:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()},sx:{pointerEvents:"auto"}},MenuListProps:{"aria-labelledby":"then-button",onClick:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()}},children:[t.canHaveConditions&&e.jsx(j,{onClick:r=>{r.stopPropagation(),O()},onMouseDown:r=>{r.stopPropagation()},children:"Condition"}),e.jsx(j,{onClick:r=>{r.stopPropagation(),E()},onMouseDown:r=>{r.stopPropagation()},children:"Action"})]})]}),e.jsx(de,{type:"source",position:ce.Bottom,style:{bottom:-8}})]})},Vt=({data:t,id:n,selected:x})=>{const[i,g]=p.useState(null),[h,v]=p.useState(null),C=!!i,k=l=>{l.stopPropagation(),h&&(clearTimeout(h),v(null)),i===l.currentTarget?g(null):g(l.currentTarget)},P=l=>{if(l.stopPropagation(),!i){h&&clearTimeout(h);const z=setTimeout(()=>{g(l.currentTarget)},500);v(z)}},N=()=>{h&&(clearTimeout(h),v(null))},S=()=>{h&&(clearTimeout(h),v(null)),g(null)},E=()=>{t.onAddAction?.(),S()},O=()=>{t.onAddCondition?.(),S()},r=()=>{t.onAddOtherwise&&t.onAddOtherwise(),S()},R=l=>({equal:"Equal to","not-equal":"Not equal to","greater-than":"Greater than","greater-than-or-equal":"Greater than or equal to","less-than":"Less than","less-than-or-equal":"Less than or equal to","is-at-least-one-of":"Is at least one of","is-not-any-of":"Is not any of","does-not-exist":"Does not exist",exists:"Exists"})[l]||l;return e.jsxs(f,{sx:{backgroundColor:x?"#f5f7ff":"white",border:`2px solid ${x?"#4f46e5":"#6366f1"}`,borderRadius:2,padding:2,minWidth:200,position:"relative"},children:[e.jsx(f,{sx:{position:"absolute",top:4,right:4,display:"flex",gap:.5},children:e.jsx(B,{size:"small",onClick:l=>{l.stopPropagation(),t.onRequestDelete?.(n,"condition")},sx:{color:"text.secondary"},children:e.jsx(pe,{fontSize:"small"})})}),e.jsx(de,{type:"target",position:ce.Top,style:{bottom:-8}}),e.jsx(y,{variant:"body1",sx:{fontWeight:600,textAlign:"center",mb:1},children:"Condition"}),t.variable&&e.jsxs(f,{sx:{mb:1,p:1,backgroundColor:"#f5f5f5",borderRadius:1},children:[e.jsx(y,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Variable"}),e.jsx(y,{variant:"body2",sx:{fontWeight:500},children:t.variable}),t.operator&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"Operator"}),e.jsx(y,{variant:"body2",sx:{fontWeight:500},children:R(t.operator)})]}),t.value&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"Value"}),e.jsx(y,{variant:"body2",sx:{fontWeight:500},children:t.value})]})]}),t.variable&&e.jsxs(f,{sx:{position:"relative",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:1,mt:1,pr:.5},children:[e.jsx(y,{variant:"caption",sx:{color:"#6366f1",cursor:"pointer",fontWeight:600,"&:hover":{textDecoration:"underline"}},onMouseEnter:P,onMouseLeave:N,onClick:k,children:"then"}),e.jsx(y,{variant:"caption",sx:{color:"#ef4444",cursor:"pointer",fontWeight:600,"&:hover":{textDecoration:"underline"}},onClick:l=>{l.stopPropagation(),r()},children:"otherwise"}),e.jsxs(qe,{anchorEl:i,open:C,onClose:S,onClick:l=>{l.stopPropagation()},onMouseDown:l=>{l.stopPropagation()},onMouseUp:l=>{l.stopPropagation()},disableAutoFocusItem:!0,disablePortal:!1,sx:{zIndex:9999},PaperProps:{onClick:l=>{l.stopPropagation()},onMouseDown:l=>{l.stopPropagation()},sx:{pointerEvents:"auto"}},MenuListProps:{"aria-labelledby":"then-button",onClick:l=>{l.stopPropagation()},onMouseDown:l=>{l.stopPropagation()}},children:[e.jsx(j,{onClick:l=>{l.stopPropagation(),O()},onMouseDown:l=>{l.stopPropagation()},children:"Condition"}),e.jsx(j,{onClick:l=>{l.stopPropagation(),E()},onMouseDown:l=>{l.stopPropagation()},children:"Action"})]})]}),e.jsx(de,{type:"source",position:ce.Bottom,style:{bottom:-8}})]})},po=()=>{const t=Ze(),[n,x]=p.useState(null),[i,g]=p.useState(null),[h,v]=p.useState(!1),[C,k]=p.useState(""),[P,N]=p.useState(null),[S,E]=p.useState("equal"),[O,r]=p.useState(!1),[R,l]=p.useState(""),[z,T]=p.useState(!1),[w,q]=p.useState(null),[ie,F]=p.useState(!1),[Z,W]=p.useState(""),[ee,V]=p.useState(""),[G,K]=p.useState(null),Q=p.useCallback((o,a,c)=>{o(s=>{const m=c?s.find(d=>d.id===c):s.find(d=>d.id==="trigger-1");if(m){const d={id:`action-${Date.now()}`,type:"action",data:{label:"Action"},position:{x:m.position.x,y:m.position.y+150}};return a(A=>{const L={id:`edge-${m.id}-${d.id}`,source:m.id,target:d.id};return[...A,L]}),[...s,d]}return s})},[]),ae=p.useCallback((o,a,c)=>{o(s=>{const m=c?s.find(d=>d.id===c):s.find(d=>d.id==="trigger-1");if(m){const d={id:`otherwise-${Date.now()}`,data:{label:"Otherwise"},position:{x:m.position.x+200,y:m.position.y}};return a(A=>{const L={id:`edge-${m.id}-${d.id}`,source:m.id,target:d.id,style:{stroke:"#ef4444"},label:"Otherwise"};return[...A,L]}),[...s,d]}return s})},[]),te=p.useCallback((o,a,c)=>{o(s=>{const m=c?s.find(d=>d.id===c):s.find(d=>d.id==="trigger-1");if(m){const d=`condition-${Date.now()}`,A={id:d,type:"condition",data:{label:"Condition",onAddAction:()=>Q(o,a,d),onAddCondition:()=>te(o,a,d),onAddOtherwise:()=>ae(o,a,d),onRequestDelete:(L,_)=>{q({id:L,type:_}),T(!0)}},position:{x:m.position.x,y:m.position.y+150}};return a(L=>{const _={id:`edge-${m.id}-${A.id}`,source:m.id,target:A.id};return[...L,_]}),g(d),[...s,A]}return s})},[Q,ae]),[b,I,H]=it($t.map(o=>({...o,data:{...o.data,onAddAction:()=>Q(I,U,"trigger-1"),onAddCondition:()=>te(I,U,"trigger-1"),isTriggerSelected:!1,canHaveConditions:!1,onRequestDelete:(a,c)=>{q({id:a,type:c}),T(!0)}}}))),[D,U,He]=at(qt),{triggers:re,getAll:Ce}=et();we.useEffect(()=>{Ce().catch(()=>{})},[Ce]);const{actions:xe,getAll:Ie}=tt();we.useEffect(()=>{Ie().catch(()=>{})},[Ie]);const Ue=p.useCallback(o=>U(a=>rt(o,a)),[U]),{create:Se}=ot(),{activeStoreId:ke}=st(),_e=p.useCallback(async o=>{const c=b.find(u=>u.id==="trigger-1")?.data?.label||"Trigger",s=n||null,m=s&&re.find(u=>u.key===s)?._id||null,d=u=>{if(!u)return null;const M=D.find(oe=>oe.source===u);return M?M.target:null},A=[];let L=d("trigger-1"),_="trigger-1";for(;L;){const u=b.find(M=>M.id===L);if(!u)break;if(u.type==="condition"){const M=u.data||{};A.push({variable:M.variable||void 0,operator:M.operator||void 0,value:M.value??void 0,description:M.description||void 0}),_=u.id,L=d(u.id)}else{_=u.id;break}}let le=null;const Ye=L||_,fe=b.find(u=>u.id===Ye);if(fe&&fe.type==="action"){const u=fe.data||{};le={id:u.actionType&&xe.find(oe=>oe.actionType===u.actionType)?._id||null,actionType:u.actionType,name:u.label}}const Je={selectedTrigger:n,nodes:b.map(u=>({id:u.id,type:u.type,position:u.position,data:u.data})),edges:D.map(u=>({id:u.id,source:u.source,target:u.target,label:u.label,style:u.style})),mainData:{trigger:{id:m,key:s,name:c},conditions:A,action:le}};try{const u=ke||"",M=`${c}${le?.name?` → ${le.name}`:""}`,oe=(o?.name||M||"Untitled automation").trim(),Xe=(o?.description||"").trim();await Se({storeId:u,name:oe,description:Xe,triggerId:m||"",triggerKey:s||"add_to_cart",isActive:!0,flowData:Je}),t("/marketing/automations")}catch(u){console.error(u)}},[n,b,D,re,xe,Se,t,ke]),Ke=p.useMemo(()=>({trigger:Ft,condition:Vt}),[]);p.useMemo(()=>({animated:!0,style:{stroke:"#6366f1"}}),[]);const Qe=p.useMemo(()=>({animated:!0,style:{stroke:"#6366f1",strokeWidth:2}}),[]);return e.jsxs(f,{sx:{height:"calc(100vh - 64px)",width:"100%",position:"relative"},children:[e.jsxs(se,{elevation:1,sx:{position:"absolute",top:0,left:0,right:0,zIndex:10,p:2,display:"flex",alignItems:"center",gap:2,borderRadius:0},children:[e.jsx(B,{onClick:()=>t("/marketing/automations"),size:"small",children:e.jsx(ft,{})}),e.jsx(y,{variant:"h6",sx:{flexGrow:1},children:"Create automation"}),e.jsx($,{variant:"contained",size:"small",sx:{textTransform:"none",mr:1},onClick:()=>{const a=b.find(d=>d.id==="trigger-1")?.data?.label||"Trigger",c=b.find(d=>d.type==="action"),s=c?c.data?.label||"Action":"",m=`${a}${s?` → ${s}`:""}`;W(m),V(""),K(null),F(!0)},children:"Save"})]}),e.jsxs(f,{sx:{height:"100%",width:"100%",pt:8,display:"flex"},children:[e.jsx(f,{sx:{flex:1,height:"100%"},children:e.jsxs(lt,{nodes:b,edges:D,onNodesChange:H,onEdgesChange:He,onConnect:Ue,onNodeClick:(o,a)=>{o.stopPropagation(),g(a.id)},onPaneClick:()=>{g(null)},nodeTypes:Ke,defaultEdgeOptions:Qe,fitView:!0,attributionPosition:"bottom-left",connectionLineStyle:{stroke:"#6366f1",strokeWidth:2},connectionLineType:dt.SmoothStep,children:[e.jsx(ct,{variant:"dots",gap:20,size:1,color:"#e0e0e0"}),e.jsx(pt,{}),e.jsx(ut,{nodeColor:o=>o.type==="input"?"#6366f1":"#94a3b8",maskColor:"rgba(0, 0, 0, 0.05)"})]})}),e.jsx(se,{elevation:2,sx:{width:320,height:"100%",borderRadius:0,borderLeft:"1px solid #e0e0e0",display:"flex",flexDirection:"column"},children:i&&b.find(o=>o.id===i&&o.type==="condition")?e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{p:2,borderBottom:"1px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xt,{sx:{color:"text.secondary",fontSize:20}}),e.jsx(y,{variant:"h6",sx:{fontWeight:600},children:"Condition"})]}),e.jsx(B,{size:"small",onClick:()=>g(null),sx:{color:"text.secondary"},children:e.jsx(Pe,{fontSize:"small"})})]}),e.jsx(f,{sx:{p:2,borderBottom:"1px solid #e0e0e0"},children:e.jsxs(f,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(y,{variant:"body2",color:"text.secondary",children:"Take different actions based on the conditions you set"}),e.jsx(Ae,{sx:{color:"text.secondary",fontSize:16,mt:.25}})]})}),e.jsx(f,{sx:{p:2,borderBottom:"1px solid #e0e0e0"},children:O?e.jsxs(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(Y,{size:"small",fullWidth:!0,placeholder:"Enter description",value:R,onChange:o=>l(o.target.value)}),e.jsx($,{variant:"text",size:"small",onClick:()=>{r(!1),l("")},sx:{textTransform:"none"},children:"Cancel"}),e.jsx($,{variant:"contained",size:"small",onClick:()=>{i&&I(o=>o.map(a=>a.id===i&&a.type==="condition"?{...a,data:{...a.data,description:R}}:a)),r(!1)},sx:{textTransform:"none"},children:"OK"})]}):e.jsx(e.Fragment,{children:i&&b.find(o=>o.id===i&&o.type==="condition")?.data?.description?e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(y,{variant:"body2",color:"text.secondary",sx:{pr:2},children:(b.find(o=>o.id===i&&o.type==="condition")?.data).description}),e.jsx(Le,{component:"button",variant:"body2",onClick:()=>{const o=b.find(a=>a.id===i&&a.type==="condition")?.data?.description||"";l(o),r(!0)},sx:{color:"#6366f1",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Edit"})]}):e.jsxs(Le,{component:"button",variant:"body2",onClick:()=>{l(""),r(!0)},sx:{display:"flex",alignItems:"center",gap:.5,color:"#6366f1",textDecoration:"none",cursor:"pointer","&:hover":{textDecoration:"underline"}},children:[e.jsx(mt,{sx:{fontSize:16}}),"Add description"]})})}),e.jsxs(f,{sx:{flex:1,overflow:"auto",p:2},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:600,mb:2},children:"IF"}),e.jsx($,{variant:"outlined",fullWidth:!0,sx:{textTransform:"none",mb:2,justifyContent:"flex-start",borderColor:"#e0e0e0",color:"text.secondary",backgroundColor:"#f5f5f5","&:hover":{borderColor:"#d0d0d0",backgroundColor:"#f0f0f0"}},onClick:()=>v(!0),children:b.find(o=>o.id===i&&o.type==="condition")?.data?.variable||"Add a variable"}),b.find(o=>o.id===i&&o.type==="condition")?.data?.variable?e.jsxs(se,{elevation:0,sx:{p:2,border:"1px solid #e0e0e0",borderRadius:2,backgroundColor:"#fafafa",position:"relative"},children:[e.jsxs(f,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:.5},children:[e.jsx(B,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(B,{size:"small",sx:{color:"text.secondary"},children:e.jsx(pe,{fontSize:"small"})}),e.jsx(B,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Me,{fontSize:"small"})})]}),e.jsxs(f,{sx:{mb:2},children:[e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Variable"}),e.jsx(y,{variant:"body1",sx:{fontWeight:500},children:P})]}),e.jsxs(Re,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ze,{id:"operator-label",children:"Operator"}),e.jsxs(Be,{labelId:"operator-label",label:"Operator",value:b.find(o=>o.id===i&&o.type==="condition")?.data?.operator||S,onChange:o=>{const a=o.target.value;E(a),i&&I(c=>c.map(s=>s.id===i&&s.type==="condition"?{...s,data:{...s.data,operator:a}}:s))},children:[e.jsx(j,{value:"equal",children:"Equal to"}),e.jsx(j,{value:"not-equal",children:"Not equal to"}),e.jsx(j,{value:"greater-than",children:"Greater than"}),e.jsx(j,{value:"greater-than-or-equal",children:"Greater than or equal to"}),e.jsx(j,{value:"less-than",children:"Less than"}),e.jsx(j,{value:"less-than-or-equal",children:"Less than or equal to"}),e.jsx(j,{value:"is-at-least-one-of",children:"Is at least one of"}),e.jsx(j,{value:"is-not-any-of",children:"Is not any of"}),e.jsx(j,{value:"does-not-exist",children:"Does not exist"}),e.jsx(j,{value:"exists",children:"Exists"})]})]}),e.jsx(Y,{fullWidth:!0,label:"Value",placeholder:"Enter value",variant:"outlined",value:b.find(o=>o.id===i&&o.type==="condition")?.data?.value||"",onChange:o=>{const a=o.target.value;i&&I(c=>c.map(s=>s.id===i&&s.type==="condition"?{...s,data:{...s.data,value:a}}:s))}})]}):e.jsxs(se,{elevation:0,sx:{p:2,border:"1px solid #e0e0e0",borderRadius:2,backgroundColor:"#fafafa",position:"relative"},children:[e.jsxs(f,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:.5},children:[e.jsx(B,{size:"small",sx:{color:"text.secondary"},children:e.jsx(pe,{fontSize:"small"})}),e.jsx(B,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Me,{fontSize:"small"})})]}),e.jsxs(Re,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ze,{id:"operator-label",children:"Operator"}),e.jsxs(Be,{labelId:"operator-label",label:"Operator",value:b.find(o=>o.id===i&&o.type==="condition")?.data?.operator||S,onChange:o=>{const a=o.target.value;E(a),i&&I(c=>c.map(s=>s.id===i&&s.type==="condition"?{...s,data:{...s.data,operator:a}}:s))},children:[e.jsx(j,{value:"equal",children:"Equal to"}),e.jsx(j,{value:"not-equal",children:"Not equal to"}),e.jsx(j,{value:"greater-than",children:"Greater than"}),e.jsx(j,{value:"greater-than-or-equal",children:"Greater than or equal to"}),e.jsx(j,{value:"less-than",children:"Less than"}),e.jsx(j,{value:"less-than-or-equal",children:"Less than or equal to"}),e.jsx(j,{value:"is-at-least-one-of",children:"Is at least one of"}),e.jsx(j,{value:"is-not-any-of",children:"Is not any of"}),e.jsx(j,{value:"does-not-exist",children:"Does not exist"}),e.jsx(j,{value:"exists",children:"Exists"})]})]}),e.jsx(Y,{fullWidth:!0,label:"Value",placeholder:"Enter value",variant:"outlined",value:b.find(o=>o.id===i&&o.type==="condition")?.data?.value||"",onChange:o=>{const a=o.target.value;i&&I(c=>c.map(s=>s.id===i&&s.type==="condition"?{...s,data:{...s.data,value:a}}:s))}})]})]})]}):i&&b.find(o=>o.id===i&&o.type==="action")?e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{p:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:600},children:"Select action"}),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Choose what should happen next"})]}),e.jsx(f,{sx:{flex:1,overflow:"auto"},children:e.jsx(Ee,{sx:{p:0},children:xe.map(o=>{const a=b.find(c=>c.id===i)?.data?.actionType===o.actionType;return e.jsx(We,{disablePadding:!0,children:e.jsx(Oe,{selected:a,onClick:()=>{i&&I(c=>c.map(s=>s.id===i?{...s,data:{...s.data,label:o.name,actionType:o.actionType}}:s))},sx:{py:1.5,px:2,"&.Mui-selected":{backgroundColor:"#f3f4f6",borderLeft:"3px solid #6366f1","&:hover":{backgroundColor:"#f3f4f6"}}},children:e.jsx(Te,{primary:o.name,secondary:o.description,primaryTypographyProps:{fontWeight:a?600:400,color:a?"#6366f1":"text.primary"}})})},o._id)})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{p:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:600},children:"Select trigger"}),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Choose when this automation starts"})]}),e.jsx(f,{sx:{flex:1,overflow:"auto"},children:e.jsx(Ee,{sx:{p:0},children:re.map(o=>{const a=n===o.key;return e.jsx(We,{disablePadding:!0,children:e.jsxs(Oe,{selected:a,onClick:()=>{x(o.key),I(c=>c.map(s=>s.id==="trigger-1"?{...s,data:{...s.data,label:o.name,onAddAction:()=>Q(I,U),onAddCondition:()=>te(I,U),isTriggerSelected:!0,canHaveConditions:!!o.hasConditions,onRequestDelete:(m,d)=>{q({id:m,type:d}),T(!0)}}}:s))},sx:{py:1.5,px:2,"&.Mui-selected":{backgroundColor:"#f3f4f6",borderLeft:"3px solid #6366f1","&:hover":{backgroundColor:"#f3f4f6"}}},children:[e.jsx(yt,{sx:{minWidth:40},children:e.jsx(Wt,{sx:{color:a?"#6366f1":"text.secondary"}})}),e.jsx(Te,{primary:o.name,secondary:o.description,primaryTypographyProps:{fontWeight:a?600:400,color:a?"#6366f1":"text.primary"}})]})},o._id)})})})]})})]}),e.jsxs(he,{open:z,onClose:()=>T(!1),children:[e.jsxs(ge,{children:["Delete ",w?.type," node?"]}),e.jsx(me,{children:e.jsxs(y,{variant:"body2",color:"text.secondary",children:["Do you really want to delete this ",w?.type," node?"]})}),e.jsxs(De,{children:[e.jsx($,{onClick:()=>T(!1),children:"Cancel"}),e.jsx($,{color:"error",onClick:()=>{if(!w)return;if(D.some(a=>a.source===w.id)){nt.error("Can't delete: this node has child nodes."),T(!1);return}I(a=>a.filter(c=>c.id!==w.id)),U(a=>a.filter(c=>c.source!==w.id&&c.target!==w.id)),T(!1),i===w.id&&g(null),q(null)},children:"Delete"})]})]}),e.jsxs(he,{open:ie,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:"Save automation"}),e.jsx(me,{children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(Y,{label:"Name",required:!0,value:Z,onChange:o=>{W(o.target.value),G&&K(null)},error:!!G,helperText:G||""}),e.jsx(Y,{label:"Description",multiline:!0,minRows:2,value:ee,onChange:o=>V(o.target.value)})]})}),e.jsxs(De,{children:[e.jsx($,{onClick:()=>F(!1),children:"Cancel"}),e.jsx($,{variant:"contained",onClick:async()=>{if(!Z.trim()){K("Name is required");return}try{await _e({name:Z.trim(),description:ee})}finally{F(!1)}},children:"Save"})]})]}),e.jsxs(he,{open:h,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(ge,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(y,{variant:"h6",sx:{fontWeight:600},children:"Add a variable"}),e.jsxs(f,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx($,{variant:"text",size:"small",sx:{textTransform:"none",color:"text.secondary"},children:"Configure sample data"}),e.jsx(B,{size:"small",onClick:()=>v(!1),sx:{color:"text.secondary"},children:e.jsx(Pe,{})})]})]}),e.jsxs(me,{sx:{pt:2},children:[e.jsx(Y,{fullWidth:!0,placeholder:"Search by variable name or description",value:C,onChange:o=>k(o.target.value),sx:{mb:3},InputProps:{startAdornment:e.jsx(St,{position:"start",children:e.jsx(bt,{sx:{color:"text.secondary"}})})}}),e.jsx(f,{sx:{mb:3},children:e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ot,{sx:{color:"text.secondary",fontSize:18}}),e.jsx(y,{variant:"body2",sx:{fontWeight:600},children:"Order created"})]}),e.jsx(kt,{label:"Trigger",size:"small",sx:{backgroundColor:"#f3f4f6",color:"text.secondary",fontWeight:500,fontSize:"0.75rem"}})]})}),e.jsx(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:(()=>{const o=re.find(s=>s.key===n),c=(o?.exposedVariables||[]).filter(s=>{if(!C)return!0;const m=C.toLowerCase();return s.path.toLowerCase().includes(m)||s.label.toLowerCase().includes(m)||(s.description||"").toLowerCase().includes(m)});return c.length===0?e.jsx(y,{variant:"body2",color:"text.secondary",children:o?"No variables match your search.":"Select a trigger to see its variables."}):c.map(s=>e.jsx(se,{elevation:0,sx:{p:2,border:"1px solid #e0e0e0",borderRadius:2,cursor:"pointer","&:hover":{backgroundColor:"#f9f9f9",borderColor:"#d0d0d0"}},onClick:()=>{b.find(d=>d.id===i&&d.type==="condition")?(N(s.path),I(d=>d.map(A=>A.id===i?{...A,data:{...A.data,variable:s.path,operator:S}}:A))):N(s.path),v(!1),k("")},children:e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(f,{sx:{flex:1},children:[e.jsxs(y,{variant:"body1",sx:{fontWeight:600,mb:.5},children:[s.label," ",e.jsxs(y,{component:"span",variant:"caption",color:"text.secondary",children:["(",s.path,")"]})]}),e.jsx(y,{variant:"body2",color:"text.secondary",children:s.description||""})]}),e.jsx(B,{size:"small",sx:{color:"text.secondary",ml:1},children:e.jsx(vt,{fontSize:"small"})})]})},s.path))})()})]})]})]})};export{po as default};
