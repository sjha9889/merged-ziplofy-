import{b as Y,c as Z,d as ee,e as te,f as se,u as ae,r as a,j as e,g as re}from"./index-C7S6h9OR.js";import{G as ie}from"./GridBackgroundWrapper-Du1VLjut.js";import{S as D}from"./Select-DGEw1X1o.js";import{M as ne}from"./MultiSelect-DYMnqjW0.js";import{F as ce}from"./ArrowLeftIcon-C1qOxHB_.js";import{F as le}from"./TrashIcon-B2-WJkmb.js";const pe=()=>{const{activeStoreId:i}=Y(),{locations:x,fetchLocationsByStoreId:v}=Z(),{searchProductForTransfer:S,transferProductSearchResult:m,loading:w}=ee(),{tags:u,fetchByStore:T}=te(),{createTransfer:V,loading:C}=se(),I=ae(),[c,E]=a.useState(""),[l,M]=a.useState(""),[p,B]=a.useState(""),[g,F]=a.useState(""),[y,b]=a.useState(new Set),[k,P]=a.useState(""),[L,U]=a.useState(""),[O,$]=a.useState(""),[A,Q]=a.useState([]),q=a.useMemo(()=>u.map(t=>({value:t.name,label:t.name})),[u]),[K,z]=a.useState(!1),[R,_]=a.useState([]),[f,j]=a.useState({}),G=t=>{b(r=>{const s=new Set(r);return s.delete(t),s}),_(r=>r.filter(s=>s.variantId!==t)),j(r=>{const{[t]:s,...n}=r;return n})};a.useEffect(()=>{i&&v(i)},[i,v]),a.useEffect(()=>{i&&T(i)},[i,T]),a.useEffect(()=>{const t=setTimeout(()=>F(p.trim()),450);return()=>clearTimeout(t)},[p]),a.useEffect(()=>{i&&c&&l&&g.length>0&&(async()=>{try{await S({storeId:String(i),q:g,originLocationId:c,destinationLocationId:l,page:1,limit:20})}catch{}})()},[g,c,l,i,S]);const h=a.useMemo(()=>!!(c&&l),[c,l]),d=y.size,W=t=>{b(r=>{const s=new Set(r);return s.has(t)?s.delete(t):s.add(t),s})},H=a.useMemo(()=>x.map(t=>({value:t._id,label:t.name})),[x]),J=a.useMemo(()=>x.map(t=>({value:t._id,label:t.name})),[x]);return e.jsx(ie,{children:e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I("/products/transfers"),className:"p-1 text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-xl font-medium text-gray-900",children:"Create Transfer"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Origin and Destination"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(D,{label:"Origin Location",value:c,options:H,onChange:t=>{t!==l&&E(t)},placeholder:"Select origin location"}),e.jsx(D,{label:"Destination Location",value:l,options:J,onChange:t=>{t!==c&&M(t)},placeholder:"Select destination location"})]})]}),e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Add Products"}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",placeholder:h?"Search products by title or SKU…":"Select origin and destination to start searching",value:p,onChange:t=>B(t.target.value),disabled:!h,className:"w-full px-3 py-1.5 pl-10 text-sm border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400 disabled:bg-gray-50 disabled:text-gray-500"}),e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]}),h&&e.jsxs("div",{className:"space-y-3 mt-3",children:[m.map(t=>{const r=t.product.imageUrls?.[0];return e.jsxs("div",{className:"border border-gray-200 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r?e.jsx("img",{src:r,alt:t.product.title,className:"w-12 h-12 object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.product.title}),e.jsxs("p",{className:"text-xs text-gray-600 font-mono",children:["SKU: ",t.product.sku]})]})]}),e.jsx("div",{className:"border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 w-12"}),e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-gray-900",children:"Variant"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-gray-900",children:"Available at Origin"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-gray-900",children:"Available at Destination"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[t.variants.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-sm text-gray-600",children:"No variants available"})}),t.variants.map(s=>{const n=Object.entries(s.optionValues||{}).map(([o,N])=>String(N)).join(" / ");return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"checkbox",checked:y.has(s._id),onChange:()=>W(s._id),className:"w-4 h-4 text-gray-900 border-gray-200 focus:ring-gray-400"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("p",{className:"text-sm text-gray-900",children:n||"Default"})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("p",{className:`text-sm font-medium ${(s.availability?.origin??0)>0?"text-gray-900":"text-gray-600"}`,children:s.availability?.origin??0})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("p",{className:`text-sm font-medium ${(s.availability?.destination??0)>0?"text-gray-900":"text-gray-600"}`,children:s.availability?.destination??0})})]},s._id)})]})]})})]},t.product._id)}),w&&e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full w-4 h-4 border-2 border-gray-300 border-t-gray-900 mx-auto"})}),!w&&h&&g&&m.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:"No products found matching your search."})}),m.length>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 border border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[d," variant",d===1?"":"s"," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(new Set),className:"px-3 py-1.5 text-sm font-medium border border-gray-200 hover:bg-gray-50 transition-colors",children:"Clear Selection"}),e.jsxs("button",{disabled:d===0,onClick:()=>{const t=[];m.forEach(s=>{const n=s.product.imageUrls?.[0];s.variants.forEach(o=>{if(!y.has(o._id))return;const N=Object.entries(o.optionValues||{}).map(([oe,X])=>String(X)).join(" / ");t.push({variantId:o._id,productTitle:s.product.title,productSku:s.product.sku,productImage:n,variantLabel:N||"Default",sku:o.sku,originAvailable:o.availability?.origin??0})})}),_(t);const r={};t.forEach(s=>{r[s.variantId]=r[s.variantId]??0}),j(r),z(!0)},className:"px-3 py-1.5 text-sm font-medium bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Add ",d||0," Variant",d===1?"":"s"," to Transfer"]})]})]})]})]}),K&&e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Selected Variants"}),e.jsx("div",{className:"border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-900",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-900",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Available at Origin"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Transfer Quantity"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-900",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[R.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-sm text-gray-600",children:"No variants selected."})}),R.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.productImage?e.jsx("img",{src:t.productImage,alt:t.productTitle,className:"w-10 h-10 object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.productTitle}),e.jsx("p",{className:"text-xs text-gray-600",children:t.variantLabel})]})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("p",{className:"text-sm text-gray-900 font-mono",children:t.sku})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("p",{className:`text-sm font-medium ${t.originAvailable>0?"text-gray-900":"text-gray-600"}`,children:t.originAvailable})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("input",{type:"number",min:0,max:t.originAvailable,value:f[t.variantId]??0,onChange:r=>{const s=Math.max(0,Math.min(Number(r.target.value||0),t.originAvailable));j(n=>({...n,[t.variantId]:s}))},className:"w-24 px-2 py-1 text-sm border border-gray-200 text-right focus:outline-none focus:ring-1 focus:ring-gray-400"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{onClick:()=>G(t.variantId),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})})]},t.variantId))]})]})})]}),e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Notes"}),e.jsx("textarea",{rows:4,placeholder:"Add any notes for this transfer...",value:k,onChange:t=>P(t.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400 resize-y"})]}),e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Transfer Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1.5",children:"Transfer Date"}),e.jsx("input",{type:"date",value:L,onChange:t=>U(t.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1.5",children:"Reference Name"}),e.jsx("input",{type:"text",placeholder:"Optional reference name",value:O,onChange:t=>$(t.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-400"})]})]})]}),e.jsxs("div",{className:"border border-gray-200 p-4 bg-white/95",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Tags"}),e.jsx(ne,{label:"Select Tags",value:A,options:q,onChange:Q,placeholder:"No tags"})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsx("button",{disabled:!c||!l||Object.values(f).every(t=>(t||0)<=0)||C,onClick:async()=>{const t=Object.entries(f).filter(([,s])=>(s||0)>0).map(([s,n])=>({variantId:s,quantity:n}));if(!i||!c||!l||t.length===0)return;const r=A.map(s=>u.find(n=>n.name===s)?._id).filter(Boolean);try{await V({storeId:String(i),originLocationId:c,destinationLocationId:l,referenceName:O,note:k,tags:r,transferDate:L||void 0,entries:t}),I("/products/transfers")}catch{}},className:"px-3 py-1.5 text-sm font-medium bg-gray-900 text-white hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:C?"Creating Transfer…":"Create Transfer"})})]})]})})};export{pe as default};
