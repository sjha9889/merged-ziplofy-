import{u as oe,R as a,h as de,b as ue,d as me,Q as xe,S as ge,j as e,k as re}from"./index-C7S6h9OR.js";import{G as pe}from"./GridBackgroundWrapper-Du1VLjut.js";import{F as he}from"./ArrowLeftIcon-C1qOxHB_.js";const je=()=>{const _=oe(),[p,B]=a.useState(!1),[h,P]=a.useState("30"),[W,U]=a.useState(""),[x,S]=a.useState("free"),[w,A]=a.useState(""),[f,G]=a.useState(!1),[v,K]=a.useState(""),[i,y]=a.useState(!0),[o,b]=a.useState(!1),[V,L]=a.useState(""),[M,T]=a.useState(""),[E,ae]=a.useState(""),[k,j]=a.useState([]),[R,g]=a.useState({}),{searchCollections:H}=de(),{activeStoreId:c}=ue(),[D,O]=a.useState([]),[le,C]=a.useState(!1),{searchProductsWithVariants:J}=me(),[Q,$]=a.useState([]),[ne,F]=a.useState(!1),{rules:r,getByStoreId:X,updateRules:Y,loading:ce}=xe(),{items:I,getByReturnRulesId:Z,createItem:ee}=ge(),u=a.useMemo(()=>({enabled:p,returnWindow:h==="custom"?W||"":h,returnShippingCost:x==="customer"?"customer provides return shipping":x==="flat"?"flat rate return shipping":"free return shipping",flatRate:x==="flat"?w?Number(w):0:void 0,chargeRestockingFree:f,restockingFee:f?v?Number(v):0:void 0,finalSaleSelection:i?"collections":o?"products":"collections"}),[p,h,W,x,w,f,v,i,o]),N=a.useMemo(()=>r?{enabled:!!r.enabled,returnWindow:String(r.returnWindow||""),returnShippingCost:r.returnShippingCost,flatRate:r.flatRate!=null?Number(r.flatRate):void 0,chargeRestockingFree:!!r.chargeRestockingFree,restockingFee:r.restockingFee!=null?Number(r.restockingFee):void 0,finalSaleSelection:r.finalSaleSelection||"collections"}:null,[r]),ie=a.useMemo(()=>{if(!N)return!1;const t=u,s=N;return t.enabled!==s.enabled||t.returnWindow!==s.returnWindow||t.returnShippingCost!==s.returnShippingCost||(t.flatRate??void 0)!==(s.flatRate??void 0)||t.chargeRestockingFree!==s.chargeRestockingFree||(t.restockingFee??void 0)!==(s.restockingFee??void 0)||t.finalSaleSelection!==s.finalSaleSelection},[u,N]);a.useEffect(()=>{c&&X(c).catch(()=>{})},[c,X]),a.useEffect(()=>{if(!r)return;Z(r._id).catch(()=>{}),B(!!r.enabled);const t=String(r.returnWindow||"").trim();["14","30","90","unlimited"].includes(t)?(P(t),U("")):t&&(P("custom"),U(t)),r.returnShippingCost==="customer provides return shipping"?S("customer"):r.returnShippingCost==="flat rate return shipping"?S("flat"):S("free"),A(r.flatRate!=null?String(r.flatRate):""),G(!!r.chargeRestockingFree),K(r.restockingFee!=null?String(r.restockingFee):""),r.finalSaleSelection==="collections"?(y(!0),b(!1),g({})):r.finalSaleSelection==="products"?(y(!1),b(!0),j([])):(y(!0),b(!1),g({}))},[r,Z]),a.useEffect(()=>{if(!i)return;const t=V.trim();if(!t||t.length<2||!c){O([]);return}const s=setTimeout(async()=>{try{const l=await H(c,t,1,10);O(l.data.map(n=>({id:n._id,title:n.title}))),C(!0)}catch{O([]),C(!1)}},300);return()=>clearTimeout(s)},[V,c,H,i]),a.useEffect(()=>{if(!o||!c)return;const t=E.trim();if(!t||t.length<2){$([]),F(!1);return}const s=setTimeout(async()=>{try{const l=await J({storeId:c,q:t,limit:5});$(l.data||[]),F(!0)}catch{$([]),F(!1)}},400);return()=>clearTimeout(s)},[E,c,J,o]);const te=a.useMemo(()=>i&&!o?"collections":o&&!i?"products":r?.finalSaleSelection||"collections",[i,o,r?.finalSaleSelection]),z=a.useMemo(()=>I.filter(t=>typeof t.collectionId=="object"&&t.collectionId!==null),[I]),se=a.useMemo(()=>I.filter(t=>typeof t.productVariantId=="object"&&t.productVariantId!==null),[I]);return e.jsx(pe,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>_(-1),className:"p-1 text-gray-600 hover:text-gray-700 hover:bg-gray-100 transition-colors",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("h1",{className:"text-xl font-medium text-gray-900",children:"Manage return rules"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[ie&&r&&e.jsx("button",{disabled:ce,onClick:async()=>{await Y(r._id,{enabled:u.enabled,returnWindow:u.returnWindow,returnShippingCost:u.returnShippingCost,flatRate:u.flatRate,chargeRestockingFree:u.chargeRestockingFree,restockingFee:u.restockingFee}),_("/settings/policies")},className:"px-3 py-1.5 text-sm text-white bg-gray-900 hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Save"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("span",{className:"text-sm text-gray-900",children:p?"Return rules on":"Return rules off"}),e.jsx("button",{type:"button",className:`relative w-11 h-6 transition-colors ${p?"bg-gray-900":"bg-gray-300"}`,onClick:()=>B(t=>!t),children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white transition-transform ${p?"translate-x-5":"translate-x-0"}`})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 bg-white p-4 mb-4",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Return window"}),e.jsx("div",{className:"space-y-2 mb-4",children:["14","30","90","unlimited","custom"].map(t=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"windowType",value:t,checked:h===t,onChange:s=>P(s.target.value),className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:t==="custom"?"Custom days":t==="unlimited"?"Unlimited":`${t} days`})]},t))}),h==="custom"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Number of days"}),e.jsx("input",{type:"text",value:W,onChange:t=>U(t.target.value),className:"w-full max-w-[220px] border border-gray-200 px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400",placeholder:"Number of days"})]}),e.jsx("hr",{className:"my-4 border-gray-200"}),e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-1",children:"Return shipping cost"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Does not apply to returns using Point of Sale"}),e.jsx("div",{className:"space-y-2 mb-4",children:["customer","free","flat"].map(t=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shippingCost",value:t,checked:x===t,onChange:s=>S(s.target.value),className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:t==="customer"?"Customer provides return shipping":t==="free"?"Free return shipping":"Flat rate return shipping"})]},t))}),x==="flat"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Flat rate"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"₹"}),e.jsx("input",{type:"number",value:w,onChange:t=>A(t.target.value),placeholder:"0.00",className:"w-full max-w-[220px] border border-gray-200 px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"})]})]}),e.jsx("hr",{className:"my-4 border-gray-200"}),e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-3",children:"Restocking fee"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-3",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>G(t.target.checked),className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Charge restocking fee"})]}),f&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Restocking fee (%)"}),e.jsx("input",{type:"number",value:v,onChange:t=>K(t.target.value),placeholder:"0",className:"w-full max-w-[220px] border border-gray-200 px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-600",children:"Return rules will only apply to items purchased after the return rules were turned on or updated."})})]}),e.jsxs("div",{className:"border border-gray-200 bg-white p-4 mb-4",children:[e.jsx("h2",{className:"text-base font-medium text-gray-900 mb-1",children:"Final sale items"}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Customers can't request returns for products set as final sale"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:t=>{const s=t.target.checked;y(s),s?(b(!1),g({})):j([])},className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Specific collections"})]}),i&&e.jsxs("div",{className:"flex gap-2 items-start flex-wrap relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search collections",value:V,onChange:t=>{L(t.target.value),M&&T("")},onFocus:()=>D.length&&C(!0),className:"min-w-[280px] border border-gray-200 px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"}),le&&D.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 min-w-[280px] max-h-60 overflow-y-auto border border-gray-200 bg-white",children:D.map(t=>e.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-50 transition-colors",onMouseDown:()=>{const s=k.some(n=>n.id===t.id),l=z.some(n=>{const m=n.collectionId,d=typeof m=="object"?m?._id:m;return d&&d.toString()===t.id});s||l?T("This collection is already added to final sale."):(j(n=>[...n,t]),T("")),L(""),C(!1)},children:e.jsx("p",{className:"text-sm text-gray-900",children:t.title})},t.id))})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:k.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[t.title,e.jsx("button",{onClick:()=>j(s=>s.filter(l=>l.id!==t.id)),className:"hover:text-gray-900",children:e.jsx(re,{className:"w-3 h-3"})})]},t.id))}),M&&e.jsx("p",{className:"text-xs text-red-600",children:M})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>{const s=t.target.checked;b(s),s?(y(!1),j([])):g({})},className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Specific products"})]}),o&&e.jsxs("div",{className:"flex flex-col gap-2 relative",children:[e.jsx("input",{type:"text",placeholder:"Search products",value:E,onChange:t=>ae(t.target.value),onFocus:()=>Q.length&&F(!0),className:"min-w-[280px] border border-gray-200 px-3 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"}),ne&&Q.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 min-w-[360px] max-h-[360px] overflow-y-auto border border-gray-200 bg-white p-2",children:Q.map(t=>e.jsxs("div",{className:"mb-2 border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50",children:[e.jsx("div",{className:"w-8 h-8 border border-gray-200 overflow-hidden bg-white",children:t.product.imageUrl?e.jsx("img",{src:t.product.imageUrl,alt:t.product.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-200"})}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.product.title})]}),e.jsx("div",{children:t.variants.map(s=>{const l=Object.values(s.optionValues||{}).join(" / ")||s.sku||"Variant",n=!!R[s._id];return e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 border-t border-gray-100 cursor-pointer transition-colors ${n?"bg-gray-50":"bg-white"}`,onMouseDown:()=>{g(m=>{const d={...m};return d[s._id]?delete d[s._id]:d[s._id]={id:s._id,productTitle:t.product.title,optionSummary:l,imageUrl:s.images&&s.images.length>0?s.images[0]:t.product.imageUrl||null},d})},children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>{},className:"w-4 h-4 text-gray-900 focus:ring-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l}),e.jsx("p",{className:"text-xs text-gray-600",children:s.sku||"SKU N/A"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["₹",s.price?.toFixed(2)??"0.00"]})]},s._id)})})]},t.product._id))}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-2",children:Object.values(R).map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-gray-100 text-gray-700 border border-gray-200",children:[t.productTitle," • ",t.optionSummary,e.jsx("button",{onClick:()=>g(s=>{const l={...s};return delete l[t.id],l}),className:"hover:text-gray-900",children:e.jsx(re,{className:"w-3 h-3"})})]},t.id))})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:(()=>{const t=i&&k.length>0,s=o&&Object.keys(R).length>0,l=i&&!o?"collections":o&&!i?"products":u.finalSaleSelection,n=N&&l!==N.finalSaleSelection,m=!r||!c||!t&&!s&&!n;return e.jsx("button",{disabled:m,onClick:async()=>{if(!r||!c)return;const d=[];if(t)for(const q of k)d.push(ee({returnRulesId:r._id,storeId:c,collectionId:q.id}));s&&Object.values(R).forEach(q=>{d.push(ee({returnRulesId:r._id,storeId:c,productVariantId:q.id}))}),d.length>0&&await Promise.all(d),n&&await Y(r._id,{finalSaleSelection:l}),_("/settings/policies")},className:"px-3 py-1.5 text-sm text-white bg-gray-900 hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Save"})})()})]}),e.jsxs("div",{className:"border border-gray-200 bg-white p-4 mb-4",children:[e.jsxs("h2",{className:"text-base font-medium text-gray-900 mb-3",children:["Current ",te==="collections"?"final sale collections":"final sale products"]}),te==="collections"?z.length>0?e.jsx("div",{className:"flex flex-col gap-2",children:z.map(t=>{const s=t.collectionId;return e.jsx("div",{className:"border border-gray-200 p-3 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s?.title||"Collection"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["ID: ",s?._id||t.collectionId]})]})},t._id)})}):e.jsx("p",{className:"text-sm text-gray-600",children:"No collections added to final sale yet."}):se.length>0?e.jsx("div",{className:"flex flex-col gap-2",children:se.map(t=>{const s=t.productVariantId,l=Object.values(s?.optionValues||{}).join(" / ")||s?.sku||"Variant",n=s?.images&&s.images.length>0&&s.images[0]||s?.productId?.imageUrls&&s.productId.imageUrls.length>0&&s.productId.imageUrls[0]||null;return e.jsxs("div",{className:"border border-gray-200 p-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 border border-gray-200 bg-gray-50 overflow-hidden",children:n?e.jsx("img",{src:n,alt:s?.sku||"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-200"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s?.productId?.title||"Product"}),e.jsx("p",{className:"text-xs text-gray-600",children:l}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",s?.sku||"N/A"]})]})]},t._id)})}):e.jsx("p",{className:"text-sm text-gray-600",children:"No products added to final sale yet."})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Learn more about ",e.jsx("a",{href:"#",className:"text-gray-700 hover:underline",children:"return rules"})]})})]})})};export{je as default};
