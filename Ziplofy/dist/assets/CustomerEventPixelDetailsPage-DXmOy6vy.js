import{j as e,u as O,p as z,b as H,aA as W,r,O as m}from"./index-C7S6h9OR.js";import{D as J,a as y}from"./DropdownMenuItem-mg0iuV3h.js";import{F}from"./InformationCircleIcon-B4YRJG0O.js";import{G as j}from"./GridBackgroundWrapper-Du1VLjut.js";import{F as K}from"./ArrowLeftIcon-C1qOxHB_.js";import{F as Q}from"./EllipsisHorizontalIcon-CCX74wqb.js";const U=({code:t,onCodeChange:i})=>e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Code"}),e.jsx("div",{className:"relative group",children:e.jsx(F,{className:"w-5 h-5 text-gray-500 cursor-help",title:"Pixel code snippet"})})]}),e.jsx("textarea",{value:t,rows:8,onChange:l=>i(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),V=({dataSale:t,onDataSaleChange:i})=>e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4",children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Data sale"}),e.jsx("fieldset",{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"qualifies_as_data_sale",checked:t==="qualifies_as_data_sale",onChange:l=>i(l.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Data collected qualifies as data sale"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"qualifies_as_data_sale_limited_use",checked:t==="qualifies_as_data_sale_limited_use",onChange:l=>i(l.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Data collected qualifies as data sale and supports limited data use"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"dataSale",value:"does_not_qualify_as_data_sale",checked:t==="does_not_qualify_as_data_sale",onChange:l=>i(l.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Data collected does not qualify as data sale"})]})]})})]}),X=[{key:"marketing",label:"Marketing"},{key:"analytics",label:"Analytics"},{key:"preferences",label:"Preferences"}],Y=({permission:t,purposes:i,onPermissionChange:l,onPurposeChange:p})=>e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4",children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Permission"}),e.jsx("fieldset",{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"permission",value:"required",checked:t==="required",onChange:n=>l(n.target.value),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-900",children:"Required"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 mb-2",children:"The pixel will collect data when permission is granted for selected purposes."}),e.jsx("div",{className:"flex flex-col gap-2 ml-6 mb-3",children:X.map(({key:n,label:h})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i[n],onChange:()=>p(n),disabled:t!=="required",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("span",{className:`text-sm ${t!=="required"?"text-gray-400":"text-gray-900"}`,children:h})]},n))})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"permission",value:"not_required",checked:t==="not_required",onChange:n=>l(n.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:"Not required"})]})]})})]}),le=()=>{const t=O(),{pixelId:i}=z(),{activeStoreId:l}=H(),{pixels:p,fetchByStoreId:n,loading:h,remove:N,update:v}=W(),[w,_]=r.useState(null),[c,k]=r.useState(""),[d,C]=r.useState("required"),[o,g]=r.useState({marketing:!1,analytics:!1,preferences:!1}),[u,q]=r.useState("does_not_qualify_as_data_sale"),[x,P]=r.useState(""),s=r.useMemo(()=>p.find(a=>a._id===i),[p,i]);r.useEffect(()=>{l&&(s||n(l).catch(a=>{m.error(a?.message||"Failed to fetch pixel details")}))},[l,s,n]),r.useEffect(()=>{s&&(k(s.pixelName??""),C(s.required?"required":"not_required"),g({marketing:!!s.marketing,analytics:!!s.analytics,preferences:!!s.preferences}),q(s.dataSale),P(s.code??""))},[s]);const E=r.useCallback(async()=>{if(s)try{await N(s._id),m.success("Pixel deleted"),t("/settings/customer-events")}catch(a){m.error(a?.message||"Failed to delete pixel")}},[s,N,t]),M=r.useCallback(a=>{_(a.currentTarget)},[]),S=r.useCallback(()=>{_(null)},[]),R=r.useCallback(a=>{g(b=>({...b,[a]:!b[a]}))},[]),B=r.useMemo(()=>{if(!s)return!1;const a=c.trim(),b=s.pixelName??"",G=s.required?"required":"not_required",f={marketing:!!s.marketing,analytics:!!s.analytics,preferences:!!s.preferences};return a!==b||d!==G||f.marketing!==o.marketing||f.analytics!==o.analytics||f.preferences!==o.preferences||u!==s.dataSale||x!==(s.code??"")},[s,c,d,o,u,x]),L=r.useCallback(async()=>{if(s)try{const a={pixelName:c.trim(),required:d==="required",notRequired:d==="not_required",marketing:d==="required"?o.marketing:!1,analytics:d==="required"?o.analytics:!1,preferences:d==="required"?o.preferences:!1,dataSale:u,code:x};await v(s._id,a),m.success("Pixel updated")}catch(a){m.error(a?.message||"Failed to update pixel")}},[s,c,d,o,u,x,v]),A=r.useCallback(a=>{C(a),a==="not_required"&&g({marketing:!1,analytics:!1,preferences:!1})},[]),I=r.useCallback(a=>{q(a)},[]),T=r.useCallback(a=>{P(a)},[]),$=r.useCallback(()=>{t("/settings/customer-events")},[t]);return i?l?e.jsx(j,{children:e.jsxs("div",{className:"max-w-[960px] mx-auto py-8 px-4",children:[e.jsxs("button",{onClick:$,className:"flex items-center gap-2 text-gray-700 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to pixels"})]}),h&&!s?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 w-full space-y-2",children:[e.jsx("input",{type:"text",value:c,onChange:a=>k(a.target.value),maxLength:50,placeholder:"Pixel name",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["For enhanced security and stability, pixel access is sandboxed."," ",e.jsx(D,{text:"Learn more",href:"#"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&e.jsx("button",{onClick:L,disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:"Save"}),e.jsx("button",{disabled:!0,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Test"}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-blue-600 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Connect"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:M,className:"p-2 text-gray-700 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsxs(J,{anchorEl:w,open:!!w,onClose:S,children:[e.jsx(y,{disabled:!0,children:"Edit pixel name"}),e.jsx(y,{disabled:!0,children:"Hire a Shopify Partner"}),e.jsx(y,{onClick:()=>{S(),E()},children:e.jsx("span",{className:"text-red-600",children:"Delete pixel"})})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg mt-6 flex items-start gap-2",children:[e.jsx(F,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:"For enhanced security and stability, pixel access is sandboxed."})]}),e.jsxs("div",{className:"border border-gray-300 rounded-xl mt-6 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Customer privacy"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{permission:d,purposes:o,onPermissionChange:A,onPurposeChange:R}),e.jsx(V,{dataSale:u,onDataSaleChange:I})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:["See how these settings apply to your store in"," ",e.jsx(D,{text:"Customer privacy",href:"#"})]})]}),e.jsx(U,{code:x,onCodeChange:T})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-md",children:"Pixel not found or no longer exists."})]})}):e.jsx(j,{children:e.jsx("div",{className:"max-w-[960px] mx-auto py-8 px-4",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-md",children:"Select a store to view pixel details."})})}):e.jsx(j,{children:e.jsx("div",{className:"max-w-[960px] mx-auto py-8 px-4",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-md",children:"No pixel selected."})})})},D=({text:t,href:i})=>e.jsx("a",{href:i,className:"text-blue-600 hover:text-blue-700 hover:underline",children:t});export{le as default};
