import{j as e,O as m,u as A,b as L,aF as R,K as M,r as d,o as $,L as I}from"./index-C7S6h9OR.js";import{M as P}from"./Modal-DsfhGJdg.js";import{G as O}from"./GridBackgroundWrapper-Du1VLjut.js";import{F as V}from"./ChevronRightIcon-CVun6pAX.js";import{F as K}from"./UserIcon-BNYzLby0.js";import{F as W}from"./UsersIcon-BqNcbeHW.js";import{F as z}from"./CodeBracketIcon-CDI8TT-2.js";import"./index-CCB_rw4P.js";const B=({open:i,onClose:s,emailInput:t,onEmailInputChange:o,onSubmit:n,saving:l})=>{const h=u=>{u.key==="Enter"&&t.trim()&&!l&&n()};return e.jsxs(P,{open:i,onClose:s,title:"Add sender email",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,disabled:l,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancel"}),e.jsx("button",{onClick:n,disabled:!t.trim()||l,className:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed min-w-[100px] transition-colors",children:l?"Adding...":"Add email"})]}),children:[e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"The email your store uses to send emails to your customers"}),e.jsx("input",{type:"email",value:t,onChange:o,placeholder:"example@email.com",autoFocus:!0,onKeyPress:h,className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"})]})},D=({icon:i,title:s,description:t,path:o,onNavigate:n,showDivider:l=!1})=>e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{n(o)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"shrink-0 w-8 flex items-center justify-center",children:i}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s}),t&&e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:t})]}),e.jsx(V,{className:"w-4 h-4 text-gray-500 shrink-0"})]}),l&&e.jsx("div",{className:"h-px bg-gray-200 mx-4"})]}),G=({items:i,onNavigate:s})=>e.jsx("div",{className:"border border-gray-200 bg-white/95",children:i.map((t,o)=>e.jsx(D,{icon:t.icon,title:t.title,description:t.description,path:t.path,onNavigate:s,showDivider:o<i.length-1},t.path))}),T=({loading:i,storeNotificationEmail:s,onOpenAddEmailModal:t})=>e.jsxs("div",{className:"border border-gray-200 p-4 mb-4 bg-white/95",children:[e.jsx("h2",{className:"text-sm font-medium mb-1 text-gray-900",children:"Sender email"}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"The email your store uses to send emails to your customers"}),i?e.jsx("p",{className:"text-xs text-gray-600 py-2",children:"Loading..."}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"email",value:s.email,disabled:!0,className:"flex-1 px-3 py-2 border border-gray-200 bg-white text-sm text-gray-900 disabled:bg-gray-50 disabled:text-gray-500"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium h-8 flex items-center ${s.isVerified?"bg-gray-100 text-gray-700":"bg-gray-100 text-gray-600"}`,children:s.isVerified?"Verified":"Unverified"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Confirm you have access to this email."," ",e.jsx("button",{onClick:o=>{o.preventDefault(),m.success("Verification email sent")},className:"text-gray-700 hover:underline",children:"Resend verification"})]})})]}):e.jsx("div",{className:"flex justify-end items-center mt-2",children:e.jsx("button",{onClick:t,className:"px-3 py-1.5 bg-gray-900 text-white text-sm hover:bg-gray-800 transition-colors",children:"Add email"})})]}),Z=()=>{const i=A(),{activeStoreId:s}=L(),{storeNotificationEmail:t,loading:o,getByStoreId:n,create:l,update:h}=R(),{categories:u,fetchAll:b,loading:j}=M(),[N,p]=d.useState(!1),[x,g]=d.useState(""),[w,y]=d.useState(!1);d.useEffect(()=>{s&&n(s).catch(()=>{})},[s,n]),d.useEffect(()=>{u.length===0&&!j&&b().catch(()=>{})},[]);const v=d.useCallback(a=>{const r=a.toLowerCase(),c="w-5 h-5 text-gray-600";return r.includes("customer")?e.jsx(K,{className:c}):r.includes("staff")?e.jsx(W,{className:c}):r.includes("fulfillment")?e.jsx($,{className:c}):e.jsx(I,{className:c})},[]),C=a=>{const r=a.toLowerCase();return r.includes("customer")?"customer":r.includes("staff")?"staff":r.includes("fulfillment")?"fulfillment-request-notification":r.replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")},k=(a,r)=>{const c=C(r);return`/settings/notifications/${a}/${c}`},E=d.useCallback(()=>{p(!0),g("")},[]),f=d.useCallback(()=>{p(!1),g("")},[]),F=d.useCallback(async()=>{if(!s){m.error("No store selected. Please select a store.");return}if(!x.trim()){m.error("Please enter an email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.trim())){m.error("Please enter a valid email address");return}y(!0);try{await l({storeId:s,email:x.trim().toLowerCase(),isVerified:!1}),m.success("Email added successfully"),f(),await n(s)}catch(r){const c=r?.response?.data?.message||r?.message||"Failed to add email";m.error(c)}finally{y(!1)}},[s,x,l,n,f]),S=[...u.map(a=>({icon:v(a.name),title:a.name,description:a.description||"",path:k(a._id,a.name)})),{icon:e.jsx(z,{className:"w-5 h-5 text-gray-600"}),title:"Webhooks",description:"Send XML or JSON notifications about store events to a URL",path:"/settings/notifications/webhooks"}];return e.jsx(O,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsx("div",{className:"mb-4 border-b border-gray-200 pb-4",children:e.jsx("h1",{className:"text-xl font-medium text-gray-900",children:"Notifications"})}),e.jsx(T,{loading:o,storeNotificationEmail:t,onOpenAddEmailModal:E}),e.jsx(B,{open:N,onClose:f,emailInput:x,onEmailInputChange:a=>g(a.target.value),onSubmit:F,saving:w}),e.jsx(G,{items:S,onNavigate:i})]})})};export{Z as default};
