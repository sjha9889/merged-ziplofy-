const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/grapes-CmaZ8ygx.css"])))=>i.map(i=>d[i]);
import{p as I,r as n,u as P,b as R,j as t,ai as b}from"./index-C7S6h9OR.js";const T=()=>{const{themeId:s=""}=I(),p=n.useRef(null),m=P(),{activeStoreId:f}=R(),[S,l]=n.useState(!0),[h,g]=n.useState(null),[y,j]=n.useState("");return n.useEffect(()=>{let d,_=!1;async function E(){try{l(!0),g(null);const c=(await b(async()=>{const{default:e}=await import("./grapes-e2OmM4qI.js");return{default:e}},[])).default;await b(()=>Promise.resolve({}),__vite__mapDeps([0]));const o="https://backend.ziplofy.com/api",u=`?v=${Date.now()}`,v=(()=>{try{const e=localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")||localStorage.getItem("token")||sessionStorage.getItem("token");if(!e)return null;const a=e.split(".");if(a.length<2)return null;const r=JSON.parse(atob(a[1].replace(/-/g,"+").replace(/_/g,"/")));return String(r.uid||r.userId||r.id||"")}catch{return null}})();try{const e=await fetch(`${o}/themes/${s}`,{credentials:"include"});if(e.ok){const a=await e.json(),r=a?.data?.name||a?.name||"Theme";j(r)}}catch{}const i=f?`${o}/themes/installed/${f}/${s}/unzippedTheme`:v?`${o}/themes/installed/${v}/${s}/unzippedTheme`:null;let x=`${o}/themes/preview/${s}`,w=`${o}/themes/preview/${s}/assets/css/style.css`;i&&(await fetch(`${i}/index.html${u}`,{credentials:"include"})).ok&&(x=`${i}/index.html${u}`,w=`${i}/assets/css/style.css${u}`);const $=await fetch(x,{credentials:"include"});if(!$.ok)throw new Error("Failed to load theme HTML for editor");const k=await $.text();if(_)return;d=c.init({container:p.current,fromElement:!1,height:"calc(100vh - 100px)",storageManager:{autoload:!1},canvas:{styles:[w]},selectorManager:{componentFirst:!0}}),d.setComponents(k),d.Panels.addButton("options",{id:"preview-page",className:"fa fa-eye",attributes:{title:"Preview"},command:"preview"}),l(!1)}catch(c){g(c?.message||"Failed to initialize editor"),l(!1)}}return E(),()=>{_=!0}},[s]),t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0"},children:[t.jsx("button",{onClick:()=>{typeof window<"u"&&window.history.length>1?m(-1):m("/themes/all-themes")},style:{border:"1px solid #d1d5da",background:"#fff",color:"#111827",padding:"6px 10px",borderRadius:6,cursor:"pointer"},children:"‚Üê Back"}),t.jsx("div",{style:{fontWeight:700,fontSize:16},children:y?`Editing: ${y}`:"Editing Theme"})]}),S&&t.jsx("div",{children:"Loading editor..."}),h&&t.jsx("div",{style:{color:"red"},children:h}),t.jsx("div",{ref:p,style:{flex:1,minHeight:600,border:"1px solid #e5e7eb",borderRadius:6}})]})},B=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"})),F=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{B as T,F as a};
