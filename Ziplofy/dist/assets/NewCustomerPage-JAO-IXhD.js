import{r as n,j as e,R as k,k as T,u as S,C as M,b as E,aw as _}from"./index-C7S6h9OR.js";import{F as L}from"./ArrowLeftIcon-C1qOxHB_.js";const R=({data:a,onChange:r})=>{const o=n.useCallback(d=>c=>{r(d,c.target.value)},[r]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:["First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.firstName,onChange:o("firstName"),required:!0,className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:["Last Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.lastName,onChange:o("lastName"),required:!0,className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:a.email,onChange:o("email"),required:!0,className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:a.phoneNumber,onChange:o("phoneNumber"),required:!0,className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Language"}),e.jsxs("select",{value:a.language,onChange:o("language"),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"es",children:"Spanish"}),e.jsx("option",{value:"fr",children:"French"}),e.jsx("option",{value:"de",children:"German"})]})]})]})]})},F=({notes:a,onChange:r})=>{const o=n.useCallback(d=>{r(d.target.value)},[r]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Notes"}),e.jsx("textarea",{value:a,onChange:o,placeholder:"Add any additional notes about this customer...",rows:4,className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors resize-none"})]})},D=({selectedTagIds:a,customerTags:r,onTagSelect:o,onTagRemove:d,onCreateTag:c})=>{const[f,b]=k.useState(""),[x,u]=k.useState(!1),[m,l]=k.useState(""),p=n.useRef(null),g=n.useRef(null),w=n.useCallback(s=>{b(s.target.value),x||u(!0)},[x]),y=n.useCallback(s=>{o(s),b(""),u(!0)},[o]),v=n.useCallback(async()=>{m.trim()&&(await c(m),b(""),u(!0))},[m,c]);n.useEffect(()=>{const s=setTimeout(()=>l(f.trim()),250);return()=>clearTimeout(s)},[f]),n.useEffect(()=>{const s=t=>{p.current&&!p.current.contains(t.target)&&g.current&&!g.current.contains(t.target)&&u(!1)};return x&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[x]);const N=n.useMemo(()=>{const s=m.toLowerCase();if(!s)return r.slice(0,10);const t=r.filter(h=>h.name.toLowerCase().startsWith(s)),i=r.filter(h=>!h.name.toLowerCase().startsWith(s)&&h.name.toLowerCase().includes(s)).sort((h,C)=>h.name.toLowerCase().indexOf(s)-C.name.toLowerCase().indexOf(s));return[...t,...i].slice(0,10)},[m,r]),j=n.useMemo(()=>{const s=m.trim();return s&&!r.some(t=>t.name.toLowerCase()===s.toLowerCase())},[m,r]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Customer Tags"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:g,type:"text",value:f,placeholder:"Search or create customer tags",onChange:w,onFocus:()=>u(!0),className:"w-full px-3 py-2 text-sm text-gray-900 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"}),a.length>0&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[a.length," selected"]}),x&&(N.length>0||j)&&e.jsxs("div",{ref:p,className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-[300px] overflow-y-auto",onMouseDown:s=>s.preventDefault(),children:[N.map(s=>{const t=a.includes(s._id);return e.jsxs("div",{onClick:()=>y(s._id),className:"px-3 py-2 cursor-pointer flex items-center gap-2 hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:t,readOnly:!0,className:"w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name})]},s._id)}),j&&e.jsx("div",{onClick:v,className:"px-3 py-2 cursor-pointer hover:bg-gray-50 transition-colors font-medium",children:e.jsxs("span",{className:"text-sm text-gray-700",children:["+ ",m]})})]})]}),a.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.map(s=>{const t=r.find(i=>i._id===s);return e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-gray-100 border border-gray-200 rounded text-sm text-gray-700",children:[e.jsx("span",{children:t?.name||"Unknown"}),e.jsx("button",{type:"button",onClick:()=>d(s),className:"p-0.5 hover:bg-gray-200 rounded transition-colors","aria-label":"Remove tag",children:e.jsx(T,{className:"w-3.5 h-3.5 text-gray-500"})})]},s)})})]})},q=({data:a,onChange:r})=>{const o=n.useCallback(d=>c=>{r(d,c.target.checked)},[r]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Marketing Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.agreedToMarketingEmails,onChange:o("agreedToMarketingEmails"),className:"w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Agreed to receive marketing emails"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.agreedToSmsMarketing,onChange:o("agreedToSmsMarketing"),className:"w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Agreed to receive SMS marketing"})]})]})]})},O=({data:a,onChange:r})=>{const o=n.useCallback(d=>c=>{r("taxSettings.collectTax",d)},[r]);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Tax Settings"}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Collection"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"collectTax",value:"collect",checked:a.collectTax==="collect",onChange:o("collect"),className:"w-4 h-4 text-gray-900 border-gray-300 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Collect Tax"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"collectTax",value:"dont_collect",checked:a.collectTax==="dont_collect",onChange:o("dont_collect"),className:"w-4 h-4 text-gray-900 border-gray-300 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Don't collect tax"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"collectTax",value:"collect_unless_exempt",checked:a.collectTax==="collect_unless_exempt",onChange:o("collect_unless_exempt"),className:"w-4 h-4 text-gray-900 border-gray-300 focus:ring-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Collect tax unless exemptions apply"})]})]})]})]})},z=()=>{const a=S(),{addCustomer:r,loading:o,error:d}=M(),{activeStoreId:c}=E(),{customerTags:f,fetchCustomerTags:b,addCustomerTag:x}=_(),[u,m]=n.useState([]),[l,p]=n.useState({firstName:"",lastName:"",email:"",phoneNumber:"",language:"en",agreedToMarketingEmails:!1,agreedToSmsMarketing:!1,taxSettings:{collectTax:"collect"},notes:"",tags:""}),g=n.useCallback((s,t)=>{if(s.includes(".")){const[i,h]=s.split(".");p(C=>({...C,[i]:{...C[i],[h]:t}}))}else p(i=>({...i,[s]:t}))},[]),w=n.useCallback(async s=>{s.preventDefault();try{if(!c)return;const t={storeId:c,firstName:l.firstName,lastName:l.lastName,language:l.language,email:l.email,phoneNumber:l.phoneNumber,agreedToMarketingEmails:l.agreedToMarketingEmails,agreedToSmsMarketing:l.agreedToSmsMarketing,collectTax:l.taxSettings.collectTax,notes:l.notes,tagIds:u};await r(t),a("/customers")}catch(t){console.error("Error creating customer:",t)}},[c,l,u,r,a]),y=n.useCallback(()=>{a("/customers")},[a]),v=n.useCallback(s=>{m(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},[]),N=n.useCallback(async s=>{if(!(!c||!s.trim()))try{const t=await x(c,s);m(i=>[...new Set([...i,t._id])])}catch(t){throw console.error("Error creating tag:",t),t}},[c,x]),j=n.useCallback(s=>{m(t=>t.filter(i=>i!==s))},[]);return n.useEffect(()=>{c&&b(c)},[c,b]),e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:y,className:"inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 mb-2 transition-colors","aria-label":"Go back",children:[e.jsx(L,{className:"w-4 h-4"}),"Back to customers"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Add New Customer"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create a new customer for your store"})]}),e.jsx("div",{className:"max-w-4xl",children:e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:w,children:[e.jsx(R,{data:{firstName:l.firstName,lastName:l.lastName,email:l.email,phoneNumber:l.phoneNumber,language:l.language},onChange:g}),e.jsx(q,{data:{agreedToMarketingEmails:l.agreedToMarketingEmails,agreedToSmsMarketing:l.agreedToSmsMarketing},onChange:g}),e.jsx(O,{data:{collectTax:l.taxSettings.collectTax},onChange:g}),e.jsx(F,{notes:l.notes,onChange:s=>g("notes",s)}),e.jsx(D,{selectedTagIds:u,customerTags:f,onTagSelect:v,onTagRemove:j,onCreateTag:N,activeStoreId:c||void 0}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-sm",children:e.jsx("p",{className:"text-sm text-red-600",children:d})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white inline mr-1.5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Customer..."]}):"Save Customer"})]})]})})]})})};export{z as default};
