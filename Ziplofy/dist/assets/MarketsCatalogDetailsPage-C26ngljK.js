import{p as de,u as ne,$ as oe,b as ie,r,d as ce,a0 as ue,a1 as xe,j as e,F as T,g as me,k as U,M as ge,R as be}from"./index-C7S6h9OR.js";import{F as fe}from"./ArrowLeftIcon-C1qOxHB_.js";import{F as Q}from"./PhotoIcon-Dr2j2bgL.js";import{F as he}from"./TrashIcon-B2-WJkmb.js";const Ne=()=>{const{catalogId:a}=de(),q=ne(),{markets:j,getByStoreId:I,loading:P}=oe(),{activeStoreId:c}=ie(),[u,R]=r.useState(""),[v,N]=r.useState(!1),{searchBasic:$}=ce(),[b,M]=r.useState(""),[F,E]=r.useState([]),[o,w]=r.useState([]),[Y,f]=r.useState(!1),k=r.useRef(void 0),{createItem:A,getByCatalogId:x,items:i,loading:G,deleteItem:O}=ue(),{getByCatalogId:h,items:m,loading:H,createItem:D}=xe(),[L,B]=r.useState(!1),[J,K]=r.useState({}),[W,g]=r.useState(!1),[p,V]=r.useState(null),S=r.useRef(null),C=r.useRef(null),X=t=>K(s=>({...s,[t]:!s[t]}));r.useEffect(()=>{c&&I(c).catch(()=>{})},[c,I]),r.useEffect(()=>{if(!b||!c){E([]),f(!1);return}return window.clearTimeout(k.current),k.current=window.setTimeout(async()=>{const t=await $({q:b,storeId:c}).catch(()=>[]);E(t),f(t.length>0)},300),()=>window.clearTimeout(k.current)},[b,c,$]),r.useEffect(()=>{a&&x(String(a)).catch(()=>{})},[a,x]),r.useEffect(()=>{a&&h(String(a)).catch(()=>{})},[a,h]),r.useEffect(()=>{const t=s=>{S.current&&!S.current.contains(s.target)&&N(!1),C.current&&!C.current.contains(s.target)&&f(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const Z=r.useCallback(t=>{const s=!!i.find(d=>d.productId===t._id),l=!!o.find(d=>d._id===t._id);!s&&!l&&(w(d=>[...d,t]),M(""),f(!1))},[i,o]),ee=r.useCallback(async()=>{if(a)try{B(!0),await Promise.all(o.map(t=>A({catalogId:String(a),productId:t._id,isManuallyAdded:!0}))),w([]),a&&x(String(a)).catch(()=>{})}finally{B(!1)}},[a,o,A,x]),te=r.useCallback(async()=>{!a||!u||(await D({catalogId:String(a),marketId:u}),R(""),a&&h(String(a)).catch(()=>{}))},[a,u,D,h]),se=r.useCallback(async()=>{p&&(await O(p.id).catch(()=>{}),g(!1),V(null),a&&x(String(a)).catch(()=>{}))},[p,O,a,x]),y=j.find(t=>t._id===u);return e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>q("/markets/catalogs"),className:"inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700 mb-3 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Catalog details"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Assign to market"}),e.jsxs("div",{className:"relative",ref:S,children:[e.jsxs("button",{type:"button",onClick:()=>N(!v),disabled:P,className:"w-full md:w-[280px] flex items-center justify-between px-3 py-2 border border-gray-200 rounded-lg text-sm text-left bg-white hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:y?"text-gray-900":"text-gray-400 italic",children:y?`${y.name} (${y.status==="active"?"Active":"Draft"})`:"Select a market"}),e.jsx(T,{className:`w-4 h-4 text-gray-400 transition-transform ${v?"rotate-180":""}`})]}),v&&e.jsx("div",{className:"absolute z-10 w-full md:w-[280px] mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:j.map(t=>{const s=!!m.find(l=>l.marketId===t._id);return e.jsxs("button",{type:"button",onClick:()=>{s||(R(t._id),N(!1))},disabled:s||P,className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 transition-colors flex items-center justify-between ${s?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("span",{children:`${t.name} (${t.status==="active"?"Active":"Draft"})`}),s&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-green-50 text-green-700 border border-green-200",children:"Added"})]},t._id)})})]}),u&&!m.find(t=>t.marketId===u)&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:te,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors",children:"Save"})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm mb-6",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Products"}),e.jsxs("div",{className:"relative mb-4",ref:C,children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search products",value:b,onChange:t=>M(t.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})]}),Y&&F.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:F.map(t=>{const s=!!i.find(l=>l.productId===t._id)||!!o.find(l=>l._id===t._id);return e.jsxs("button",{type:"button",onClick:()=>Z({_id:t._id,title:t.title}),disabled:s,className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 transition-colors flex items-center justify-between ${s?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("span",{children:t.title}),i.find(l=>l.productId===t._id)&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-green-50 text-green-700 border border-green-200",children:"Added"})]},t._id)})})]}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:o.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 text-sm font-medium rounded bg-gray-50 text-gray-700 border border-gray-200",children:[t.title,e.jsx("button",{type:"button",onClick:()=>w(s=>s.filter(l=>l._id!==t._id)),className:"hover:text-gray-900 transition-colors",children:e.jsx(U,{className:"w-3.5 h-3.5"})})]},t._id))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",disabled:L||!a,onClick:ee,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:L?"Saving...":"Save"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden mb-6",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_220px_220px_60px] px-4 py-3 text-xs font-semibold text-gray-700 bg-gray-50",children:[e.jsx("div",{children:"Product"}),e.jsx("div",{children:"Price in INR"}),e.jsx("div",{children:"Compare at price"}),e.jsx("div",{})]}),e.jsx("div",{className:"border-t border-gray-200"}),G?e.jsx("div",{className:"px-4 py-4 text-sm text-gray-600",children:"Loading products..."}):i.length===0?e.jsx("div",{className:"px-4 py-4 text-sm text-gray-600",children:"No products in catalog"}):i.map((t,s)=>{const l=t.product?.title||"Untitled",d=t.product?.imageUrl||null,_=t.variants?.length||0,z=!!J[t._id];return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-[1fr_220px_220px_60px] items-center px-4 py-3 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 bg-gray-100 rounded flex items-center justify-center shrink-0",children:d?e.jsx("img",{src:d,alt:l,className:"w-7 h-7 object-cover rounded"}):e.jsx(Q,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:l}),e.jsxs("div",{className:"text-xs text-gray-500",children:[_," ",_===1?"variant":"variants"]})]})]}),e.jsx("div",{children:e.jsx("input",{type:"text",defaultValue:t.product?.price??"",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})}),e.jsx("div",{children:e.jsx("input",{type:"text",defaultValue:t.product?.compareAtPrice??"",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[_>0&&e.jsx("button",{type:"button",onClick:()=>X(t._id),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:z?e.jsx(ge,{className:"w-4 h-4 text-gray-600"}):e.jsx(T,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{type:"button",onClick:()=>{V({id:t._id,title:l}),g(!0)},className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Remove from catalog",children:e.jsx(he,{className:"w-4 h-4 text-gray-600 hover:text-red-600"})})]})]}),z&&t.variants&&t.variants.map((n,re)=>e.jsxs("div",{className:`grid grid-cols-[1fr_220px_220px_60px] items-center px-4 py-2 bg-gray-50 ${re<t.variants.length-1?"border-b border-gray-200":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 pl-5",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-100 rounded flex items-center justify-center shrink-0",children:n.imageUrl?e.jsx("img",{src:n.imageUrl,alt:n.sku||"",className:"w-6 h-6 object-cover rounded"}):e.jsx(Q,{className:"w-3.5 h-3.5 text-gray-400"})}),e.jsx("span",{className:"text-sm text-gray-700",children:Object.entries(n.optionValues||{}).map(([ae,le])=>`${ae}: ${le}`).join(" â€¢ ")||n.sku})]}),e.jsx("div",{children:e.jsx("input",{type:"text",defaultValue:n.price??"",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})}),e.jsx("div",{children:e.jsx("input",{type:"text",defaultValue:n.compareAtPrice??"",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-400 transition-colors"})}),e.jsx("div",{})]},n._id)),s<i.length-1&&e.jsx("div",{className:"border-t border-gray-200"})]},t._id)})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"Catalog active in markets"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:H?"Loading markets...":`${m.length} market(s)`}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(t=>{const s=j.find(d=>d._id===t.marketId),l=s?s.name:t.marketId;return e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 text-sm font-medium rounded bg-gray-50 text-gray-700 border border-gray-200",children:l},t._id)})})]}),W&&e.jsxs(be.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500/20 z-[1400]",onClick:()=>g(!1),"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 z-[1500] flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md shadow-lg border border-gray-200 pointer-events-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Remove product from catalog"}),e.jsx("button",{onClick:()=>g(!1),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(U,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to remove ",e.jsx("span",{className:"font-medium",children:p?.title||"this product"})," from this catalog?"]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:se,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors",children:"Yes, remove"})]})]})})]})]})})};export{Ne as default};
