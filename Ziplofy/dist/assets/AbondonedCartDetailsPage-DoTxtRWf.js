import{j as e,u as w,r as a,o as T,p as B,aG as V,b as $}from"./index-C7S6h9OR.js";import{S as D}from"./SendRecoveryEmailModal-DwuZo1Py.js";import{F}from"./ArrowLeftIcon-C1qOxHB_.js";import{F as P}from"./PaperAirplaneIcon-BtNwzxYt.js";import"./Modal-DsfhGJdg.js";import"./index-CCB_rw4P.js";const U=({customer:s,getInitials:n})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 pl-4 border-l-4 border-l-blue-500/60",children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Customer"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 text-sm font-medium shrink-0",children:n(s.firstName,s.lastName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900 truncate",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.email})]})]}),s.phoneNumber&&e.jsx("p",{className:"text-xs text-gray-600",children:s.phoneNumber})]})]}),R=({customerFirstName:s,customerLastName:n})=>{const l=w(),i=a.useCallback(o=>{o.preventDefault(),l("/orders/abandoned-carts")},[l]);return e.jsx("nav",{className:"mb-2","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"flex items-center gap-1.5 text-sm text-gray-500",children:[e.jsx("li",{children:e.jsx("a",{href:"/orders/abandoned-carts",onClick:i,className:"hover:text-blue-600 cursor-pointer transition-colors",children:"Abandoned Carts"})}),e.jsx("li",{className:"text-gray-300",children:"/"}),e.jsxs("li",{className:"text-gray-700 font-medium",children:[s," ",n]})]})})},L=({item:s})=>{const n=Object.entries(s.productVariant.optionValues||{}).map(([l,i])=>`${l}: ${i}`).join(", ")||s.productVariant.sku;return e.jsxs("tr",{className:"hover:bg-blue-50/40 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.productVariant.images&&s.productVariant.images.length>0?e.jsx("img",{src:s.productVariant.images[0],alt:s.productVariant.sku,className:"w-10 h-10 object-cover rounded-lg border border-gray-200 shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center shrink-0",children:e.jsx(T,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"min-w-0",children:e.jsx("p",{className:"text-sm text-gray-900 truncate",children:n})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.productVariant.sku})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:e.jsxs("p",{className:"text-sm text-gray-900",children:["₹",s.productVariant.price.toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("span",{className:"text-sm text-gray-900",children:s.quantity})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:e.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["₹",(s.productVariant.price*s.quantity).toFixed(2)]})})]})},q=({cartItems:s,cartTotal:n})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 pl-4 border-l-4 border-l-blue-500/60",children:e.jsxs("h2",{className:"text-sm font-semibold text-gray-900",children:["Items (",s.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:s.map(l=>e.jsx(L,{item:l},l._id))})]})}),e.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Total"}),e.jsxs("span",{className:"text-base font-semibold text-blue-600",children:["₹",n.toFixed(2)]})]})})]}),H=({totalItems:s,uniqueProducts:n,totalValue:l,lastUpdated:i,formatDate:o})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 pl-4 border-l-4 border-l-blue-500/60",children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Summary"})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-2.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Items"}),e.jsx("span",{className:"text-gray-900 font-medium",children:s})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Products"}),e.jsx("span",{className:"text-gray-900 font-medium",children:n})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"Total"}),e.jsxs("span",{className:"text-blue-600 font-semibold",children:["₹",l.toFixed(2)]})]})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Updated: ",o(i)]})]})})]}),K=()=>{const{customerId:s}=B(),n=w(),{abandonedCarts:l,loading:i,error:o,fetchAbandonedCartsByStoreId:j}=V(),{activeStoreId:x}=$(),[t,C]=a.useState(null),[k,f]=a.useState(!1),[u,d]=a.useState(""),[h,m]=a.useState(""),[p,N]=a.useState("custom");a.useEffect(()=>{x&&j(x)},[x,j]),a.useEffect(()=>{if(l.length>0&&s){const r=l.find(c=>c.customer._id===s);C(r)}},[l,s]);const S=a.useCallback(r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),[]),y=a.useCallback((r,c)=>`${r.charAt(0)}${c.charAt(0)}`.toUpperCase(),[]),v=a.useCallback(()=>t?t.cartItems.reduce((r,c)=>r+c.productVariant.price*c.quantity,0):0,[t]),A=a.useCallback(()=>{if(t?.customer){const r=t.customer;d(`Complete your purchase - ${r.firstName}`),m(`Hi ${r.firstName},

We noticed you left some items in your cart. Don't miss out on these great products!

Click here to complete your purchase: [Cart Link]

Best regards,
Your Store Team`),f(!0)}},[t]),b=a.useCallback(()=>{f(!1),d(""),m(""),N("custom")},[]),E=a.useCallback(()=>{console.log("Sending email to:",t?.customer?.email),console.log("Subject:",u),console.log("Body:",h),console.log("Template:",p),b()},[t?.customer?.email,u,h,p,b]),I=a.useCallback(r=>{if(N(r),!t?.customer)return;const c=t.customer;r==="reminder"?(d(`Don't forget your items - ${c.firstName}`),m(`Hi ${c.firstName},

You have items waiting in your cart! Complete your purchase now to secure your items.

[View Cart]

Thanks for shopping with us!`)):r==="discount"?(d(`Special offer for you - ${c.firstName}`),m(`Hi ${c.firstName},

We're offering you a special 10% discount on your cart items! Use code SAVE10 at checkout.

[Complete Purchase with Discount]

This offer expires in 24 hours!`)):r==="custom"&&(d(`Complete your purchase - ${c.firstName}`),m(`Hi ${c.firstName},

We noticed you left some items in your cart. Don't miss out on these great products!

Click here to complete your purchase: [Cart Link]

Best regards,
Your Store Team`))},[t?.customer]),g=a.useCallback(()=>{n("/orders/abandoned-carts")},[n]);return i?e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsx("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4 flex justify-center items-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-blue-600"})})}):o?e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsx("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:e.jsxs("div",{className:"bg-white border border-red-200 rounded-xl p-4 shadow-sm flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-red-700",children:o}),e.jsx("button",{onClick:g,className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:"Back to Abandoned Carts"})]})})}):t?e.jsxs("div",{className:"min-h-screen bg-page-background-color",children:[e.jsxs("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:g,className:"flex items-center gap-2 text-gray-600 hover:text-blue-600 mb-4 transition-colors",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Back to Abandoned Carts"})]}),e.jsx(R,{customerFirstName:t.customer.firstName,customerLastName:t.customer.lastName})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-3 border-l-4 border-blue-500/60",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 text-base font-semibold shrink-0",children:y(t.customer.firstName,t.customer.lastName)}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:[t.customer.firstName," ",t.customer.lastName]}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:t.customer.email})]})]}),e.jsxs("button",{onClick:A,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:border-blue-600 hover:text-blue-600 hover:bg-blue-50/50 transition-colors flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Send Email"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsx(U,{customer:t.customer,getInitials:y}),e.jsx(H,{totalItems:t.totalItems,uniqueProducts:t.cartItems.length,totalValue:v(),lastUpdated:t.lastUpdated,formatDate:S})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(q,{cartItems:t.cartItems,cartTotal:v()})})]})]}),e.jsx(D,{isOpen:k,customer:t?.customer||null,emailSubject:u,emailBody:h,emailTemplate:p,onClose:b,onTemplateChange:I,onSubjectChange:d,onBodyChange:m,onSubmit:E})]}):e.jsx("div",{className:"min-h-screen bg-page-background-color",children:e.jsx("div",{className:"max-w-[1400px] mx-auto px-3 sm:px-4 py-4",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/80 shadow-sm p-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-900",children:"Abandoned cart not found"}),e.jsx("button",{onClick:g,className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:"Back to Abandoned Carts"})]})})})};export{K as default};
